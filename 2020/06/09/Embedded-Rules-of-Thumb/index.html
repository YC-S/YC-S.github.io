<!DOCTYPE html>


<html lang="en">


<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="life,think,work,blog,code" />
   
  <meta name="description" content="a place holder" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    Embedded_Rules_of_Thumb |  Blog
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">
  
<link rel="stylesheet" href="/css/custom.css">

  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  

<link rel="alternate" href="/atom.xml" title="Blog" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Embedded-Rules-of-Thumb"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Embedded_Rules_of_Thumb
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/06/09/Embedded-Rules-of-Thumb/" class="article-date">
  <time datetime="2020-06-09T20:23:33.000Z" itemprop="datePublished">2020-06-09</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">2.7k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">17 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><ul>
<li>It’s easier to keep a system working than to fix it after you break it. (James Grenning)</li>
<li>Move errors from run-time to compile time whenever possible</li>
<li>Programs without documentation have no value</li>
<li>Comments should never restate what the code <em>obviously</em> does.</li>
<li>Comments should aid maintenance by describing intention.</li>
<li>Everything in a header file should be used in at least two source files</li>
<li>Developer productivity is dramatically increased by eliminating distractions and interrupts<ul>
<li>“Developers who live in cubicles probably aren’t very productive. Check how they manage interruptions.” (Jack Ganssle)</li>
</ul>
</li>
<li>“Complexity grows exponentially; Robert Glass figures for every 25% increase in the problem’s difficulty the code doubles in size. A many-million line program can assume a number of states whose size no human can grasp.” (Jack Ganssle)</li>
<li>In nature, the optimum is almost always in the middle somewhere. Distrust assertions that the optimum is at an extreme point. (Akin’s Laws)</li>
<li>Past experience is excellent for providing a reality check. Too much reality can doom an otherwise worthwhile design, though (Akin’s Laws)</li>
<li>As a rule of thumb, every hour you spend on defect prevention will reduce your repair time from three to ten hours. (<a target="_blank" rel="noopener" href="https://stevemcconnell.com/articles/software-quality-at-top-speed/">Steve McConnell</a>)</li>
</ul>
<h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><ul>
<li><p>Complex systems evolve out of simple systems that worked (John Gall)</p>
<ul>
<li>“A complex system that works is invariably found to have evolved from a simple system that worked. The inverse proposition also appears to be true: A complex system designed from scratch never works and cannot be made to work. You have to start over, beginning with a working simple system.” (John Gall)</li>
</ul>
</li>
<li><p>If you can’t describe the behavior in plain English, you can’t successfully describe it with code</p>
</li>
<li><p>Decompose complex problems into smaller sub-problems</p>
<ul>
<li>If a problem can be decomposed into two or more independently solvable problems, then solve them independently first!</li>
<li>After you have implemented and tested the solutions, combine the parts into a larger operation</li>
</ul>
</li>
<li><p>A function should perform only one conceptual task</p>
</li>
<li><p>Don’t solve problems that don’t exist</p>
</li>
<li><p>Solve the specific problem, not the general case</p>
</li>
<li><p>To design a spacecraft right takes an infinite amount of effort. This is why it’s a good idea to design them to operate when some things are wrong. (Akin’s Laws)</p>
</li>
<li><p>Design is an iterative process. The necessary number of iterations is one more than the number you have currently done. This is true at any point in time. (Akin’s Laws)</p>
</li>
<li><p>There is never a single right solution. There are always multiple wrong ones, though. (Akin’s Laws)</p>
</li>
<li><p>(Edison’s Law) “Better” is the enemy of “good”. (Akin’s Laws)</p>
</li>
<li><p>(Shea’s Law) The ability to improve a design occurs primarily at the interfaces. This is also the prime location for screwing it up. (Akin’s Laws)</p>
</li>
<li><p>Studies have found that reworking defective requirements, design, and code typically consumes 40 to 50 percent of the total cost of software development. (</p>
<p>Steve McConnell</p>
<p>, citing Capers Jones)</p>
<ul>
<li>In the worst case, reworking a software requirements problem once the software is in operation typically costs 50 to 200 times what it would take to rework the problem in the requirements stage. (<a target="_blank" rel="noopener" href="https://stevemcconnell.com/articles/software-quality-at-top-speed/">Steve McConnell</a>, citing Boehm and Papaccio)</li>
</ul>
</li>
</ul>
<h2 id="Cost"><a href="#Cost" class="headerlink" title="Cost"></a>Cost</h2><ul>
<li><p>Software is expensive</p>
<ul>
<li>“Study after study shows that commercial code, in all of the realities of its undocumented chaos, costs $15 to $30 per line. A lousy 1000 lines of code – and it’s hard to do much in a thousand lines – has a very real cost of perhaps $30,000. The old saw ‘it’s only a software change’ is equivalent to ‘it’s only a brick of gold bullion’.” (Jack Ganssle)</li>
<li>“The answer is $15 to $40 per line of code. At the $40 end you can get relatively robust, well designed code suitable for industry applications. The $15 end tends to be code with skimpy design packages and skimpy testing. (In other words, some people spend only $15/line, but their code is of doubtful quality.)” (Phil Koopman)</li>
<li>“UPDATE, October 2015. It’s probably more like $25-$50 per line of code now. Costs for projects outsourced to Asia have done up dramatically as wages and competition for scarce coders have increased.” (Phil Koopman)</li>
</ul>
</li>
<li><p>If you want to reduce software development costs, look at every requirements document and brutally strip out features. (Jack Ganssle)</p>
<ul>
<li>Lots of features equals slow progress and expensive development (Jack Ganssle)</li>
</ul>
</li>
<li><p>Non-recurring engineering (</p>
<p>NRE</p>
<p>) costs must be amortized over every product sold</p>
<ul>
<li><p>Save NRE dollars by reducing features</p>
</li>
<li><p>Save NRE dollars by offloading software functionality into hardware components (increases</p>
</li>
</ul>
</li>
</ul>
<pre><code>BOM



cost)

- Only useful if that hardware already exists!
- Software/hardware partitioning should be assessed early in the design process</code></pre><ul>
<li>Save NRE dollars by delivering the product faster (Jack Ganssle)</li>
</ul>
<ul>
<li>It is easier</li>
</ul>
<p>  and cheaper</p>
<p>  to completely rewrite the 5% of problematic functions than to fix the existing implementation</p>
<ul>
<li>These functions cost four times as much as other functions (Barry Boehm)</li>
<li>“Perhaps we really blew it when first writing the code, but if we can identify these crummy routines, toss them out, and start over, we’ll save big bucks.” (Jack Ganssle)</li>
</ul>
<h2 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h2><ul>
<li><p>There’s never enough time to do it right, but somehow, there’s always enough time to do it over. (Akin’s Laws)</p>
</li>
<li><p>Estimating dates instead of hours guarantees a late project (Jack Ganssle)</p>
<ul>
<li>“Scheduling disasters are inevitable when developers don’t separate calendar time from engineering hours.” (Jack Ganssle)</li>
</ul>
</li>
<li><p>“If the schedule hallucinates a people-utilization factor of much over 50% the project will be behind proportionately.” (Jack Ganssle)</p>
<ul>
<li>“Some data suggests the average developer is only about 55% engaged on new product work. Other routine activities, from handling paperwork to talking about Survivor XVI, burn almost half the work week.” (Jack Ganssle)</li>
</ul>
</li>
<li><p>We often fail to anticipate the difficult areas of development</p>
<ul>
<li>“Isn’t it amazing how badly we estimate schedules for most projects? 80% of embedded systems are delivered late. Most pundits figure the average project consumes twice the development effort originally budgeted.” (Jack Ganssle)</li>
</ul>
</li>
<li><p>5% of functions consume 80% of</p>
</li>
</ul>
<p>  debugging</p>
<p>  time (Jack Ganssle)</p>
<ul>
<li>“I’ve observed that most projects wallow in the debug cycle, which often accounts for half of the entire schedule. Clearly, if we can do something about those few functions that represent most of our troubles, the project will get out the door that much sooner.” (Jack Ganssle)</li>
</ul>
<ul>
<li><p>Timelines grow much faster than firmware size – double the lines of code, and the delivery date increases by more than 2x (Barry Boehm)</p>
</li>
<li><p>“The first 90 percent of the code accounts for the first 90 percent of the development time. The remaining 10 percent of the code accounts for the other 90 percent of the development time.” (Tom Cargill)</p>
</li>
<li><p>When porting old code to a new project, if more than about 25% gets modified there’s not much of a schedule boost (Richard Selby)</p>
</li>
<li><p>Systems loaded to 90% of the processor capability require 2x development time over systems loaded at 70% or less. 95% loading triples development time. (Jack Ganssle)</p>
<ul>
<li>“When only a few bytes are left, even trivial features can take weeks as developers must rewrite massive sections of code to free up memory or CPU cycles.” (Jack Ganssle)</li>
</ul>
</li>
<li><p>The schedule you develop will seem like a complete work of fiction up until the time your customer fires you for not meeting it. (Akin’s Laws)</p>
</li>
<li><p>Sometimes, the fastest way to get to the end is to throw everything out and start over. (Akin’s Laws)</p>
</li>
<li><p>(Patton’s Law of Program Planning) A good plan violently executed now is better than a perfect plan next week. (Akin’s Laws)</p>
</li>
</ul>
<h2 id="Hardware"><a href="#Hardware" class="headerlink" title="Hardware"></a>Hardware</h2><ul>
<li>Adding hardware increases power requirements</li>
<li>Use of hardware accelerators to offload CPU-based algorithms can reduce power requirements</li>
<li>Every sensor is a temperature sensor. Some sensors measure other things as well. (Elecia White)</li>
<li>Break out nasty real-time hardware functions into independent CPUs (Jack Ganssle)<ul>
<li>Handling 1000 interrupts per second from a device? Partition it to its own controller and offload all of the ISR overhead off of the main processor</li>
</ul>
</li>
<li>Add hardware whenever it can simplify the software (Jack Ganssle)<ul>
<li>This will dramatically reduce NRE and software development costs, at a tradeoff for an increase in BOM costs.</li>
<li>Systems loaded to 90% of the processor capability require 2x development time over systems loaded at 70% or less. 95% loading triples development time. Add additional hardware to reduce loading. (Jack Ganssle)</li>
</ul>
</li>
<li>(Atkin’s Law of Demonstrations) When the hardware is working perfectly, the really important visitors don’t show up. (Akin’s Laws)</li>
</ul>
<h2 id="Software-Reuse"><a href="#Software-Reuse" class="headerlink" title="Software Reuse"></a>Software Reuse</h2><ul>
<li>Prefer to use existing, reviewed code that has already been re-used by others<ul>
<li>e.g. use the <a target="_blank" rel="noopener" href="https://embeddedartistry.com/fieldmanual-terms/standard-template-library/">STL</a> instead of writing your own containers</li>
</ul>
</li>
<li>Prefer simple, standard communication protocols over custom communication protocols</li>
<li>Follow the “Rule of Three”: you are allowed to copy and paste the code once, but that when the same code is replicated three times, it should be extracted into a new procedure (Martin Fowler)</li>
<li>Before a package is truly reusable, it must have been reused at least three times (Jack Ganssle)<ul>
<li>“We’re not smart enough to truly understand the range of applications where a chunk of software may be used. Every domain requires its own unique features and tweaks; till we’ve actually used the code several times, over a wide enough range of apps, we won’t have generalized it enough to have it truly reusable.” (Jack Ganssle)</li>
</ul>
</li>
<li>Reuse works best when done in large sections of code – think about reusing entire drivers or libraries, not functions (Jack Ganssle)</li>
</ul>
<h2 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h2><ul>
<li>Premature optimization is a waste of time<ul>
<li>“More computing sins are committed in the name of efficiency (without necessarily achieving it) than for any other single reason — including blind stupidity.” (W.A. Wulf)</li>
<li>“The First Rule of Program Optimization: Don’t do it. The Second Rule of Program Optimization (for experts only!): Don’t do it yet.” (Michael A. Jackson)</li>
</ul>
</li>
<li>Only optimize code after you have profiled it to identify the problem area<ul>
<li>“Bottlenecks occur in surprising places, so don’t try to second guess and put in a speed hack until you have proven that’s where the bottleneck is.” (Rob Pike)</li>
<li>“We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil. Yet we should not pass up our opportunities in that critical 3%. A good programmer will not be lulled into complacency by such reasoning, he will be wise to look carefully at the critical code; but only after that code has been identified” (Donald Knuth)</li>
</ul>
</li>
<li>The Pareto principle can be applied to resource optimization: 80% of resources are used by 20% of operations<ul>
<li>Alternatively, there is the 90/10 law in software engineering: 90% of the execution time of a program is spent executing 10% of the code</li>
</ul>
</li>
<li>Algorithmic optimizations have a greater impact than micro optimizations<ul>
<li>“Real efficiency gains come from changing the order of complexity of the algorithm, such as changing from O(N2) to O(NlogN) complexity”</li>
</ul>
</li>
<li>Never sacrifice clarity for perceived efficiency, especially when the efficiency improvement has not been proven with data</li>
</ul>
<h2 id="Red-Flags-and-Problem-Areas"><a href="#Red-Flags-and-Problem-Areas" class="headerlink" title="Red Flags and Problem Areas"></a>Red Flags and Problem Areas</h2><ul>
<li>When developers are afraid to change a function, it’s time to rewrite that code from scratch (Jack Ganssle)</li>
<li>Duplicate code is an indication of poor design or poor programming habits. It must be eliminated.<ul>
<li>“Duplication is a bad practice because it makes code harder to maintain. When the rule encoded in a replicated piece of code changes, whoever maintains the code will have to change it in all places correctly. This process is error-prone and often leads to problems. If the code exists in only one place, then it can be easily changed there.” (Jack Ganssle)</li>
<li>“This rule is can even be applied to small number of lines of code, or even single lines of code. For example, if you want to call a function, and then call it again when it fails, it’s OK to have two call sites; however, if you want to try it five times before giving up, there should only be one call site inside a loop rather than 5 independent calls.” (Jack Ganssle)</li>
</ul>
</li>
<li>Avoid shared resources wherever possible (Jack Ganssle)</li>
<li>Eliminate globals!</li>
<li>Disabling interrupts tends to be A Bad Thing (Jack Ganssle)<ul>
<li>Even in the best of cases it’ll increase system latency and probably decrease performance</li>
<li>Increased latency leads to missed interrupts and mismanaged devices</li>
</ul>
</li>
<li>Be wary of solo Enable Interrupt (EI) commands (Jack Ganssle)<ul>
<li>“An EI located outside an interrupt service routine (ISR) often suggests peril – with the exception of the initial EI in the startup code.” (Jack Ganssle)</li>
<li>“When the enable is not part of a DI/EI pair (and these two instructions must be very close to each other to keep latency down and maintainability up) then the code is likely a convoluted, cryptic well; plumbing these depths will age the most eager of developers.” (Jack Ganssle)</li>
</ul>
</li>
<li>Be wary when code is peppered with DI/EI Pairs (Jack Ganssle)<ul>
<li>Excessive use of Disable Interrupt instructions suggests poor design</li>
<li>“But these DI/EI pairs slip into code in great numbers when there’s a systemic design problem that yields lots of critical regions susceptible to reentrancy problems. You know how it is: chasing a bug the intrepid developer uncovers a variable trashed by context switching. Pop in quick DI/EI pair. Then there’s another. And another. It’s like a heroin user taking his last hit. It never ends.” (Jack Ganssle)</li>
</ul>
</li>
</ul>
<h2 id="Interrupts"><a href="#Interrupts" class="headerlink" title="Interrupts"></a>Interrupts</h2><ul>
<li>Leave interrupts on, for all but the briefest times and in the most compelling of needs. (Jack Ganssle)</li>
<li>If you disable interrupts in a block of code, re-enable them in the same block (Jack Ganssle)</li>
<li>Keep ISRs small<ul>
<li>Be wary of ISRs longer than half a page of code (Jack Ganssle)</li>
<li>In most cases, there should be little-to-no processing inside of the handler (Phillip Johnston)</li>
<li>Set a flag, add a value to a queue, and then rely on user-space code to handle more complex tasks</li>
</ul>
</li>
<li>Minimize ISR latency to ensure the system does not miss interrupts (Jack Ganssle)</li>
<li>Check the design of any ISR that reenables interrupts immediately before returning (Jack Ganssle)<ul>
<li>Minimize critical sections within the ISR.</li>
<li>“It’s perfectly fine to allow another device to interrupt an ISR! or even to allow the same interrupt to do so, given enough stack space. That suggests we should create service routines that do all of the non-reentrant stuff (like servicing hardware) early, issue the EI, and continue with the reentrant activities. Then pop registers and return.” (Jack Ganssle)</li>
</ul>
</li>
</ul>
<p>Avoid the following operations within interrupt handlers: (Phillip Johnston)</p>
<ul>
<li>Don’t declare any non-static variables inside the handler</li>
<li>Avoid blocking function calls</li>
<li>Avoid non-reentrant function calls</li>
<li>Avoid any processing that takes non-trivial time</li>
<li>Avoid operations with locks as you can deadlock your program in an ISR</li>
<li>Avoid operations that involve dynamic memory allocations, as the allocation may require a lock and will take a non-determinate amount of time</li>
<li>Avoid stack allocations<ul>
<li>Depending on your architecture and operational model, your interrupt handler may utilize the stack of the interrupted thread or a common “interrupt stack”.</li>
</ul>
</li>
</ul>
<h2 id="Function-Point-Rules-of-Thumb"><a href="#Function-Point-Rules-of-Thumb" class="headerlink" title="Function Point Rules of Thumb"></a>Function Point Rules of Thumb</h2><p>A function point is the measure of functionality of a part of a software, which <a target="_blank" rel="noopener" href="https://www.ifpug.org/content/documents/Jones-OriginsOfFunctionPointMetrics.pdf">you can read about here</a>. One <a target="_blank" rel="noopener" href="https://embeddedartistry.com/fieldmanual-terms/c/">C</a> function point is about 130 lines of code, on average.</p>
<p>Here are Capers’s rules of thumb, where “FP” means function points. These were extracted from Jack Ganssle’s newsletter.</p>
<ul>
<li><p>Approximate number of bugs injected in a project: FP</p>
<p>1.25</p>
<ul>
<li>Manual code inspections will find about 65% of the bugs. The number is much higher for very disciplined teams.</li>
</ul>
</li>
<li><p>Number of people on the project is about: FP/150</p>
</li>
<li><p>Approximate page count for paper documents associated with a project: FP1.15</p>
</li>
<li><p>Each test strategy will find about 30% of the bugs that exist.</p>
</li>
<li><p>The schedule in months is about: FP0.4</p>
</li>
<li><p>Full time number of people required to maintain a project after release: FP/750</p>
</li>
<li><p>Requirements grow about 2%/month from the design through coding phases.</p>
</li>
<li><p>Rough number of test cases that will be created: FP1.2</p>
</li>
</ul>
<h2 id="Humorous"><a href="#Humorous" class="headerlink" title="Humorous"></a>Humorous</h2><ul>
<li>If anyone says you are to work with an acoustic modem, ask them if it will be located in another building. Refuse unless the answer is yes. (Elecia White)</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        Share
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://yc-s.github.io/2020/06/09/Embedded-Rules-of-Thumb/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rules/" rel="tag">Rules</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2020/06/11/%E5%87%AF%E6%96%87%E5%87%AF%E5%88%A9-Will-Spiritual-Robots-Replace-Humanity-by-2100/" class="article-nav-link">
        <strong class="article-nav-caption">prev post</strong>
        <div class="article-nav-title">
          
            凯文凯利_Will_Spiritual_Robots_Replace_Humanity_by_2100
          
        </div>
      </a>
    
    
      <a href="/2020/06/08/Programming-principles-from-id-software/" class="article-nav-link">
        <strong class="article-nav-caption">next post</strong>
        <div class="article-nav-title">Programming_principles_from_id_software</div>
      </a>
    
  </nav>

  
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2019-2021
        <i class="ri-heart-fill heart_icon"></i> Aaron
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">categories</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">tags</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->


<script src="/js/clickBoom2.js"></script>


<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


    
  </div>
</body>

</html>