<!DOCTYPE html>


<html lang="en">
	

		<head>
			<meta charset="utf-8" />
			 
			<meta name="keywords" content="life,think,work,blog,code" />
			 
			<meta name="description" content="a place holder" />
			
			<meta
				name="viewport"
				content="width=device-width, initial-scale=1, maximum-scale=1"
			/>
			<meta
				name="google-site-verification"
				content="Xe5wkkWgdmMwA81kCWOHLlJSlYSRE47NKPlVzl8ynK8"
			/>
			<title>how to read source code |  Henry&#39;s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
			
			<link rel="shortcut icon" href="/favicon.ico" />
			 
<link rel="stylesheet" href="/dist/main.css">

			<link
				rel="stylesheet"
				href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
			/>
			
<link rel="stylesheet" href="/css/custom.css">
 
			<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
			 
 

		<link rel="alternate" href="/atom.xml" title="Henry's Blog" type="application/atom+xml">
</head>
	</html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-how-to-read-source-code"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  how to read source code
</h1>
 

    </header>
     
    <div class="article-meta">
      <a href="/2019/12/30/how-to-read-source-code/" class="article-date">
  <time datetime="2019-12-30T17:15:55.000Z" itemprop="datePublished">2019-12-30</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">3.1k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">19 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="How-To-Read-Source-Code"><a href="#How-To-Read-Source-Code" class="headerlink" title="How To Read Source Code"></a>How To Read Source Code</h1><h2 id="What-do-we-mean-when-we-say-“reading-source-code”"><a href="#What-do-we-mean-when-we-say-“reading-source-code”" class="headerlink" title="What do we mean when we say “reading source code”?"></a>What do we mean when we say “reading source code”?</h2><p>Reading for comprehension</p>
<p>… to find bugs</p>
<p>… to find interactions</p>
<p>… to review</p>
<p>… to see the interface</p>
<p>… to learn!</p>
<hr>
<h2 id="Reading-isn’t-linear"><a href="#Reading-isn’t-linear" class="headerlink" title="Reading isn’t linear"></a>Reading isn’t linear</h2><p>We skip back and forth from chapter to chapter, module to module. We can read the module straight through but we won’t have the definitions of things from other modules. We can read in execution order, but we won’t know where we’re going more than one call site down.</p>
<hr>
<h2 id="Reading-Order"><a href="#Reading-Order" class="headerlink" title="Reading Order"></a>Reading Order</h2><p>Do you start at the entry point of a package?</p>
<p>How about in a browser?</p>
<p>Maybe find the biggest source code file and read that first.</p>
<p>Try setting a breakpoint early and tracing down through functions in a debugger.</p>
<p>Try setting a breakpoint deep in the code, and reading each function in the call stack.</p>
<hr>
<p>Kinds of source code</p>
<ul>
<li>Javascript</li>
<li>C++</li>
<li>ES6</li>
<li>Coffee Script</li>
<li>Shell Script</li>
</ul>
<hr>
<ul>
<li>SNOBOL</li>
<li>APL</li>
<li>Befunge</li>
<li>Forth</li>
<li>Perl</li>
<li>Other people’s javascript</li>
</ul>
<hr>
<p>Another way to think of kinds of source code</p>
<ul>
<li>Glue</li>
<li>Interface-defining</li>
<li>Implementation</li>
<li>Algorithmic</li>
<li>Configuring</li>
<li>Tasking</li>
</ul>
<p>There’s a lot of study of algorithmic source code out there because that’s what academia produces: algorithms, the little, often mathematical ways of doing things. All the others are a lot more nebulous but I think a lot more interesting. They’re certainly the bulk of what most people write when they’re programming computers.</p>
<p>Of course, sometimes, something does more than one of these things. Many times, in fact. Figuring out what it’s trying to be can be one of the first tasks.</p>
<hr>
<h2 id="What’s-‘Glue’"><a href="#What’s-‘Glue’" class="headerlink" title="What’s ‘Glue’?"></a>What’s ‘Glue’?</h2><p>Not all the interfaces we want to use play nice together. Glue is the plumbing connecting things together. Middleware, promises vs callbacks binding code, inflating arguments into objects or breaking objects apart. All that’s glue.</p>
<hr>
<h2 id="How-do-you-read-glue"><a href="#How-do-you-read-glue" class="headerlink" title="How do you read glue?"></a>How do you read glue?</h2><p>We’re looking for how two interfaces are shaped differently, and what’s common between them.</p>
<hr>
<p>This is from Ben Drucker’s <code>stream-to-promise</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">internals.writable = <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    stream.once(<span class="string">&#x27;finish&#x27;</span>, resolve);</span><br><span class="line">    stream.once(<span class="string">&#x27;error&#x27;</span>, reject);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>The two interfaces we’re talking about here are node streams and promises.</p>
<p>The things they have in common are that they do work until they finish, in node with an event, in promises by calling the resolution functions.</p>
<p>Now the thing you can notice while you’re reading is that promises really can only be resolved once, but streams can actually emit the same event multiple times. They don’t usually, but as programmers we usually know the difference between can’t and shouldn’t.</p>
<hr>
<p>More glue!</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> record = &#123;</span><br><span class="line">    name: (input.name || <span class="string">&#x27;&#x27;</span>).trim(),</span><br><span class="line">    age: <span class="built_in">isNaN</span>(<span class="built_in">Number</span>(input.age)) ? <span class="literal">null</span> : <span class="built_in">Number</span>(input.age),</span><br><span class="line">    email: validateEmail(input.email.trim())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>More things to think about in glue: How are errors handled?</p>
<p>It’s worth asking if any of these things throw? Do they delete bad values? Maybe they coerce them into being okay-enough values? Are these the right choices for the context they’re operating in? Are conversions lossy?</p>
<hr>
<h2 id="What’s-interface-defining-code"><a href="#What’s-interface-defining-code" class="headerlink" title="What’s interface-defining code?"></a>What’s interface-defining code?</h2><p>You know how you have some modules that are really only used one or two places, they’re kinda internal, and you hope nobody looks at them too hard?</p>
<p>Interface-defining is the opposite of that. It’s the hard boundaries of your module.</p>
<hr>
<p>From node’s <code>events.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.usingDomains = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">EventEmitter</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"><span class="built_in">exports</span>.EventEmitter = EventEmitter;</span><br><span class="line"></span><br><span class="line">EventEmitter.prototype.setMaxListeners = <span class="function"><span class="keyword">function</span> <span class="title">setMaxListeners</span>(<span class="params">n</span>) </span>&#123; &#125;;</span><br><span class="line">EventEmitter.prototype.emit = <span class="function"><span class="keyword">function</span> <span class="title">emit</span>(<span class="params">type</span>) </span>&#123; &#125;;</span><br><span class="line">EventEmitter.prototype.addListener = <span class="function"><span class="keyword">function</span> <span class="title">addListener</span>(<span class="params">type, listener</span>) </span>&#123; &#125;;</span><br><span class="line">EventEmitter.prototype.on = EventEmitter.prototype.addListener;</span><br><span class="line">EventEmitter.prototype.once = <span class="function"><span class="keyword">function</span> <span class="title">once</span>(<span class="params">type, listener</span>) </span>&#123; &#125;;</span><br><span class="line">EventEmitter.prototype.removeListener = <span class="function"><span class="keyword">function</span> <span class="title">removeListener</span>(<span class="params">type, listener</span>) </span>&#123; &#125;;</span><br><span class="line">EventEmitter.prototype.removeAllListeners = <span class="function"><span class="keyword">function</span> <span class="title">removeAllListeners</span>(<span class="params">type</span>) </span>&#123;&#125;;</span><br><span class="line">EventEmitter.prototype.listeners = <span class="function"><span class="keyword">function</span> <span class="title">listeners</span>(<span class="params">type</span>) </span>&#123; &#125;;</span><br><span class="line">EventEmitter.listenerCount = <span class="function"><span class="keyword">function</span>(<span class="params">emitter, type</span>) </span>&#123; &#125;;</span><br></pre></td></tr></table></figure>

<p>We’re defining the interface for <code>EventEmitter</code> here.</p>
<p>Some things to ask here are is this complete?  What guarantees does this make? Are internal details exposed?</p>
<p>If you have strong interface contracts, this is where you should expect to find them.</p>
<p>Like glue code, look for how errors are handled and exposed. Is that consistent? Does it distinguish errors due to internal inconsistency from errors because the user of the interface didn’t understand it?</p>
<hr>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">startRouting: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.router = <span class="built_in">this</span>.router || <span class="built_in">this</span>.constructor.map(K);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> router = <span class="built_in">this</span>.router;</span><br><span class="line"><span class="keyword">var</span> location = get(<span class="built_in">this</span>, <span class="string">&#x27;location&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">this</span>.container;</span><br><span class="line"><span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line"><span class="keyword">var</span> initialURL = get(<span class="built_in">this</span>, <span class="string">&#x27;initialURL&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> initialTransition;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Allow the Location class to cancel the router setup while it refreshes</span></span><br><span class="line"><span class="comment">// the page</span></span><br><span class="line"><span class="keyword">if</span> (get(location, <span class="string">&#x27;cancelRouterSetup&#x27;</span>)) &#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>._setupRouter(router, location);</span><br><span class="line"></span><br><span class="line">container.register(<span class="string">&#x27;view:default&#x27;</span>, _MetamorphView);</span><br><span class="line">container.register(<span class="string">&#x27;view:toplevel&#x27;</span>, EmberView.extend());</span><br><span class="line"></span><br><span class="line">location.onUpdateURL(<span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  self.handleURL(url);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> initialURL === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">  initialURL = location.getURL();</span><br><span class="line">&#125;</span><br><span class="line">initialTransition = <span class="built_in">this</span>.handleURL(initialURL);</span><br><span class="line"><span class="keyword">if</span> (initialTransition &amp;&amp; initialTransition.error) &#123;</span><br><span class="line">  <span class="keyword">throw</span> initialTransition.error;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>From <code>Ember.Router</code></p>
<p>This is what that always needs more documentation about why and not so much about what.</p>
<p>Things to look for when reading here are how it fits into the larger whole.</p>
<p>What’s coming from the public interface to this module? What needs validation? Are these variables going to contain what we think they contain? What other parts does this touch? What’s the risk to changing it when adding new features? What might break? Do we have tests for that?</p>
<p>What’s the lifetime of these variables? (this is an easy one: This looks really well designed and doesn’t store needless state with a long lifetime.) Though maybe we should look at <code>_setupRouter</code>…</p>
<hr>
<h2 id="Process-entailment"><a href="#Process-entailment" class="headerlink" title="Process entailment"></a>Process entailment</h2><p>Or, looking forward: <em>How much is required to use this thing correctly?</em></p>
<p>and backward: <em>If we’re here, what got us to this point?</em></p>
<p>It’s pretty easy to see what functions call what other functions. However, the reverse is more interesting! So one of the things you can look for when reading source code, and in particular the implementation bits is look at what things have to happen to set up the state the process needs to be in to begin.</p>
<p>Is that state explicit, passed in via parameters? Is it assumed to be there, as an instance variable or property? Is there a single path to get there, with an obvious place that state is set up? Or is it diffuse?</p>
<hr>
<h2 id="Algorithms"><a href="#Algorithms" class="headerlink" title="Algorithms"></a>Algorithms</h2><p>So algorithmic code is a kind of special case of implementation code. It’s not so exposed to the outside world, it’s the meat of a program. Quite often it’s business logic or the core processes of the software.</p>
<hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Grammar</span>(<span class="params">rules</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Processing The Grammar</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Here we begin defining a grammar given the raw rules, terminal</span></span><br><span class="line">  <span class="comment">// symbols, and symbolic references to rules</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// The input is a list of rules.</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// The input grammar is amended with a final rule, the &#x27;accept&#x27; rule,</span></span><br><span class="line">  <span class="comment">// which if it spans the parse chart, means the entire grammar was</span></span><br><span class="line">  <span class="comment">// accepted. This is needed in the case of a nulling start symbol.</span></span><br><span class="line">  rules.push(Rule(<span class="string">&#x27;_accept&#x27;</span>, [Ref(<span class="string">&#x27;start&#x27;</span>)]));</span><br><span class="line">  rules.acceptRule = rules.length - <span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<p>This bit is from a parser engine I’ve been working on called <code>lotsawa</code>. More on the next slide.</p>
<p>It’s been said a lot that good comments say why something is done or done that way, rather than what it’s doing. Algorithms usually need more explanation of what’s going on since if they were trivial, they’d probably be built into our standard library. Quite often to get good performance out of something, the exactly what-and-how matters a lot.</p>
<p>This is the stuff that those of you with CS degrees get to drool over (or maybe have traumatic memories of).</p>
<hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Build a list of all the symbols used in the grammar so they can be numbered instead of referred to</span></span><br><span class="line"><span class="comment">// by name, and therefore their presence can be represented by a single bit in a set.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">censusSymbols</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> out = [];</span><br><span class="line">  rules.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!~out.indexOf(r.name)) out.push(r.name);</span><br></pre></td></tr></table></figure>

<pre><code>  r.symbols.forEach(function(s, i) &#123;
    var symNo = out.indexOf(s.name);
    if (!~out.indexOf(s.name)) &#123;
      symNo = out.length;
      out.push(s.name);
    &#125;

    r.symbols[i] = symNo;
  &#125;);

  r.sym = out.indexOf(r.name);
&#125;);

return out;
&#125;

rules.symbols = censusSymbols();</code></pre><p>Reads like a math paper, doesn’t it?</p>
<p>One of the things that you usually need to see in algorithmic code is the actual data structures. This one is building a list of symbols and making sure there’s no duplicates.</p>
<p>Look also for hints as to the running time of the algorithm. You can see in this part, I’ve got two loops. In Big-O notation, that’s O(n * m), then you can see that there’s an <code>indexOf</code> inside that. That’s another loop in Javascript, so that actually adds another factor to the running time. (twice – looks like I could make this more optimal by re-using one of the values here) Good thing this isn’t the main part of the algorithm!</p>
<hr>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>The line between source code and configuration file is super thin. There’s a constant tension between having a configuration be expressive and readable and direct.</p>
<hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.configure(<span class="string">&#x27;production&#x27;</span>, <span class="string">&#x27;staging&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  app.enable(<span class="string">&#x27;emails&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.configure(<span class="string">&#x27;test&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  app.disable(<span class="string">&#x27;emails&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>An example using Javascript for configuration.</p>
<p>What we can run into here is combinatorial explosion of options. How many environments do we configure? Then, how many things do we configure for a specific instance of that environment. It’s really easy to go overboard and end up with all the possible permutations, and to have bugs that only show up in one of them. Keeping an eye out for how many degrees of freedom the configuration allows is super useful.</p>
<hr>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;express&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;env&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// <span class="doctag">NOTE:</span> `env` is managed by the framework. This value will be overwritten.</span></span><br><span class="line">    <span class="string">&quot;x-powered-by&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;views&quot;</span>: <span class="string">&quot;path:./views&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mountpath&quot;</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;middleware&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;compress&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;priority&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;module&quot;</span>: <span class="string">&quot;compression&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;favicon&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;priority&quot;</span>: <span class="number">30</span>,</span><br><span class="line">        <span class="string">&quot;module&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;serve-favicon&quot;</span>,</span><br><span class="line">            <span class="string">&quot;arguments&quot;</span>: [ <span class="string">&quot;resolve:kraken-js/public/favicon.ico&quot;</span> ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">A bit of &#96;kraken&#96; config file.</span><br><span class="line"></span><br><span class="line">Kraken took a &#39;low power language&#39; approach to configuration and chose JSON. A little more &quot;configuration&quot; and a little less &quot;source code&quot;. One of the goals was keeping that combinatorial explosion under control. There&#39;s a reason a lot of tools use simple key-value pairs or ini-style files for configuration, even though they&#39;re not terribly expressive.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Configuration source code has some interesting and unique constraints that are worth looking for.</span><br><span class="line"></span><br><span class="line">* Lifetime</span><br><span class="line">* Machine writability</span><br><span class="line">* Responsible people vary a lot more</span><br><span class="line">* Have to fit in weird places like environment variables</span><br><span class="line">* Often store security-sensitive information</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Tasking</span><br><span class="line">-------</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">What do charging 50 credit cards, building a complex piece of software with a compiler and build tools, and sending 100 emails have in common?</span><br><span class="line"></span><br><span class="line">Transactionality. Often, some piece of the system needs to happen exactly once, and not at all if there&#39;s an error. A compiler that leaves bad build products around is a great source of bugs. Double charging customers is bad. Flooding someone&#39;s inbox because of a retry cycle is terrible.</span><br><span class="line"></span><br><span class="line">Resumabilty. A need to continue where they left off given the state of the system.</span><br><span class="line"></span><br><span class="line">Sequentiality. If they&#39;re not strictly linear processes, there&#39;s usually a very directed flow through the code. Loops tend to be big ones, around the whole shebang.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Reading Messy Code</span><br><span class="line">------------------</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">So how do you deal with this?</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;javascript</span><br><span class="line">      DuplexCombination.prototype.on &#x3D; function(ev, fn) &#123;</span><br><span class="line">    switch (ev) &#123;</span><br><span class="line">  case &#39;data&#39;:</span><br><span class="line">  case &#39;end&#39;:</span><br><span class="line">  case &#39;readable&#39;:</span><br><span class="line">this.reader.on(ev, fn);</span><br><span class="line">return this</span><br><span class="line">  case &#39;drain&#39;:</span><br><span class="line">  case &#39;finish&#39;:</span><br><span class="line">this.writer.on(ev, fn);</span><br><span class="line">return this</span><br><span class="line">  default:</span><br><span class="line">return Duplex.prototype.on.call(this, ev, fn);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<p>You are seeing that right. That’s reverse indendation. Blame Isaac.</p>
<hr>
<h2 id="Rose-tinted-glasses"><a href="#Rose-tinted-glasses" class="headerlink" title="Rose tinted glasses!"></a>Rose tinted glasses!</h2><p><code>standard -F dc.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DuplexCombination.prototype.on = <span class="function"><span class="keyword">function</span> (<span class="params">ev, fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (ev) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;data&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;readable&#x27;</span>:</span><br><span class="line">      <span class="built_in">this</span>.reader.on(ev, fn)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;drain&#x27;</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;finish&#x27;</span>:</span><br><span class="line">      <span class="built_in">this</span>.writer.on(ev, fn)</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> Duplex.prototype.on.call(<span class="built_in">this</span>, ev, fn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>It’s okay to use tools while reading! </p>
<hr>
<p>How do you read this?</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">t,e</span>)</span>&#123;<span class="keyword">if</span>(<span class="keyword">typeof</span> define===<span class="string">&quot;function&quot;</span>&amp;&amp;define.amd)&#123;define([<span class="string">&quot;underscore&quot;</span>,<span class="string">&quot;</span></span><br><span class="line"><span class="string">jquery&quot;</span>,<span class="string">&quot;exports&quot;</span>],<span class="function"><span class="keyword">function</span>(<span class="params">i,r,s</span>)</span>&#123;t.Backbone=e(t,s,i,r)&#125;)&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">export</span></span><br><span class="line">s!==<span class="string">&quot;undefined&quot;</span>)&#123;<span class="keyword">var</span> i=<span class="built_in">require</span>(<span class="string">&quot;underscore&quot;</span>);e(t,<span class="built_in">exports</span>,i)&#125;<span class="keyword">else</span>&#123;t.Backbone=e(t,</span><br><span class="line">&#123;&#125;,t._,t.jQuery||t.Zepto||t.ender||t.$)&#125;&#125;)(<span class="built_in">this</span>,<span class="function"><span class="keyword">function</span>(<span class="params">t,e,i,r</span>)</span>&#123;<span class="keyword">var</span> s=t.Backbo</span><br><span class="line">ne;<span class="keyword">var</span> n=[];<span class="keyword">var</span> a=n.push;<span class="keyword">var</span> o=n.slice;<span class="keyword">var</span> h=n.splice;e.VERSION=<span class="string">&quot;1.1.2&quot;</span>;e.$=r;e.</span><br><span class="line">noConflict=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;t.Backbone=s;<span class="keyword">return</span> <span class="built_in">this</span>&#125;;e.emulateHTTP=<span class="literal">false</span>;e.emulateJSO</span><br><span class="line">N=<span class="literal">false</span>;<span class="keyword">var</span> u=e.Events=&#123;<span class="attr">on</span>:<span class="function"><span class="keyword">function</span>(<span class="params">t,e,i</span>)</span>&#123;<span class="keyword">if</span>(!c(<span class="built_in">this</span>,<span class="string">&quot;on&quot;</span>,t,[e,i])||!e)<span class="keyword">return</span> t</span><br><span class="line">his;<span class="built_in">this</span>._events||(<span class="built_in">this</span>._events=&#123;&#125;);<span class="keyword">var</span> r=<span class="built_in">this</span>._events[t]||(<span class="built_in">this</span>._events[t]=[]);</span><br><span class="line">r.push(&#123;<span class="attr">callback</span>:e,<span class="attr">context</span>:i,<span class="attr">ctx</span>:i||<span class="built_in">this</span>&#125;);<span class="keyword">return</span> <span class="built_in">this</span>&#125;,<span class="attr">once</span>:<span class="function"><span class="keyword">function</span>(<span class="params">t,e,r</span>)</span>&#123;<span class="keyword">if</span>(</span><br><span class="line">!c(<span class="built_in">this</span>,<span class="string">&quot;once&quot;</span>,t,[e,r])||!e)<span class="keyword">return</span> <span class="built_in">this</span>;<span class="keyword">var</span> s=<span class="built_in">this</span>;<span class="keyword">var</span> n=i.once(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;s.off</span><br><span class="line">(t,n);e.apply(<span class="built_in">this</span>,<span class="built_in">arguments</span>)&#125;);n._callback=e;<span class="keyword">return</span> <span class="built_in">this</span>.on(t,n,r)&#125;,<span class="attr">off</span>:functio</span><br><span class="line"><span class="function"><span class="title">n</span>(<span class="params">t,e,r</span>)</span>&#123;<span class="keyword">var</span> s,n,a,o,h,u,l,f;<span class="keyword">if</span>(!<span class="built_in">this</span>._events||!c(<span class="built_in">this</span>,<span class="string">&quot;off&quot;</span>,t,[e,r]))<span class="keyword">return</span> thi</span><br><span class="line">s;<span class="keyword">if</span>(!t&amp;&amp;!e&amp;&amp;!r)&#123;<span class="built_in">this</span>._events=<span class="keyword">void</span> <span class="number">0</span>;<span class="keyword">return</span> <span class="built_in">this</span>&#125;o=t?[t]:i.keys(<span class="built_in">this</span>._events);fo</span><br><span class="line"><span class="function"><span class="title">r</span>(<span class="params">h=<span class="number">0</span>,u=o.length;h&lt;u;h++</span>)</span>&#123;t=o[h];<span class="keyword">if</span>(a=<span class="built_in">this</span>._events[t])&#123;<span class="built_in">this</span>._events[t]=s=[];<span class="keyword">if</span>(e</span><br><span class="line">||r)&#123;<span class="keyword">for</span>(l=<span class="number">0</span>,f=a.length;l&lt;f;l++)&#123;n=a[l];<span class="keyword">if</span>(e&amp;&amp;e!==n.callback&amp;&amp;e!==n.callback._ca</span><br><span class="line">llback||r&amp;&amp;r!==n.context)&#123;s.push(n)&#125;&#125;&#125;<span class="keyword">if</span>(!s.length)<span class="keyword">delete</span> <span class="built_in">this</span>._events[t]&#125;&#125;retur</span><br><span class="line">n <span class="built_in">this</span>&#125;,<span class="attr">trigger</span>:<span class="function"><span class="keyword">function</span>(<span class="params">t</span>)</span>&#123;<span class="keyword">if</span>(!<span class="built_in">this</span>._events)<span class="keyword">return</span> <span class="built_in">this</span>;<span class="keyword">var</span> e=o.call(<span class="built_in">arguments</span>,</span><br><span class="line"><span class="number">1</span>);<span class="keyword">if</span>(!c(<span class="built_in">this</span>,<span class="string">&quot;trigger&quot;</span>,t,e))<span class="keyword">return</span> <span class="built_in">this</span>;<span class="keyword">var</span> i=<span class="built_in">this</span>._events[t];<span class="keyword">var</span> r=<span class="built_in">this</span>._event</span><br><span class="line">s.all;<span class="keyword">if</span>(i)f(i,e);<span class="keyword">if</span>(r)f(r,<span class="built_in">arguments</span>);<span class="keyword">return</span> <span class="built_in">this</span>&#125;,<span class="attr">stopListening</span>:<span class="function"><span class="keyword">function</span>(<span class="params">t,e,r</span>)</span></span><br><span class="line"><span class="function"></span>&#123;<span class="keyword">var</span> s=<span class="built_in">this</span>._listeningTo;<span class="keyword">if</span>(!s)<span class="keyword">return</span> <span class="built_in">this</span>;<span class="keyword">var</span> n=!e&amp;&amp;!r;<span class="keyword">if</span>(!r&amp;&amp;<span class="keyword">typeof</span> e===<span class="string">&quot;objec</span></span><br><span class="line"><span class="string">​```</span></span><br></pre></td></tr></table></figure>



<hr>
<p><code>uglifyjs -b &lt; backbone-min.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">t, e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">        define([ <span class="string">&quot;underscore&quot;</span>, <span class="string">&quot;jquery&quot;</span>, <span class="string">&quot;exports&quot;</span> ], <span class="function"><span class="keyword">function</span>(<span class="params">i, r, s</span>) </span>&#123;</span><br><span class="line">            t.Backbone = e(t, s, i, r);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">exports</span> !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="built_in">require</span>(<span class="string">&quot;underscore&quot;</span>);</span><br><span class="line">        e(t, <span class="built_in">exports</span>, i);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        t.Backbone = e(t, &#123;&#125;, t._, t.jQuery || t.Zepto || t.ender || t.$);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">t, e, i, r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s = t.Backbone;</span><br><span class="line">    <span class="keyword">var</span> n = [];</span><br><span class="line">    <span class="keyword">var</span> a = n.push;</span><br><span class="line">    <span class="keyword">var</span> o = n.slice;</span><br><span class="line">    <span class="keyword">var</span> h = n.splice;</span><br><span class="line">    e.VERSION = <span class="string">&quot;1.1.2&quot;</span>;</span><br><span class="line">    e.$ = r;</span><br><span class="line">    e.noConflict = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="Human-Parts"><a href="#Human-Parts" class="headerlink" title="Human Parts"></a>Human Parts</h2><p>Or: <em>guessing intent is dangerous but you learn so much</em></p>
<hr>
<p>There’s a lot of tricks for figuring out what the author of something meant.</p>
<hr>
<h2 id="Look-for-guards-and-coercions"><a href="#Look-for-guards-and-coercions" class="headerlink" title="Look for guards and coercions"></a>Look for guards and coercions</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> arg != <span class="string">&#x27;number&#x27;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">&quot;arg must be a number&quot;</span>);</span><br><span class="line">​<span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Looks like the domain of whatever function we&#x27;re in is &#x27;numbers&#x27;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">arg = <span class="built_in">Number</span>(arg)</span><br><span class="line">​<span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Coerce things to numeric. Same domain as above, but doesn&#x27;t reject errors via exceptions. There might be `</span><span class="literal">NaN</span><span class="string">`s though. Probably smart to read and check if there&#x27;s comparisons that will be false against those.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Look for defaults</span></span><br><span class="line"><span class="string">-----------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">arg = arg || &#123;&#125;</span><br><span class="line">​<span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Default to an empty object.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">arg = (arg == <span class="literal">null</span> ? <span class="literal">true</span> : arg)</span><br><span class="line">​<span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Default to true only if a value wasn&#x27;t explicitly passed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Look for layers</span></span><br><span class="line"><span class="string">---------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span>req<span class="string">` and `</span>res<span class="string">` from Express are tied to the web; how deep do they go?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Is there an interface boundary you can find?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Look for tracing</span></span><br><span class="line"><span class="string">----------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Are there inspection points?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Debug logs?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Do those form a complete narrative? Or are they ad-hoc leftovers from the last few bugs?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Look for reflexivity</span></span><br><span class="line"><span class="string">--------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Are identifiers being dynamically generated?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Is there `</span><span class="built_in">eval</span><span class="string">`? Metaprogramming? New function creation?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span>func.toString()<span class="string">` is your friend!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Look at lifetimes</span></span><br><span class="line"><span class="string">-----------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* Who initializes this?</span></span><br><span class="line"><span class="string">* When does it change?</span></span><br><span class="line"><span class="string">* Who changes it?</span></span><br><span class="line"><span class="string">* Is this information somewhere else in the mean time?</span></span><br><span class="line"><span class="string">* Is it ever inconsistent?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ Somewhere, someone typed the value you see into a keyboard, generated it from a random number generator, or computed it and saved it.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ Somewhere else, some time else, that value will affect some human or humans. Who are these people?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ What or who chooses who they are?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ Is that value ever going to change?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ Who changes it?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Look for hidden state machines</span></span><br><span class="line"><span class="string">------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ Sometimes boolean variables get used together as a decomposed state machine</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">^ For example, the variables `</span>isReadied<span class="string">` and `</span>isFinished<span class="string">` might show a state machine like so:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">var</span> isReadied = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> isFinished = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>Or</p>
<p><code>START -&gt; READY -&gt; FINISHED</code></p>
<hr>
<h2 id="Look-for-hidden-state-machines"><a href="#Look-for-hidden-state-machines" class="headerlink" title="Look for hidden state machines"></a>Look for hidden state machines</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">| isReadied | isFinished | state    |</span><br><span class="line">| --------- | ---------- | -------- |</span><br><span class="line">| false     | false      | START    |</span><br><span class="line">| false     | true       | invalid  |</span><br><span class="line">| true      | false      | READY    |</span><br><span class="line">| true      | true       | FINISHED |</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>^ Note that they can also express the state <code>!isReadied &amp;&amp; isFinished</code> – which might be an interesting source of bugs, if something can end up at the finished state without first being ready.</p>
<hr>
<h2 id="Look-for-composition-and-inheritance"><a href="#Look-for-composition-and-inheritance" class="headerlink" title="Look for composition and inheritance"></a>Look for composition and inheritance</h2><p>Is this made of parts I can recognize? Do those parts have names?</p>
<hr>
<h2 id="Look-for-common-operations"><a href="#Look-for-common-operations" class="headerlink" title="Look for common operations"></a>Look for common operations</h2><p><code>map</code>.</p>
<p><code>reduce</code>.</p>
<p>cross-join.</p>
<hr>
<p>It’s time to go read some source code.</p>
<p>Enjoy!</p>
 
      <!-- reward -->
      
    </div>
    

    <!--comments -->
    
    <section id="comments">
      <div id="disqus_thread"></div>
      <script>
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://https-yc-s-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        Share
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://yc-s.github.io/2019/12/30/how-to-read-source-code/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2019/12/30/Java-Development/" class="article-nav-link">
        <strong class="article-nav-caption">prev post</strong>
        <div class="article-nav-title">
          
            Java Development
          
        </div>
      </a>
    
    
      <a href="/2019/12/29/hello-world/" class="article-nav-link">
        <strong class="article-nav-caption">next post</strong>
        <div class="article-nav-title">Hello World</div>
      </a>
    
  </nav>

  
   
     


</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020-2022
        <i class="ri-heart-fill heart_icon"></i> Henry
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
  
</footer>

      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Henry&#39;s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">🏡</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">🏛</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">📚</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">🏷</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->


<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto'
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->


<script src="/js/clickBoom2.js"></script>


<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


<script src="/js/dz.js"></script>



    
  </div>
</body>

</html>