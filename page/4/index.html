<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Yuanchen&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Yuanchen&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Yuanchen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Yuanchen's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yuanchen's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/22/AugularJS%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/22/AugularJS%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/" class="post-title-link" itemprop="url">AugularJS思维导图</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-22 19:19:04 / Modified: 19:19:25" itemprop="dateCreated datePublished" datetime="2020-04-22T19:19:04-04:00">2020-04-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="../images/AngularJS-7597561.png" alt="AngularJS"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/21/Angular%E5%8F%91%E5%B1%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/21/Angular%E5%8F%91%E5%B1%95/" class="post-title-link" itemprop="url">Angular发展</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-21 12:21:36 / Modified: 12:29:56" itemprop="dateCreated datePublished" datetime="2020-04-21T12:21:36-04:00">2020-04-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><h2 id="前端黎明"><a href="#前端黎明" class="headerlink" title="前端黎明"></a><strong>前端黎明</strong></h2><p>HTML是一种标记语言，属于声明式编程范式，然而，声明式的缺点——复用性差，往往会制约着开发者对应用进行扩展。</p>
<p>早期的网页应用往往体量较小，加之用户体验不强，很多服务器直接将HTML作为数据处理，形成MVC的中介模式（脱藕）实现，model和view是两种不同的数据系统，中介controller则负责将不同的model输入映射到响应的view输出。</p>
<p><img src="../images/v2-33c6b0d61468c9c47096d927ba63a7f4_b.jpg" alt="img"></p>
<blockquote>
<p>中介模式<br>使用一个中介对象来封装两个系统之间的交互，使得各对象不用显示地相互引用</p>
</blockquote>
<p>但是随着前端交互越来越多，静态的HTML服务端处理根本不能满足交互需求，因此有实现将数据与视图的映射（MVC）迁移到前端，例如AngularJS，Backbone等。</p>
<h2 id="混乱大时代"><a href="#混乱大时代" class="headerlink" title="混乱大时代"></a><strong>混乱大时代</strong></h2><p>但是随着应用体量的不断变大，前端交互逻辑的不断复杂化，这类框架的Controller越来越复杂难以管理，加上浏览器的事件驱动模型（事件循环），使得前端开发步入了困境。</p>
<p>首先解决这一困境的是React，采用函数式编程语言中广泛使用的单向数据流，控制耦合数据的产生和事件的作用范围。</p>
<p><img src="../images/v2-c69ae47c13a33ae29258aaa4e5a746c1_b.jpg" alt="img"></p>
<blockquote>
<p>单向数据流<br>函数式编程（λ演算），例如LISP，采用的是不可变数据+态射变换的方式进行计算，最早由<em>阿隆索·丘奇</em>(Alonzo Church)提出，想象一个函数（函子）的参数是函数，返回值也是函数。（不可变数据本身也是函数，总是返回自身参数，即单位元，单位态射）<br>参考：<br><a href="http://link.zhihu.com/?target=https%3A//github.com/justinyhuang/Functional-Programming-For-The-Rest-of-Us-Cn">https://github.com/justinyhuang/Functional-Programming-For-The-Rest-of-Us-Cn</a><br><a href="http://link.zhihu.com/?target=https%3A//plato.stanford.edu/entries/category-theory/">https://plato.stanford.edu/entries/category-theory/</a><br>维持态射连续性，即形成unidirectional network（单向网络），输入单位元总使从计算系统的输入流向输出（想象一个工业生产线）<br>这样的做法的目的，也是函数式编程的优点之一（参考傻瓜函数式）：<br>因为FP中的每个符号都是final的，于是没有什么函数会有副作用。谁也不能在运行时修改任何东西，也没有函数可以修改在它的作用域之外修改什么值给其他函数继续使用（在指令式编程中可以用类成员或是全局变量做到）。这意味着决定函数执行结果的唯一因素就是它的返回值，而影响其返回值的唯一因素就是它的参数。<br>当然函数式的这一优势不仅仅用在前端领域，包括密集计算（模型能够运行则要求运行不出错，例如Haskell），军用（导弹巡航控制），核电站中控（安全要求高），气象等等领域。</p>
</blockquote>
<p><strong>但是React夹杂的私货，却也被混入了前端开发中，这便是MVVM</strong>。</p>
<p><img src="../images/v2-5c939ce85d3493b84228c4e9c42ddcfb_1440w.jpg" alt="img"></p>
<p>每一个设计模式，都有他的应用领域，MVVM是马丁·富勒的Presentation Modal（表示模型）的变体，由约翰·高斯曼提出，优点是<strong>不依赖于特定用户界面平台</strong>。</p>
<p>缺点呢？创造者约翰·高斯曼自己就提出：</p>
<blockquote>
<p>实现MVVM的开销对于简单的UI操作是“过度的”，对于更大的应用来说，推广ViewModel变得更加困难。而且，非常大的应用程序中的数据绑定会导致相当大的内存消耗。</p>
</blockquote>
<p>不仅如此，浏览器在实现视图绑定的阶段，往往伴随着性能开销，而采用VM到V的映射，<strong>往往伴随着大量的视图绑定和解绑过程</strong>，会造成相当的性能瓶颈。</p>
<p>React可以通过很多优化控制重绘的数量（diff）和时间（requestAnimationFrame，setTimeout），但是当应用体量越来越庞大的时候，它所提到的<strong>“Web UI中跨层级移动操作特别少”这个前置条件慢慢失效，而维护一个庞大的数据池带来的内存消耗和数据持久化问题也越来越突出</strong>。</p>
<p>但是React为什么还要采用MVVM而放弃掉MVC呢？</p>
<p>Facebook成立于2004年，而2005年WWDC大会上，苹果不仅发布了iPod nano这一音乐领域的飓风，还联合各家浏览器厂商，联合发布了围堵IE的<strong>WebKit</strong>，浏览器领域迎来了新的一波风暴。</p>
<p><img src="../images/v2-0b18db551fb28f22ec2b2a6144e314fa_b.jpg" alt="img"></p>
<p>当然，刚刚成立的facebook直到当年九月份才将高中版Facebook向大众开放，自然错过了浏览器之争的关键时机。但是作为以互联网产品为盈利主力的facebook，肯定不希望自己的产品被浏览器钳制，不可能因为浏览器的更新迭代甚至是恶意竞争而妨碍到自己的利益。并且在当时浏览器兼容问题严重的情况下，MVVM的平台无关也更加符合Facebook甚至是用户的切身利益。</p>
<p>另外，由于没有考虑到前端的复杂度会到达今天这样的地步，网景在设计JavaScript的时候，考虑利用函数式编程中“直观”的优势，以及异步带来的交互友好，将JS设计成了协程异步系统，这毫无疑问将编程要求提高到一个较高的层次，使得一线开发人员叫苦不迭。<strong>而MVVM又能有效地将异步的问题同步化（针对数据操作）</strong>，因此，选择MVVM这一模式几乎是必然的。</p>
<p>因此React在2011年开始用于facebook的newsfeed，而这一年正是浏览器竞争最为激烈的一年，不管是从开发效率还是从运行稳定性上来看，React都是最好并且最符合Facebook利益的选择，于是快马加鞭，于2013年正式向公众开放。</p>
<p><img src="../images/v2-1c6fb3d444a24b9d47da59aa59cf0e28_b.jpg" alt="img"></p>
<p>React的单向数据流思想，让组件化，工程化的进程不再受到阻碍，整个前端领域也迎来了大的发展期。</p>
<p>本来故事到这里就应该结束了的，不过，谁也没有想到会有另外一个公司出手，将前端领域带入了另外一个世界。</p>
<hr>
<h2 id="移动端大时代"><a href="#移动端大时代" class="headerlink" title="移动端大时代"></a><strong>移动端大时代</strong></h2><p>08年大家都印象深刻，乔布斯将手中的iphone4举向空中的那一刻，相信每一个人都心潮澎湃。而此时iOS的竞争对手Android加入了Google，开始了与iOS长达多年的拉锯战。面对发布会上乔布斯自豪的网页浏览功能，Android团队建议放弃KHTML，加入WebKit开发项目。</p>
<p>但是不知是不是早有预谋还是其他原因（毕竟08年Google已经有了v8），08年加入WebKit的Google从09年开始就成为了WebKit最大的代码提供者，而提交贡献相对较少的苹果却拥有最终决断权。</p>
<p>于是当2013年blink爆炸性发布时，苹果WebKit团队领头人Maciej Stachowiak说：</p>
<blockquote>
<p>我们在写任何WebKit2代码前就问了Google的人，他们愿不愿意将多进程架构的支持整合到WebKit中，他们的答案是否定的。在这种情况下，我们面临的选择是做一个怀有敌意的Chromium分支，或者写我们自己的多进程架构，或者继续使用单进程架构。我们选择了写自己的多进程架构。</p>
</blockquote>
<p>而凭借着多进程，v8，沙箱的三板斧，Chrome迅速侵占浏览器市场，终于在15年底，完成了对浏览器领域的垄断。</p>
<p><img src="../images/v2-9dc80c05224c32a8229415e5c5c7d24f_b.jpg" alt="img"></p>
<p>这时浏览器巨人再回过头看，<strong>看到的是“平台无关”的Happy Hacking代码肆意运行在它的浏览器上</strong>。</p>
<p>Don’t be evil?事实应该是Don‘t let anybody say I’m evil。涉及到利益之争，不可能不重视。早在2012年，当市场上风闻Facebook新项目时，Google就将其假象竞争对手AngularJS收入囊中，几乎是与blink同时布局。</p>
<p>开源世界的主导权竞争就是人才的竞争，谷歌早就深谙这一套玩法，为了更广大的互联网市场，Google开始了新一轮的降维打击，而这一布局的关键一环，就是——Angular。</p>
<hr>
<h2 id="只用一个平台的野心"><a href="#只用一个平台的野心" class="headerlink" title="只用一个平台的野心"></a><strong>只用一个平台的野心</strong></h2><p>Hack的思想，是如何在系统框架内部，实现对自己有利的功能，Facebook是一家富有极客精神的公司，因此，React的实现也颇有些无耐，没有浏览器，即便再Hack，都只是别人既定框架下的小聪明。</p>
<p>而这时，Angular在紧锣密鼓地计划中：</p>
<p>stage中的代码阻塞如何处理？工程界早有成熟的方式，可以采用多线程的方式，主线程处理不了的任务转化成事件，转交给从线程运行，保障高IO的进行——chrome 17支持了web worker。</p>
<p>前端开发调试，离线浏览，消息推送？没问题，chrome service worker为你提供保障。</p>
<p>提供了完整的性能监视，每个区域的重绘，fps，layer边界，都给你直观地展示，堪称世界上最完善的浏览器调试工具。</p>
<p>甚至是微软，经历了IE的失败，比其他人都更加意识到开源社区的重要，作为事件驱动windows系统中的长期经验总结，Rx的js版本Rxjs，顺理成章地被运用到同样处于事件驱动环境的浏览器中。</p>
<p>接下来，就是等待能够彻底压榨浏览器性能，用户友好，集成化的前端开发框架了。</p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><blockquote>
<p>上回说到Google需要一款前端技术栈将它的浏览器性能完全发挥，并于其他浏览器拉开身位，阻击平台无关（MVVM）的各类框架。<br>如何能够让Google在浏览器制霸之后，将魔抓伸向应用层？<br>如何在渲染中发挥出浏览器最大性能呢？</p>
</blockquote>
<p>最近房价波动比较厉害，作为一个高薪程序员，新房大多地段不好，而购入一套离公司近的二手房，自然需要一个好的房地产中介。</p>
<blockquote>
<p>需要他联系买卖双方</p>
</blockquote>
<p>但是这时却有两种中介商：</p>
<ol>
<li><strong>所有买方跟我联系，我同意把你们愿意出的价格和需求报给卖方，最后把结果给你们双份分开展示</strong>（MVVM）</li>
<li><strong>你要买房？我单独联系卖方和你，你说啥，我就原封不动地传达给卖方，反之亦然</strong>（MVC）</li>
</ol>
<p>大家别急着选 2，想象一个场景，如果卖方那群人天天在变，一会儿这个看不上，一会儿那个瞧不起，房子也不停在变，早上 50 平晚上 100 平的，你会不会觉得第一种房地产中介要好一点呢？</p>
<blockquote>
<p>大哥我跟你说，这个卖家真的有毒，上次那房看的时候在 3 环，卖的时候带我们去 5 环，您看看这个，这个靠谱，他家房子是真的大。</p>
</blockquote>
<p>你也别急着调过头选 1，就算卖家不靠谱，1 中的中介每天下午 5 点才能将所有卖家信息汇总给你看，你婚礼在上午 8 点，未婚妻说：</p>
<blockquote>
<p>不干！什么时候买房，什么时候结婚！</p>
</blockquote>
<p>这个时候你又怎么办？另外即便未婚妻能等到下午 6 点，中介从 5 点开始翻记录就翻到了 6 点半，你又怎么办？</p>
<p>对的，浏览器也遇到这个问题，js 中的 dom 操作是买方，而页面渲染则是卖方。</p>
<hr>
<p>React 作为一个出色的前端框架，通过 MVVM 做到了平台无关，facebook 相关产品在任何浏览器上打开都能有不错的性能，甚至能够进军原生终端应用开发，这都是 MVVM 架构的功劳。</p>
<p>但是 vm 这一全局的 view 副本，始终在消耗着浏览器资源，项目小的时候看不出来，当项目无限膨胀的时候，弊病开始显现。</p>
<p>书接上回，Google 需要一个前端框架，这个技术栈<strong>不一定需要 Google 产品在其他浏览器上的体验与 Chrome 一样，但一定要在 Chrome 上有极致的性能</strong>。用纯数据的方式保留一个 view 副本？不可能也不需要这么做。</p>
<p>Angular 框架采用 TypeScript 开发（工程化会另有文章讨论），其中一个优点便是代码易读，打开源码<code>angular/packages/core/src/linker</code>,里面有许多抽象类，方便了解大致的 Angular 渲染机制。</p>
<ol>
<li>templateRef: 用户声明模板</li>
<li>viewRef: 自定义视图</li>
<li>elementRef: 原生 Dom 元素</li>
<li>viewContainerRef:自定义挂载点</li>
<li>componentFactory: 组件工厂函数</li>
<li>moduleFactory: 模块工厂函数</li>
</ol>
<p>举例说明两个重要类：ComponentRef 和 viewContainerRef。</p>
<p>ComponentRef 需要确定和视图的关系，以及相关的变更检测，依赖注入等（变更检测在 M 中进行而非 vm 中）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;https:&#x2F;&#x2F;github.com&#x2F;angular&#x2F;angular&#x2F;blob&#x2F;master&#x2F;packages&#x2F;core&#x2F;src&#x2F;linker&#x2F;component_factory.ts</span><br><span class="line">&#x2F;&#x2F; 组件引用</span><br><span class="line">export abstract class ComponentRef&lt;C&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; 宿主元素</span><br><span class="line">  abstract get location(): ElementRef;</span><br><span class="line">  &#x2F;&#x2F; 依赖</span><br><span class="line">  abstract get injector(): Injector;</span><br><span class="line">  &#x2F;&#x2F; 组件实例</span><br><span class="line">  abstract get instance(): C;</span><br><span class="line">  &#x2F;&#x2F; 宿主视图</span><br><span class="line">  abstract get hostView(): ViewRef;</span><br><span class="line">  &#x2F;&#x2F; 检测树</span><br><span class="line">  abstract get changeDetectorRef(): ChangeDetectorRef;</span><br><span class="line">  &#x2F;&#x2F; 获取组件类型</span><br><span class="line">  abstract get componentType(): Type&lt;any&gt;;</span><br><span class="line">  &#x2F;&#x2F; 组件销毁</span><br><span class="line">  abstract destroy(): void;</span><br><span class="line">  &#x2F;&#x2F; 组件销毁回调</span><br><span class="line">  abstract onDestroy(callback: Function): void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>viewContanerRef 需要实现对 viewRef 的挂载和删除，因此他的抽象类声明如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; angular&#x2F;packages&#x2F;core&#x2F;src&#x2F;linker&#x2F;view_container_ref.ts</span><br><span class="line">export abstract class ViewContainerRef &#123;</span><br><span class="line">  &#x2F;&#x2F; 针对每一个container 的锚点 element</span><br><span class="line">  abstract get element(): ElementRef;</span><br><span class="line">  &#x2F;&#x2F; 清除内容</span><br><span class="line">  abstract clear(): void;</span><br><span class="line">  &#x2F;&#x2F; 获取view</span><br><span class="line">  abstract get(index: number): ViewRef | null;</span><br><span class="line">  &#x2F;&#x2F; 获取view 长度</span><br><span class="line">  abstract get length(): number;</span><br><span class="line">  &#x2F;&#x2F; 创建嵌入式view（偷懒专用）</span><br><span class="line">  abstract createEmbeddedView&lt;C&gt;(</span><br><span class="line">    templateRef: TemplateRef&lt;C&gt;,</span><br><span class="line">    context?: C,</span><br><span class="line">    index?: number</span><br><span class="line">  ): EmbeddedViewRef&lt;C&gt;;</span><br><span class="line">  &#x2F;&#x2F; 插入view</span><br><span class="line">  abstract insert(viewRef: ViewRef, index?: number): ViewRef;</span><br><span class="line">  &#x2F;&#x2F; 移动view</span><br><span class="line">  abstract move(viewRef: ViewRef, currentIndex: number): ViewRef;</span><br><span class="line">  &#x2F;&#x2F; 获取view 的 index</span><br><span class="line">  abstract indexOf(viewRef: ViewRef): number;</span><br><span class="line">  &#x2F;&#x2F; 删除view</span><br><span class="line">  abstract remove(index?: number): void;</span><br><span class="line">  &#x2F;&#x2F; 解绑但是不删除view</span><br><span class="line">  abstract detach(index?: number): ViewRef | null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意那个 move 移动方法，稍后会有讨论许多其他框架中“跨层级移动不会发生”的前置条件是否存在。</p>
<p>注：变更检测的简单声明在 angular/packages/core/src/change_detection/change_detector_ref.ts</p>
<p>如果<strong>组件绑定的 ChangeDetectionRef 发现了变更，标记为脏，则重新运行 Component 到 View 的渲染，官方称作渲染引擎</strong>。</p>
<p>这便是Angular的MVC架构：</p>
<p><img src="../images/v2-344b3bf052c0670d0961388783ca35e7_b.jpg" alt="img"></p>
<p>直接操作DOM，极大地减少了中间数据操作，提升了性能。</p>
<hr>
<p>Angular 4.0 更新了渲染引擎 Renderer2，将渲染操作封装成函数，方便大家进行渲染（直接使用有违背组件化的开发方式）。 而现在，官方已经放出了 Renderer3，也就是<a href="https://link.zhihu.com/?target=https%3A//github.com/angular/angular/blob/92e80af8751993879a1d0b4a5a029ededb973e4d/packages/core/src/render3/STATUS.md">ivy 渲染引擎</a>，将摇树优化，依赖，国际化等等操作融入到渲染层级，并且以“<strong>装饰器即编译</strong>”的理念作为中心思想。</p>
<p><img src="../images/v2-71e10093612ce44a2ec73dd802369055_1440w.jpg" alt="img"></p>
<p>更加恐怖的是，能够在 <strong>6.2kb</strong> 的大小下实现一个渲染的最小功能集。</p>
<hr>
<p>DOM 中有一个幽灵——</p>
<blockquote>
<p>良好用户体验的保证是 60 帧的刷新率，最好是120帧！</p>
</blockquote>
<p>然而在这 8ms 左右的帧时间中，一次 <strong>DOM 结构变更（appendChild,removeChild）会占用平均 4ms 左右的时间</strong>，因此——</p>
<h2 id="你得代码必须在-4ms-内执行完毕"><a href="#你得代码必须在-4ms-内执行完毕" class="headerlink" title="你得代码必须在 4ms 内执行完毕!"></a><strong>你得代码必须在 4ms 内执行完毕!</strong></h2><p>而且 DOM 结构变更是浏览器过程，浏览器会保证你单纯的 dom 变更操作绝对会有稳定的用户界面变更，但<strong>这个过程在 js 代码中不可优化！</strong></p>
<p>React 的解决办法，是利用浏览器 RquestAnimationFrame 或者自己统计时间（RequestAnimationFrameWithSetTimeout）,<strong>将需要执行的reconsiliation代码和提交的DOM变更依次安排在浏览器渲染结束的空隙里</strong>。</p>
<p>但这有没有真正解决问题，大家都有自己的判断。</p>
<p>Angular 采用了另外的方式：</p>
<p><strong>（一）MVC 的变更是响应式的，并且脏检查只针对数据（onPush）。</strong></p>
<p>渲染引擎在处理数据变更时，采用单向绑定（数据变更即更新）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; angular&#x2F;packages&#x2F;core&#x2F;src&#x2F;view&#x2F;util.ts</span><br><span class="line">&#x2F;&#x2F; 检测view是否变更</span><br><span class="line">export function checkAndUpdateBinding(</span><br><span class="line">    view: ViewData, def: NodeDef, bindingIdx: number, value: any): boolean &#123;</span><br><span class="line">  if (checkBinding(view, def, bindingIdx, value)) &#123;</span><br><span class="line">    view.oldValues[def.bindingIndex + bindingIdx] &#x3D; value;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; angular&#x2F;packages&#x2F;core&#x2F;src&#x2F;view&#x2F;text.ts</span><br><span class="line">&#x2F;&#x2F; 以textNode为例，还有内联性能优化</span><br><span class="line">export function checkAndUpdateTextInline(</span><br><span class="line">    view: ViewData, def: NodeDef, v0: any, v1: any, v2: any, v3: any, v4: any, v5: any, v6: any,</span><br><span class="line">    v7: any, v8: any, v9: any): boolean &#123;</span><br><span class="line">    let changed &#x3D; false;</span><br><span class="line">      const bindings &#x3D; def.bindings;</span><br><span class="line">      const bindLen &#x3D; bindings.length;</span><br><span class="line">      if (bindLen &gt; 0 &amp;&amp; checkAndUpdateBinding(view, def, 0, v0)) changed &#x3D; true;</span><br><span class="line">      &#x2F;&#x2F; ...10个内联</span><br><span class="line">      if (changed) &#123;</span><br><span class="line">    let value &#x3D; def.text !.prefix;</span><br><span class="line">    if (bindLen &gt; 0) value +&#x3D; _addInterpolationPart(v0, bindings[0]);</span><br><span class="line">    &#x2F;&#x2F; ... 10个内联</span><br><span class="line">    const renderNode &#x3D; asTextData(view, def.nodeIndex).renderText;</span><br><span class="line">    view.renderer.setValue(renderNode, value);</span><br><span class="line">  &#125;</span><br><span class="line">  return changed;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>也就是说，单纯的数据的改变无法引起DOM的结构变更。</p>
<p>并且，<strong>DOM操作是会发生节点间的移动的！</strong>拖拽，弹框等等，如果设计大量复杂组建节点，一次DOM的移动操作伴随大量重绘。</p>
<p>这些问题，在Angular中也只是调用一个move方法，名正言顺地replaceChild。</p>
<p>但是当NgIf等发生时，还是会有结构变更怎么办，如果这个时候大量代码逻辑导致4ms内代码运行超时，卡顿还是会发生。</p>
<p><strong>（二）我不与你在这 4ms 中争抢性能，使用 webWorker 在另一个线程处理逻辑，最后通过指令告诉浏览器视图更新，在这 8ms 中尽情地完成你那平均 4ms 的渲染~</strong></p>
<p>这方法就是Angular在渲染性能领域的杀手锏，也是充分利用浏览器做到的极致性能，官网描述，源代码在<code>angular/packages/platform-webworker-dynamic/</code>，官网描述为：</p>
<blockquote>
<p>Achieve the maximum speed possible on the Web Platform today</p>
</blockquote>
<p>汪老师在翻译时，加了一个‘以及未来’:</p>
<blockquote>
<p>通过Web Worker和服务端渲染，达到在如今(以及未来）的Web平台上所能达到的最高速度</p>
</blockquote>
<p>为什么有个括号里的以及未来？因为webworker与浏览器强关联，<strong>技术平台只有在浏览器垄断的庇护下才能肆无忌惮地使用web worker，其技术架构甚至比绝大部分客户端程序的io性能还要高（因为webWorker是系统线程，不是用户态）</strong>。</p>
<p>这一点是如何实现的呢？</p>
<p><img src="../images/v2-0aae540aa681bf0b1f65ed3048d549fd_b.jpg" alt="img"></p>
<p><strong>组件逻辑代码完全与主线程相分离，在另一个线程处理数据，而在UI中只进行渲染有关操作。</strong>（不然你得Angular师傅叫你把代码写在service里面只是为了好看么？）</p>
<p><img src="../images/v2-bbd1c263d0558f50140f00b10fb0afe8_b-20200421122638731.jpg" alt="img"></p>
<p><strong>通过ServiceMessageBroker提交变更，渲染引擎在客户端获取变更数据，进行视图渲染。</strong></p>
<p>正如<a href="https://link.zhihu.com/?target=https%3A//www.youtube.com/watch%3Fv%3DKz_zKXiNGSE%26t%3D4s">ason Teplitz演讲</a>所言，所有如下的操作：</p>
<p><img src="../images/v2-4df3c92e9e36f88ff2b1469e3b39d2d1_1440w.jpg" alt="img"></p>
<p>都不会对你的视图渲染造成任何影响，<strong>V与M在前端实现了真正的分离</strong>！</p>
<hr>
<p>是的，Angular实现的（设计目标更严谨），是浏览器中的最强渲染性能，强大的浏览器后盾允许他这么做。</p>
<p>但是采用了MVC的方式，会不会导致AngularJS一代那样的异步错乱和数据意外耦合变更的问题呢？</p>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p><img src="../images/v2-9b71342a3832a85b2bb4d5215cbf6552_r.jpg" alt="Angular物语（三）ReactiveX（1）"></p>
<h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a><strong>动机</strong></h2><blockquote>
<p>如果你觉得你没有必要用Rxjs，那你就不要用</p>
</blockquote>
<p>这个说法很万金油，可以避免很多不必要的争论，但是并没有什么建设意义——什么时候会觉得有必要用呢？</p>
<p>先给一个结论，大家可以参考参考：</p>
<blockquote>
<p>在一个<strong>事件驱动系统</strong>中处理<strong>复杂异步</strong>，<strong>必须</strong>使用ReactiveX或者类似工具</p>
</blockquote>
<p>必须？是的，必须！</p>
<p>就是这么绝对，毕竟先抛出一个绝对的概念，大家讨论特殊情况的时候才能言之有物不是？</p>
<p>这个武断中有一下几点需要特殊说明——</p>
<ol>
<li><strong>事件驱动</strong></li>
<li><strong>复杂异步</strong></li>
<li><strong>必要性</strong></li>
</ol>
<p>我们一个个说明吧~</p>
<hr>
<h2 id="事件驱动"><a href="#事件驱动" class="headerlink" title="事件驱动"></a><strong>事件驱动</strong></h2><p>XXX驱动，一般指的是你代码逻辑运行的原因。</p>
<p>如果你代码运行是因为某种事件或者消息——事件驱动。</p>
<p>如果是因为数据的改变——数据驱动。</p>
<p>首先声明这不是一个编程概念，因为你很容易在非编程领域看到这些概念——比如市场分析可以采用事件驱动和数据驱动的方法——但是他却是在编程概念之上更高层级的思想方法，<strong>很多种模式的不同实现就是来源于这两种不同的思想</strong>（例如MVC，MVVM）。</p>
<p>举例说明一个随时间变化的数据系统：</p>
<p><img src="../images/v2-815e8fe27815962eaf4b9e19e70af166_b.jpg" alt="img"></p>
<p>你如果注重数据，注重代码实现（代码的目的就是将事件消息翻译成数据变更）而不在意时间方向上的变化——数据驱动：</p>
<p><img src="../images/v2-cc7b18b07476255ecd2edf30f42ddc19_b.jpg" alt="img"></p>
<p>你如果注重事件，注重服务而不在意单一时刻的数据变化——事件驱动：<img src="../images/v2-45789737110cc75ba130a034da041d93_1440w.jpg" alt="img"></p>
<p>有什么区别呢？</p>
<p>我们先来看数据驱动：</p>
<ol>
<li>每一时刻只需要考虑数据的变更，而不需要考虑数据为什么变更，又会引起怎样的变更——<strong>耦合性低，不可回溯</strong></li>
<li>状态的迁移需要由编程人员或是系统发出的消息驱动——<strong>即时性差</strong></li>
<li>总是由一个状态迁移到另一个状态，方便时间旅行——<strong>可回退</strong></li>
</ol>
<p>惊喜的是，事件驱动就像它的另一面一样，优缺点完全互补：</p>
<ol>
<li>需要考虑特定事件会引起怎样的变更，多个事件极容易出现耦合，但是容易定位数据变更的原因——<strong>耦合性大，可回溯</strong></li>
<li>状态的迁移是由事件决定的，事件逻辑不受阻挡——<strong>即时性强</strong></li>
<li>单一时刻数据不确定，很难进行时间旅行——<strong>不可回退</strong></li>
</ol>
<p>因此两种思想方法的口号也就容易理解了——</p>
<blockquote>
<p><strong>数据驱动——人类不善于处理逻辑，但善于处理数据</strong><br><strong>事件驱动——一切以最大化服务为优先</strong></p>
</blockquote>
<p>数据库事务，浏览器DOM，游戏帧画面渲染都是数据驱动，他们之间有一定的共性——</p>
<ol>
<li>对数据准确定有要求</li>
<li>状态迁移没有额外开销或者开销很小（文件存储读写，或者直接渲染一帧即释放）</li>
</ol>
<p>服务器IO，浏览器接口，游戏逻辑都是事件驱动，他们之间也有一定的共性——</p>
<ol>
<li>需要对用户操作或者请求及时响应</li>
<li>全部状态迁移几乎不可能或者开销极大，只能通过消息进行</li>
</ol>
<p><strong>所谓的前端层面有名的伪概念之一——数据驱动适合前端开发——完完全全就是错误的！</strong></p>
<p>并且，浏览器为了快速响应用户操作可是采用的事件驱动模型，为此还在单线程中实现了协程，这一方向在可见的未来不会改变。</p>
<p>那怎么处理这个复杂的，即时性要求如此之高的系统呢？如何优化其耦合性大，不可回退的缺点？实现高可用呢？</p>
<p>数据驱动模式一般如何解决不可回溯的缺点？</p>
<p><strong>将事件作为数据存储——flux，redux模式</strong></p>
<p>点到为止，应该很多前端都很熟悉这样的概念，其实这样的概念和redis缓存，sql语句操作数据库没有什么本质区别，都是消息——事务——数据变更的模式。</p>
<p>同理可得，如何处理事件驱动中的耦合性问题呢？</p>
<p><strong>将数据也作为事件发出——stream模式</strong></p>
<p>对的，这就是ReactiveX定义中的“<strong>数据流</strong>”。</p>
<hr>
<h2 id="复杂异步"><a href="#复杂异步" class="headerlink" title="复杂异步"></a><strong>复杂异步</strong></h2><p>浏览器给了你异步的代码能力，但是怎样实现异步，怎样处理异步，却没有告诉你行之有效的方法。</p>
<blockquote>
<p>异步怎么可能复杂，不就是async await么？</p>
</blockquote>
<p>好吧，那你坐好了，我给你看看异步到底有多复杂：</p>
<p><strong>性能问题</strong></p>
<p>大部分所谓的异步代码比同步代码还慢（需要调度时间）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; bad</span><br><span class="line">await A; await B; awaitC;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; good</span><br><span class="line">await Promise.all([A,B,C])</span><br></pre></td></tr></table></figure>

<p><strong>竞态问题</strong></p>
<p>发出多个请求，以最先返回的数据为准？（别急着打产品经理）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await Promise.race([A,B])</span><br></pre></td></tr></table></figure>

<p>嗯，这些好像Promise也能做，不急，还有其他问题呢。</p>
<p><strong>组合问题</strong></p>
<p>需要一次异步紧跟上一次异步，即时处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const result_1 &#x3D; await Promise.All([A,B,C])</span><br><span class="line">const result_2 &#x3D; await D(result_1[0])</span><br><span class="line">&#x2F;&#x2F; 异步耦合，也是耦合</span><br></pre></td></tr></table></figure>

<p><strong>并发问题</strong></p>
<p>需要进行节流和去抖。</p>
<p><strong>撤销问题</strong></p>
<p>需要必要的时候撤销回调，防止空置错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">await A;</span><br><span class="line">if(componentDestroied)&#123;</span><br><span class="line">    return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>异常问题</strong></p>
<p>需要统一处理异步异常，捕获异步异常以便让异步顺利进行，处处try catch？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try&#123;</span><br><span class="line">    await A;</span><br><span class="line">    await B;</span><br><span class="line">&#125;catch(err)&#123;</span><br><span class="line">    &#x2F;&#x2F; error handler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>调度问题</strong></p>
<p>这个promise只有micro一种调度模式，你如果需要用其他调度方式，恭喜你扑街：</p>
<p><img src="../images/v2-bf04a0b5908d27db992f7c591bba4ad7_b.jpg" alt="img"></p>
<p>micro和macro都有可能导致页面渲染阻塞（前者推迟，后者导致逻辑帧挤压物理帧），想要更加流畅的效果？试试animationFrame？</p>
<p>更或者，你是希望用到webworker多线程渲染（主线程只提交patch），那就得自己实现调度器了~</p>
<p>这些还只是冰山一角，还有循环变更，事件过滤，事件侦听，多播等等问题，信息交换会遇到什么问题，异步能把他们都走一遭~</p>
<p>别紧张，这些问题有没有简单的可以解决的办法呢？哈哈，你算是找对人了！</p>
<hr>
<h2 id="必要性"><a href="#必要性" class="headerlink" title="必要性"></a><strong>必要性</strong></h2><p>不过很多有后端经验的朋友肯定会反驳我——<strong>解决异步耦合问题不是可以用面向对象么？</strong></p>
<p>是的，类和对象的思想就是<strong>封装数据和事件（行为）</strong>，理论上数据驱动的问题和事件驱动的短板都可以用面向对象来弥补。</p>
<p>但是，面向对象需要复杂的结构信息来声明依赖，当异步过于复杂的时候，你需要维持一个异常庞大的结构，这样就回到了该用库还是该自己实现的问题上——不过以事件驱动系统中遇到的异步问题复杂度，自己用面向对象实现很不可靠。</p>
<p>不信问问用NodeJs的小朋友，最多做做可读可写流的连接，用人处理过race，combine，mergeAll？</p>
<p>当然，如果你觉得完全没有使用Rxjs的必要，那么可能存在以下几种情况——</p>
<ol>
<li>处于一个完全数据驱动系统下（React），状态迁移是由固定消息驱动的。如setState，将所有数据流订阅之后再打平成数据，然后setState？这有意义？那自动订阅然后setState呢？那就请小心处理并发问题（diff可是个性能无底洞）。</li>
<li>不需要处理复杂的异步问题。比如博客，官网等产品，数据来源确定，前端往往只有展示的需求。</li>
</ol>
<hr>
<h2 id="Rxjs和Angular"><a href="#Rxjs和Angular" class="headerlink" title="Rxjs和Angular"></a><strong>Rxjs和Angular</strong></h2><h2 id="Angular是数据驱动么？"><a href="#Angular是数据驱动么？" class="headerlink" title="Angular是数据驱动么？"></a>Angular是数据驱动么？</h2><p>这么说某种程度也对，毕竟class的变量和elementRef的绑定是数据驱动的（数据改变会引发响应逻辑），但是也仅仅停留在一个Component声明内部，并且是响应式实现（getter，setter），本质不是变量改变，而是触发了新的事件。</p>
<p>另外提一句，vue也是如此的原理，但是getter，setter没有暴露给你，用watch和computed配合Rxjs说不定是个很好的思路（但是它是diff实现，同样也要考虑性能问题，虽然diff只是局限于component内部）。</p>
<p><strong>全局来看，Angular触发视图变更的原因，有且只有zone拦截的事件！，并且是响应式变更至template，是一个不折不扣，200%的事件驱动系统，和浏览器实现高度吻合！</strong></p>
<p>数据驱动有什么问题？毕竟都流行那么多年了？</p>
<p>因为前端的大环境改变了，我也希望大家能清楚地明白这一趋势。</p>
<p>数年前前端的主题是跨平台，因此数据驱动的MVVM大行其道可以理解，但是<strong>DOM diff消耗性能阻塞协程，状态手动迁移导致异步性能极差</strong>，是无论如何无法被忽视的。</p>
<p>而浏览器平均patch时间是4ms左右，现代浏览器普遍60-120hz的刷新能每个事件循环你有10ms左右的时间处理逻辑。</p>
<p>好像时间挺宽裕的，别忘了，历史的洪流在不断向前——</p>
<p>5g时代如果VR大行其道，低于240hz产生的栅栏效应将严重影响用户体验，这种情况下——<strong>你已经完全没有了在渲染线程处理业务逻辑的时间</strong>。<br>再加上万物互联和1ms延迟导致的呈几何倍数增长的异步问题，届时如何为用户提供服务？</p>
<p>platform-webworker提供了多线程渲染的新的解决办法，服务将渐渐凌驾于实现之上，面对着新的产业升级，<strong>这波车，你上不上？</strong></p>
<hr>
<p>明白为什么要使用Rxjs了么？</p>
<p><strong>更快（快速无阻塞响应服务），更稳定（数据流约束耦合），更方便（函数式避免复杂结构）</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/20/%E7%BE%8E%E5%9B%BD%E4%BA%BA%E6%80%A7%E6%A0%BC%E7%89%B9%E7%82%B9%E8%A7%82%E5%AF%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/20/%E7%BE%8E%E5%9B%BD%E4%BA%BA%E6%80%A7%E6%A0%BC%E7%89%B9%E7%82%B9%E8%A7%82%E5%AF%9F/" class="post-title-link" itemprop="url">美国人性格特点观察</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-20 21:23:10 / Modified: 21:29:12" itemprop="dateCreated datePublished" datetime="2020-04-20T21:23:10-04:00">2020-04-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="对美国军队和美国人性格特点的观察，早在70年前就从抗美援朝的战俘营里开始了。"><a href="#对美国军队和美国人性格特点的观察，早在70年前就从抗美援朝的战俘营里开始了。" class="headerlink" title="对美国军队和美国人性格特点的观察，早在70年前就从抗美援朝的战俘营里开始了。"></a>对美国军队和美国人性格特点的观察，早在70年前就从抗美援朝的战俘营里开始了。</h2><p><strong>前辈们观察之细致，记录之详实，令我十分感慨。</strong></p>
<p>志愿军俘管人员或许没有公知大v们人均985的高学历和出色的理论功底，他们虽然只是受过启蒙级共产主义教育的农民战士，</p>
<p><strong>但是从他们的观察和分析中看到的美军特点，再结合当下美国诸多乱象，好像都有了解释——</strong></p>
<p>出自西虹（原抗美援朝创作组成员、战地记者）的第一手回忆录《抗美援朝战地日记》</p>
<p><strong>外俘主要思想特点：</strong></p>
<h2 id="高度的自私自利（说白了就是精致的利己主义者）："><a href="#高度的自私自利（说白了就是精致的利己主义者）：" class="headerlink" title="高度的自私自利（说白了就是精致的利己主义者）："></a>高度的自私自利（说白了就是精致的利己主义者）：</h2><blockquote>
<p><strong>“美俘特别明显，腐化堕落，不爱劳动，脑子里尽是金钱，女人，吃喝玩乐。”</strong></p>
<p>“班里有病号，我们的人照顾病号，<strong>他们说：“他与我无关。”病号还未死，他们就摘了人家的手表、钢笔据为己有。”</strong></p>
<p>“俘虏们在笔记本上，尽是记着一些<strong>爱吃的糖果、酒名、菜单、食谱、黄色下流的音乐诗歌</strong>等。”</p>
<p>“吃饭时，绝对平均，剩一块肉也要切开分，大家看着分菜。<strong>发的烟和烟纸绝对不给别人一点，</strong>病号的药不吃，留着换美金。”</p>
<p>“在汉城、日本，美英士兵嫖妓、吃酒，<strong>为此争吵打架，英美宪兵各帮助自己的士兵打对方。</strong>美兵上了战场，<strong>恨不得班长、排长等马上死了。班长是中士，薪水多，他们死了他可以较快升级，多拿钱。</strong>”</p>
<p>“衣服脏了，丢在外面不管，没衣服穿就围个毯子坐着。”</p>
<p>“<strong>他们身上带许多裸体女人照片，皮肤上刺着龙、花纹、女人。</strong>”</p>
<p>“<strong>他们的官兵都在日本或南朝鲜嫖妓，</strong>有的军官在南朝鲜雇用朝鲜妇女，每月50美金，一面当佣人服侍他，一面把她作为发泄兽欲的工具。<strong>士兵在后方常常带上妓女去看电影、喝咖啡、跳舞。</strong>”</p>
<p>“今年春天准备遣俘时，他们已列好了回家后的菜单，今天吃什么，明天吃什么，还写信给美国定旅馆，有人还想搞一辆汽车。<strong>他们偷东西，赌博，用扑克牌赌钱。</strong>”</p>
<p>“到处便溺，脏得很。”</p>
</blockquote>
<h2 id="民族优越感，歧视少数民族："><a href="#民族优越感，歧视少数民族：" class="headerlink" title="民族优越感，歧视少数民族："></a>民族优越感，歧视少数民族：</h2><blockquote>
<p>“轻视黑人，轻视波多利格人，认为美国人顶好，<strong>把美国人分了好多等，说他们是第一等。”</strong></p>
<p>“还说总统可竞选，人人有发财机会，美国生活方式好，他们觉得很优越。 ”</p>
<p>“<strong>白人到一定年龄可升大官，黑人不能升大官，</strong>认为黑人是劣等民族。不同黑人坐一个车，去一个馆子吃饭，住一个房子。”</p>
<p>“战俘和我们一样吃高粱米，<strong>土耳其人很快吃了起来，美俘军官布斯说‘在二战中，我们对德国俘虏还给他们面包吃，你们怎么能把这种东西给我们吃，这不人道！’</strong>我带着他看了志愿军伙房，他看我们吃的都一样，方才作罢。”</p>
<p>“在这里，白人围火取暖，黑人都被挤在一边，黑白人之间的仇视还很深。<strong>打篮球，黑人白人分开打，黑人有球法好的，白人不服气。”</strong></p>
</blockquote>
<blockquote>
<p>“黑人至今还不忘金宏浩教员拯救溺水俘虏的事。他们说：“金教员，我们永远不会忘记，你这样软弱的身体还跳到河里去捞救他，<strong>在美国，是谁也不会在乎一个黑人死掉的。”“黑人过去从没有被这样平等地待遇过。”</strong></p>
</blockquote>
<h2 id="普遍的反tg反苏："><a href="#普遍的反tg反苏：" class="headerlink" title="普遍的反tg反苏："></a>普遍的反tg反苏：</h2><blockquote>
<p>“说苏联是“铁幕”，苏联人民没有自由，生活坏，tg就是侵略的，<strong>他们从小就受到这种反动教育。”</strong></p>
<p>“他们希望和谈早日达成，早日回家，再不想当兵了。一些人急躁不安，不愿学习，愿早日见到父母妻子。<strong>有些人见和谈拖延，情绪低落，不愿学习，怕被送到西伯利亚做苦工，一辈子回不了家。我们解释责任不在我方，叫他们不要急躁。</strong>”</p>
</blockquote>
<h2 id="狭隘的民族主义思想："><a href="#狭隘的民族主义思想：" class="headerlink" title="狭隘的民族主义思想："></a>狭隘的民族主义思想：</h2><blockquote>
<p>“美国这样也好，那样也好，说不好就不行。 他们都有文化程度，读过初中、大学的很多。<strong>他们学习的东西很浮浅，不扎实，不了解政治，</strong>其中有些人比较好。”</p>
<p>“英兵有绅士派味道，稳重，不爱喊叫，自尊心很强；美兵爱吵闹，轻浮，英兵看不惯。美兵打篮球，英兵就踢足球。吃饭时各自在一边吃，不乐意在一块。<strong>英国配给鸡蛋，一人一天一个，美兵说自己国内随便吃几个就吃几个，讥笑英国。”</strong></p>
<p>“美兵下汽车后，带的东西常丢，不想带。上了战场爱偷子弹。<strong>撤退时，互相抢汽车，美国兵上了车，不让英兵上，其他土耳其、菲律宾等小国家的士兵也不让上，抢汽车抢得打起架来。</strong>”</p>
<p>“现在他们好多了，新来的俘虏看见老俘虏不顺眼，说他们都变成共产主义者了。老俘虏也看不惯新俘虏。”</p>
<p>“俘虏中涌现了一批积极分子，认识了美国政府的反动性。<strong>积极分子受少数落后分子的打击，中间分子比较多，有明哲保身的态度。</strong>他们内部已经起了分化，我们做工作是扩大积极分子的面。”</p>
</blockquote>
<blockquote>
<p>“组织战俘用黄豆磨豆腐，<strong>土耳其俘虏去推磨，美俘不动，</strong>说他们是奴隶，活应该他们干。”</p>
</blockquote>
<h2 id="这些真实的历史记录，刷新了我对《血战钢锯岭》等等好莱坞电影里的美军士兵的认知。"><a href="#这些真实的历史记录，刷新了我对《血战钢锯岭》等等好莱坞电影里的美军士兵的认知。" class="headerlink" title="这些真实的历史记录，刷新了我对《血战钢锯岭》等等好莱坞电影里的美军士兵的认知。"></a>这些真实的历史记录，刷新了我对《血战钢锯岭》等等好莱坞电影里的美军士兵的认知。</h2><p>只不过在过去一段时间，公知美分们把这些记录当成所谓的“洗脑宣传”，让许多人以为美军真的是救世主式的白玉无瑕了。</p>
<p><strong>而士兵眼里观察到的士兵，又更为真实。因为同是军人，“男人最了解男人”。</strong></p>
<p><strong>这份记录，很真实。</strong></p>
<p>“土耳其俘虏推磨，美俘不动，说他们是奴隶，活应该他们干”<strong>这不就是美国社会当下对待华裔、拉美裔、东南亚裔的现状么？</strong></p>
<p><strong>美军“烟和烟纸不给别人一点”“病号还没死就把人家的手表据为己有”的同时，我们在生命垂危的上甘岭还把一个苹果一人一口。</strong></p>
<p>而反观当下，多少人在被公知美分鼓吹西方的那一套价值观时，<strong>无形中被洗脑成了美俘那样精致的利己主义者和享乐主义者？</strong></p>
<p><strong>个人主义，白人优越，精致的利己主义，以及过度娱乐化之后产生的知识体系不健全，即便受过高等教育，也很肤浅，</strong></p>
<h2 id="最终形成一个自私，傲慢，充满偏见和对立的社会。"><a href="#最终形成一个自私，傲慢，充满偏见和对立的社会。" class="headerlink" title="最终形成一个自私，傲慢，充满偏见和对立的社会。"></a>最终形成一个自私，傲慢，充满偏见和对立的社会。</h2><p>这种坑我们不能被美分香蕉人给拉进去。</p>
<h2 id="时至今日，我们有些人，却把美国电影里的美军用巧克力钓女人嫖妓、收集纪念品（其实就是抢劫）、偷东西赌钱、酗酒作乐等等行为，当成“帅气”“牛叉”“真实人性”“这才是军人”！"><a href="#时至今日，我们有些人，却把美国电影里的美军用巧克力钓女人嫖妓、收集纪念品（其实就是抢劫）、偷东西赌钱、酗酒作乐等等行为，当成“帅气”“牛叉”“真实人性”“这才是军人”！" class="headerlink" title="时至今日，我们有些人，却把美国电影里的美军用巧克力钓女人嫖妓、收集纪念品（其实就是抢劫）、偷东西赌钱、酗酒作乐等等行为，当成“帅气”“牛叉”“真实人性”“这才是军人”！"></a>时至今日，我们有些人，却把美国电影里的美军用巧克力钓女人嫖妓、收集纪念品（其实就是抢劫）、偷东西赌钱、酗酒作乐等等行为，当成“帅气”“牛叉”“真实人性”“这才是军人”！</h2><p><strong>当年我们高度纪律性的前辈们，亲眼目睹了美俘的龌龊，现在有些后辈却把这些行径深以为然，</strong>你说说这些人的价值观被歪曲到了什么地步。</p>
<p><strong>你自己被美国人洗脑了你自己都不知道，还把教育你学好当成“洗脑”。</strong>你说可不可笑？</p>
<p>真是黑白不分了。</p>
<h2 id="个人看法，看一个国家的本质特点，看它这个国家的军队基层士兵群像就可以了。"><a href="#个人看法，看一个国家的本质特点，看它这个国家的军队基层士兵群像就可以了。" class="headerlink" title="个人看法，看一个国家的本质特点，看它这个国家的军队基层士兵群像就可以了。"></a>个人看法，看一个国家的本质特点，看它这个国家的军队基层士兵群像就可以了。</h2><p><strong>因为一个国家的军队基层士兵，往往是能代表这个国家的普遍现象的。</strong>因为士兵的组成大多数是国家的底层、中层，而非高层的精英人士。</p>
<h2 id="他们的素质，最能代表国家的大多数。"><a href="#他们的素质，最能代表国家的大多数。" class="headerlink" title="他们的素质，最能代表国家的大多数。"></a>他们的素质，最能代表国家的大多数。</h2><p>反观中国人民志愿军的高素质和纪律性，不仅深受朝鲜人民拥护尊敬，连对手也为之一惊。</p>
<blockquote>
<p>“临别前布斯要把他的钢笔送给我做纪念，我婉言谢绝。”</p>
<p>一个美国战俘说：“德国人是信奉天主教、基督教的，他们不但不给我们过圣诞节，而且虐待我们。中国人不信宗教，但为我们筹备一个隆重的圣诞节，<strong>我们深深感到中国是世界上最讲文明的国家。</strong>”</p>
</blockquote>
<p>以至于双方在换俘时，碧潼的联合国军战俘与我军俘管人员握手惜别，而巨济岛的志愿军战俘把美国临时发的“新衣服”纷纷脱光甩在地上，以示抗议：<strong>“回来前才给每个人发了一套新衣服，想叫我们给他们撑面子”。</strong></p>
<p>（被美军挖掉双眼的朝鲜人民军战俘金井元）</p>
<p><strong>如此鲜明的对比，令在场的中外记者震惊不已。</strong></p>
<h2 id="所以到底谁才是对平民无差别轰炸的恶霸，谁才是救生命于水火、伸张正义的超级英雄？"><a href="#所以到底谁才是对平民无差别轰炸的恶霸，谁才是救生命于水火、伸张正义的超级英雄？" class="headerlink" title="所以到底谁才是对平民无差别轰炸的恶霸，谁才是救生命于水火、伸张正义的超级英雄？"></a>所以到底谁才是对平民无差别轰炸的恶霸，谁才是救生命于水火、伸张正义的超级英雄？</h2><p>被志愿军官兵奋斗主义、吃苦耐劳、谦虚有礼的高素质感化的美军相当多，</p>
<p><strong>而被美国“享乐主义的生活方式”吸引的志愿军却没有。</strong></p>
<p><strong>甚至许多俘虏在志愿军的战俘营里完成了“初级启蒙教育”：</strong></p>
<blockquote>
<p>美俘小伊利亚斯说：“<strong>我一辈子也忘不了得到中队长为我犯错误而给予我的忠告。</strong></p>
<p>我偷过两次东西，第一次偷了同班俘虏的一双靴子，想把它拿去换酒喝，被发现后，受到批评，自己答应不再犯同样的错误；</p>
<p>第二次看到储藏室有酒，就去偷偷地把它弄了出来，后来又被发现了。</p>
<p>中队长要我坦白，我怪不好意思，撒了个谎，但并没有瞒得过去，于是我给关进了反省室，要我好好反省。反省期间同样的有饭吃，分量也很多，<strong>我觉得他们处处都是为了我好。</strong></p>
<p><strong>当我被放出来的时候，我已说不出对志愿军的感激，我只能说，我要听从他们的劝告，不再犯这样的错误。</strong>”</p>
</blockquote>
<h2 id="这就是美国军队，都不会给自己的士兵一个基本的思想道德教育，反而要对手中国人民志愿军去教！"><a href="#这就是美国军队，都不会给自己的士兵一个基本的思想道德教育，反而要对手中国人民志愿军去教！" class="headerlink" title="这就是美国军队，都不会给自己的士兵一个基本的思想道德教育，反而要对手中国人民志愿军去教！"></a>这就是美国军队，都不会给自己的士兵一个基本的思想道德教育，反而要对手中国人民志愿军去教！</h2><h2 id="而美国军队，特别是抗美援朝是抓到的美军俘虏，来自各个部队、各个社会阶层，这是对美国人整体素质最好的抽样调查范例了："><a href="#而美国军队，特别是抗美援朝是抓到的美军俘虏，来自各个部队、各个社会阶层，这是对美国人整体素质最好的抽样调查范例了：" class="headerlink" title="而美国军队，特别是抗美援朝是抓到的美军俘虏，来自各个部队、各个社会阶层，这是对美国人整体素质最好的抽样调查范例了："></a>而美国军队，特别是抗美援朝是抓到的美军俘虏，来自各个部队、各个社会阶层，<strong>这是对美国人整体素质最好的抽样调查范例了：</strong></h2><blockquote>
<p>“一团千多人，一半美军一半英军。二团是李伪军。三团是美军，还有新近送来的。四团是军曹队，多是参谋人员、事务人员，年纪大，比较坏。二大队是军官队，英美的都在内，包括尉以上、校以下，最大的是上校，还有空军人员。细菌战犯另有地方安置。收容俘虏的地点在遂安有两个。五团是美俘、黑人、土耳其人、英军及部分附庸国的俘虏。分工是朝方管李伪俘，我们管外俘，李伪俘比较好教育。”</p>
</blockquote>
<p><strong>再延伸到当下美国疫情的乱象，公知大v口中所谓的“美国人高度自律”“高素质”都成了笑话。</strong></p>
<h2 id="而这一切，早在70年前就被中国人民志愿军看的清清楚楚。只不过公知美分横行，许多人被公知蒙蔽了。"><a href="#而这一切，早在70年前就被中国人民志愿军看的清清楚楚。只不过公知美分横行，许多人被公知蒙蔽了。" class="headerlink" title="而这一切，早在70年前就被中国人民志愿军看的清清楚楚。只不过公知美分横行，许多人被公知蒙蔽了。"></a><strong>而这一切，早在70年前就被中国人民志愿军看的清清楚楚。只不过公知美分横行，许多人被公知蒙蔽了。</strong></h2><p>同样，方方之流和当今网络乱象，也被70年前的文艺工作者看的清清楚楚。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/19/%E5%A6%82%E4%BD%95%E8%AF%84%E4%BB%B7%E6%96%B9%E6%96%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/19/%E5%A6%82%E4%BD%95%E8%AF%84%E4%BB%B7%E6%96%B9%E6%96%B9/" class="post-title-link" itemprop="url">如何评价方方</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-19 22:49:48 / Modified: 22:51:21" itemprop="dateCreated datePublished" datetime="2020-04-19T22:49:48-04:00">2020-04-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>作协极左监狱里关着3个人，他们彼此聊起坐牢的原因。</p>
<p>A：我支持斯大林，他们说我是极左。</p>
<p>B：我支持托洛茨基，他们说我是极左。</p>
<p>C：我支持东条英机，他们说我是极左。</p>
<p>AB：你支持二等兵，为什么还被说是极左？</p>
<p>C：我反对方方。</p>
<ul>
<li>…, 一名方方的支持者在公告栏的大字报中如是写到。</li>
<li>“东条内阁有赤化风险”</li>
<li>[惊喜]在方方眼里abc支持的是一路人</li>
<li>每当我搞不清楚自己的意识形态倾向，就去方方微博领一顶极左籍，腰也不酸了背也不疼了思想也不困惑了[惊喜]</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/18/%E5%A6%82%E4%BD%95%E7%9C%8B%E5%BE%85%E5%A5%BD%E5%A4%9A%E4%BA%BA%E9%83%BD%E8%BF%9B%E5%85%A5%E4%BA%86%E4%B8%96%E7%95%8C%E9%A1%B6%E5%B0%96%E5%A4%A7%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/18/%E5%A6%82%E4%BD%95%E7%9C%8B%E5%BE%85%E5%A5%BD%E5%A4%9A%E4%BA%BA%E9%83%BD%E8%BF%9B%E5%85%A5%E4%BA%86%E4%B8%96%E7%95%8C%E9%A1%B6%E5%B0%96%E5%A4%A7%E5%AD%A6/" class="post-title-link" itemprop="url">如何看待好多人都进入了世界顶尖大学</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-18 14:23:19 / Modified: 14:24:09" itemprop="dateCreated datePublished" datetime="2020-04-18T14:23:19-04:00">2020-04-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先是因为中国的内卷太严重了，我常和朋友戏称是无限竞争模式。为什么呢？但凡成绩好一些，经历过高考的人，回想高中的努力程度，都会多少脊背发凉。我也参加过高考，为了方便理解，换成750分制的高考省例如安徽/河北等，我的成绩应该是高于一本线100+分，基本上属于头部211，二线985的水平吧。而高中的我做了一件什么事呢？考完得知分数在家大哭了一场，因为确实是我考的最差的一次，我觉得自己是个loser，甚至想要复读，觉得再也没脸见我respect的同学们，现在分析一下当时可谓内卷本卷青少年。哪怕是正常发挥，无非也就是再高30分，去个Top10的985，怎么才能让当时的我满意呢？C9里的那七所吧，而我周围的很多同学，基本上也是和我一样的心态。后来出国，但凡去的学校比较OK的，我的本科同学一些也不太主动说自己就读的本科是哪里。觉得，害，没去C9至少也要去个天大/武大吧，自己这成绩只能算上过学，根本不足为外人道也。</p>
<p>直到有一天，我闲来无事，去查了查中国和外国以及北上的录取率对比，说老实话，那是我第一次客观认识到国内的残酷竞争。之前只是主观感觉太累了。澳洲本科录取来说，全澳洲本科最好的大学，悉尼大学/UNSW，如果是工程学的话，大概你的澳洲高考考到前7-8%就可以就读（往往实际录取要求更松一些），这在中国的绝大多数省，是一本线。大家没感觉，我这样直观描述一下：即，你考到一本线就有机会就读于清华大学计算机系。如果想要就读类似于北大光华管理学院这样半个院都是状元的最顶级学院，类似于国外的法学院，澳洲的commerce/law的双学位，实际上也就是国内普通985的录取难度，如果你能考取重庆大学，那么你在澳洲就能就读于类似北大光华的最顶级学院。我看有加拿大的写了清华和多大的录取率对比，在发达国家考上顶校的概率是中国的250倍，个人觉得有点夸张，但我觉得10-20倍是绝对有的。而北京、上海大概5倍左右，我耳闻有上海local问身边新人：你上海绿卡弄的怎么样了？</p>
<p>澳洲学校的本科，有录取中国高考“滑铁卢”学生的作用，比如悉尼大学，大部分省份一本线就可以就读，加上申请确实简单，很多考到一本的同学来读，其中当然也有一些考到211/985的同学来，大多是不喜欢自己原学校的专业。这些同学我认识的很多都成为了学校里比较顶级的选手。天津高考就读于某985的同学，悉尼大学本科first class毕业去了Yale，上财/西南财经本科转学来澳洲本科的honours毕业都去了Lse,暨南大学本科转学各种成绩Hd dean’s letter,中国药科大学转学来的直接变成男神，各种offer，如果想申请顶校也是易如反掌，还有很多师从大牛的本校Phd candidate，无一例外你会发现，他们只要在中国考上了985/211，在澳洲顶级学校本科，只要努力学习，专业前10%基本上问题不大。而专业前10%的出路大多非常非常好，哪怕没有去藤校/G5，佛系在澳洲读书，比如经济系里读Phd，很多学生基本上在导师的推荐下，也会毕业直接去澳洲央行做分析师。我看过他们的毕业后去向，不得不说真的都不错。一个和他们智商水平差不多的川大毕业生，去央行总行的概率是怎样的呢？去了全球top10学校回国后，他们很多人也会进入一线的互联网/金融公司等，周围的人很多都是清北复交里的佼佼者，其中滋味你们自己细品吧。</p>
<p>想起来再加一Part吧，有人说这是因为澳洲本就是留学链低端，行吧，我再举A level的例子吧，很多人是国际高中通过A Level来到我们学校的。A level悉尼大学本科录取基本上和Ucl冷门专业差不多，A level 每门考试的A率如果我没记错的话是大于5%的，全A申请G5这样QS能排到全球前十的还是稳的，基本上也就是等同于中国重庆大学的高考难度（注意是录取难度，非学校质量）。英本的申请难度不在于智商，而在于孩子父母的眼界和远超越一般家庭的财力。</p>
<p>尤其国内的朋友看完会说：就这？说明澳洲太垃圾了…我其实想说的是，其实是真的大家都已经很优秀了，只是没有足够的土壤和资源让大家成长。而导致了所谓的丧文化和佛系文化。留学对于大部分还算聪明的人来说，确实是一个很好的跳板，且越早出国，杠杆效应越大。比如无论在哪，都是本科生嫌弃学校里的研究生质量，但在出国这一part,在国内读出来的同学，单论智商，还真不一定是谁比谁强，毕竟我举了很多例子，如果一个高考还算优秀的人来读海本，基本上是碾压。但鄙视链总归是有内因的，这个内因已经不在个人能力上，而是在社会阶级上的，整体而言是越早出国家庭条件越好，而家庭资源的合理倾斜也给很多人更多的机会。</p>
<p>如果你是国内的一名同学，我希望你自信一些，其实你很好，如果你是一名海外读书的同学，我觉得大家不要再抱怨环境和歧视等，其实你已经获得了比国内同学多很多的机会。</p>
<p>这个世界，同样是工作八小时每天，有人日进斗金，有人月薪6000。智力上的差距有那么几何倍数的大吗？并没有，选择比努力重要太多。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/17/%E5%90%83%E7%89%9B%E8%82%89%E7%9A%84%E5%A5%BD%E5%A4%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/17/%E5%90%83%E7%89%9B%E8%82%89%E7%9A%84%E5%A5%BD%E5%A4%84/" class="post-title-link" itemprop="url">吃牛肉的好处</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-17 20:04:34 / Modified: 20:06:08" itemprop="dateCreated datePublished" datetime="2020-04-17T20:04:34-04:00">2020-04-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>主要是牛肉含有丰富的蛋白质，氨基酸组成比猪肉更接近人体需要，能提高机体抗病能力，对生长发育及手术后、病后调养的人在补充失血和修复组织等方面特别适宜。</p>
<p>寒冬食牛肉，有暖胃作用，为寒冬补益佳品。</p>
<p>中医认为：牛肉有补中益气、滋养脾胃、强健筋骨、化痰息风、止渴止涎的功能。适用于中气下陷、气短体虚，筋骨酸软和贫血久病及面黄目眩之人食用。</p>
<hr>
<h3 id="1-牛肉富含肌氨酸"><a href="#1-牛肉富含肌氨酸" class="headerlink" title="1.牛肉富含肌氨酸"></a>1.牛肉富含肌氨酸</h3><p>牛肉中的肌氨酸含量比任何其它食品都高，这使它对增长肌肉、增强力量特别有效。在进行训练的头几秒钟里，肌氨酸是肌肉燃料之源，它可以有效补充三磷酸腺苷，从而使训练能坚持得更久。</p>
<p>说人话：持久！</p>
<h3 id="2-牛肉含维生素B6"><a href="#2-牛肉含维生素B6" class="headerlink" title="2.牛肉含维生素B6"></a>2.牛肉含维生素B6</h3><p>蛋白质需求量越大，饮食中所应该增加的维生素B6就越多。牛肉含有足够的维生素B6，可帮你增强免疫力，促进蛋白质的新陈代谢和合成，从而有助于紧张训练后身体的恢复。</p>
<p>说人话：回血快！</p>
<h3 id="3-牛肉含肉毒碱"><a href="#3-牛肉含肉毒碱" class="headerlink" title="3.牛肉含肉毒碱"></a>3.牛肉含肉毒碱</h3><p>鸡肉、鱼肉中肉毒碱和肌氨酸的含量很低，牛肉却含量很高。肉毒碱主要用于支持脂肪的新陈代谢，产生支链氨基酸，是对健美运动员增长肌肉起重要作用的一种氨基酸。</p>
<p>说人话：大house都是其次，吃这个练一天顶699社畜吃鸡胸肉鸡蛋跑十天。</p>
<h3 id="4-肉含钾和蛋白质"><a href="#4-肉含钾和蛋白质" class="headerlink" title="4.肉含钾和蛋白质"></a>4.肉含钾和蛋白质</h3><p>钾是大多数运动员饮食中比较缺少的矿物质。钾的水平低会抑制蛋白质的合成以及生长激素的产生，从而影响肌肉的生长。牛肉中富含蛋白质：4盎司瘦里脊就可产生22克一流的蛋白质。</p>
<p>说人话：生长激素和蛋白质你识得？</p>
<h3 id="5-牛肉是亚油酸的低脂肪来源"><a href="#5-牛肉是亚油酸的低脂肪来源" class="headerlink" title="5.牛肉是亚油酸的低脂肪来源"></a>5.牛肉是亚油酸的低脂肪来源</h3><p>牛肉中脂肪含量很低，但却富含结合亚油酸，这些潜在的抗氧化剂可以有效对抗举重等运动中造成的组织损伤。另外，亚油酸还可以作为抗氧化剂保持肌肉块。</p>
<p>说人话：口感好，不长胖，不比你吃猪油包子，馒头配稀饭强？</p>
<p>人家壮阳吃牡蛎羊腿喝牛奶</p>
<p>699吃口烤韭菜都犹豫点两份耐吃还省钱</p>
<p>真有用西地那非早停产了。</p>
<h3 id="6-牛肉含锌、镁"><a href="#6-牛肉含锌、镁" class="headerlink" title="6.牛肉含锌、镁"></a>6.牛肉含锌、镁</h3><p>锌是另外一种有助于合成蛋白质、促进肌肉生长的抗氧化剂。锌与谷氨酸盐和维生素B6共同作用，能增强免疫系统。镁则支持蛋白质的合成、增强肌肉力量，更重要的是可提高胰岛素合成代谢的效率。</p>
<p>说人话：不仅块大，力量也强。蛋白粉这种东西能比？</p>
<hr>
<p>对于敌法师来说，吃牛肉和吃米饭一样便宜。那是人家有的选，</p>
<p>人在有得选的时候，</p>
<p>一切都好说，毕竟站着说话不腰疼，就算腰疼还能去做理疗呢，而理疗又有好多套餐可以选，一步小心选了个998的套餐呢？总之都不是事。</p>
<p>但一旦没得选，就要小心。鸽子笼都买不起，还想要大豪斯？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/16/JavaScript%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/16/JavaScript%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">JavaScript风格指南</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-16 02:12:59 / Modified: 02:13:46" itemprop="dateCreated datePublished" datetime="2020-04-16T02:12:59-04:00">2020-04-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JavaScript-风格指南"><a href="#JavaScript-风格指南" class="headerlink" title="JavaScript 风格指南"></a>JavaScript 风格指南</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><pre><code>1. [介绍](#介绍)
2. [变量](#变量)
3. [函数](#函数)
4. [对象和数据结构](#objects-and-data-structures)
5. [类](#类)
6. [测试](#测试)
7. [并发](#并发)
8. [错误处理](#错误处理)
9. [格式化](#格式化)
10. [注释](#注释)</code></pre><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a href="https://github.com/ryanmcdermott" target="_blank" rel="noopener">作者</a>根据 Robert C. Martin <a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882" target="_blank" rel="noopener"><em>《代码整洁之道》</em></a>总结了适用于 JavaScript 的软件工程原则<a href="https://github.com/ryanmcdermott/clean-code-javascript" target="_blank" rel="noopener">《Clean Code JavaScript》</a>。</p>
<p>本文是对其的翻译。</p>
<p>不必严格遵守本文的所有原则，有时少遵守一些效果可能会更好，具体应根据实际情况决定。这是根据《代码整洁之道》作者多年经验整理的代码优化建议，但也仅仅只是一份建议。</p>
<p>软件工程已经发展了 50 多年，至今仍在不断前进。现在，把这些原则当作试金石，尝试将他们作为团队代码质量考核的标准之一吧。</p>
<p>最后你需要知道的是，这些东西不会让你立刻变成一个优秀的工程师，长期奉行他们也并不意味着你能够高枕无忧不再犯错。千里之行，始于足下。我们需要时常和同行们进行代码评审，不断优化自己的代码。不要惧怕改善代码质量所需付出的努力，加油。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a><strong>变量</strong></h2><h3 id="使用有意义，可读性好的变量名"><a href="#使用有意义，可读性好的变量名" class="headerlink" title="使用有意义，可读性好的变量名"></a>使用有意义，可读性好的变量名</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> yyyymmdstr = moment().format(<span class="string">'YYYY/MM/DD'</span>);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> yearMonthDay = moment().format(<span class="string">'YYYY/MM/DD'</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="使用-ES6-的-const-定义常量"><a href="#使用-ES6-的-const-定义常量" class="headerlink" title="使用 ES6 的 const 定义常量"></a>使用 ES6 的 const 定义常量</h3><p>反例中使用”var”定义的”常量”是可变的。</p>
<p>在声明一个常量时，该常量在整个程序中都应该是不可变的。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FIRST_US_PRESIDENT = <span class="string">"George Washington"</span>;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> FIRST_US_PRESIDENT = <span class="string">"George Washington"</span>;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="对功能类似的变量名采用统一的命名风格"><a href="#对功能类似的变量名采用统一的命名风格" class="headerlink" title="对功能类似的变量名采用统一的命名风格"></a>对功能类似的变量名采用统一的命名风格</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getUserInfo();</span><br><span class="line">getClientData();</span><br><span class="line">getCustomerRecord();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getUser();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="使用易于检索名称"><a href="#使用易于检索名称" class="headerlink" title="使用易于检索名称"></a>使用易于检索名称</h3><p>我们需要阅读的代码远比自己写的要多，使代码拥有良好的可读性且易于检索非常重要。阅读变量名晦涩难懂的代码对读者来说是一种相当糟糕的体验。<br>让你的变量名易于检索。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 525600 是什么?</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">525600</span>; i++) &#123;</span><br><span class="line">  runCronJob();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declare them as capitalized `var` globals.</span></span><br><span class="line"><span class="keyword">var</span> MINUTES_IN_A_YEAR = <span class="number">525600</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; MINUTES_IN_A_YEAR; i++) &#123;</span><br><span class="line">  runCronJob();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="使用说明变量-即有意义的变量名"><a href="#使用说明变量-即有意义的变量名" class="headerlink" title="使用说明变量(即有意义的变量名)"></a>使用说明变量(即有意义的变量名)</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cityStateRegex = <span class="regexp">/^(.+)[,\\s]+(.+?)\s*(\d&#123;5&#125;)?$/</span>;</span><br><span class="line">saveCityState(cityStateRegex.match(cityStateRegex)[<span class="number">1</span>], cityStateRegex.match(cityStateRegex)[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ADDRESS = <span class="string">'One Infinite Loop, Cupertino 95014'</span>;</span><br><span class="line"><span class="keyword">var</span> cityStateRegex = <span class="regexp">/^(.+)[,\\s]+(.+?)\s*(\d&#123;5&#125;)?$/</span>;</span><br><span class="line"><span class="keyword">var</span> match = ADDRESS.match(cityStateRegex)</span><br><span class="line"><span class="keyword">var</span> city = match[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> state = match[<span class="number">2</span>];</span><br><span class="line">saveCityState(city, state);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="不要绕太多的弯子"><a href="#不要绕太多的弯子" class="headerlink" title="不要绕太多的弯子"></a>不要绕太多的弯子</h3><p>显式优于隐式。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> locations = [<span class="string">'Austin'</span>, <span class="string">'New York'</span>, <span class="string">'San Francisco'</span>];</span><br><span class="line">locations.forEach(<span class="function">(<span class="params">l</span>) =&gt;</span> &#123;</span><br><span class="line">  doStuff();</span><br><span class="line">  doSomeOtherStuff();</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// l是什么？</span></span><br><span class="line">  dispatch(l);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> locations = [<span class="string">'Austin'</span>, <span class="string">'New York'</span>, <span class="string">'San Francisco'</span>];</span><br><span class="line">locations.forEach(<span class="function">(<span class="params">location</span>) =&gt;</span> &#123;</span><br><span class="line">  doStuff();</span><br><span class="line">  doSomeOtherStuff();</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  dispatch(location);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免重复的描述"><a href="#避免重复的描述" class="headerlink" title="避免重复的描述"></a>避免重复的描述</h3><p>当类/对象名已经有意义时，对其变量进行命名不需要再次重复。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Car = &#123;</span><br><span class="line">  carMake: <span class="string">'Honda'</span>,</span><br><span class="line">  carModel: <span class="string">'Accord'</span>,</span><br><span class="line">  carColor: <span class="string">'Blue'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">paintCar</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">  car.carColor = <span class="string">'Red'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Car = &#123;</span><br><span class="line">  make: <span class="string">'Honda'</span>,</span><br><span class="line">  model: <span class="string">'Accord'</span>,</span><br><span class="line">  color: <span class="string">'Blue'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">paintCar</span>(<span class="params">car</span>) </span>&#123;</span><br><span class="line">  car.color = <span class="string">'Red'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免无意义的条件判断"><a href="#避免无意义的条件判断" class="headerlink" title="避免无意义的条件判断"></a>避免无意义的条件判断</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMicrobrewery</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> breweryName;</span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    breweryName = name;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    breweryName = <span class="string">'Hipster Brew Co.'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMicrobrewery</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> breweryName = name || <span class="string">'Hipster Brew Co.'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a><strong>函数</strong></h2><h3 id="函数参数-理想情况下应不超过-2-个"><a href="#函数参数-理想情况下应不超过-2-个" class="headerlink" title="函数参数 (理想情况下应不超过 2 个)"></a>函数参数 (理想情况下应不超过 2 个)</h3><p>限制函数参数数量很有必要，这么做使得在测试函数时更加轻松。过多的参数将导致难以采用有效的测试用例对函数的各个参数进行测试。</p>
<p>应避免三个以上参数的函数。通常情况下，参数超过两个意味着函数功能过于复杂，这时需要重新优化你的函数。当确实需要多个参数时，大多情况下可以考虑这些参数封装成一个对象。</p>
<p>JS 定义对象非常方便，当需要多个参数时，可以使用一个对象进行替代。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">title, body, buttonText, cancellable</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menuConfig = &#123;</span><br><span class="line">  title: <span class="string">'Foo'</span>,</span><br><span class="line">  body: <span class="string">'Bar'</span>,</span><br><span class="line">  buttonText: <span class="string">'Baz'</span>,</span><br><span class="line">  cancellable: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">menuConfig</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="函数功能的单一性"><a href="#函数功能的单一性" class="headerlink" title="函数功能的单一性"></a>函数功能的单一性</h3><p>这是软件功能中最重要的原则之一。</p>
<p>功能不单一的函数将导致难以重构、测试和理解。功能单一的函数易于重构，并使代码更加干净。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClients</span>(<span class="params">clients</span>) </span>&#123;</span><br><span class="line">  clients.forEach(<span class="function"><span class="params">client</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> clientRecord = database.lookup(client);</span><br><span class="line">    <span class="keyword">if</span> (clientRecord.isActive()) &#123;</span><br><span class="line">      email(client);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClients</span>(<span class="params">clients</span>) </span>&#123;</span><br><span class="line">  clients.forEach(<span class="function"><span class="params">client</span> =&gt;</span> &#123;</span><br><span class="line">    emailClientIfNeeded(client);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClientIfNeeded</span>(<span class="params">client</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isClientActive(client)) &#123;</span><br><span class="line">    email(client);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isClientActive</span>(<span class="params">client</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> clientRecord = database.lookup(client);</span><br><span class="line">  <span class="keyword">return</span> clientRecord.isActive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="函数名应明确表明其功能"><a href="#函数名应明确表明其功能" class="headerlink" title="函数名应明确表明其功能"></a>函数名应明确表明其功能</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dateAdd</span>(<span class="params">date, month</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 很难理解dateAdd(date, 1)是什么意思</span></span><br><span class="line">dateAdd(date, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dateAddMonth</span>(<span class="params">date, month</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">dateAddMonth(date, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="函数应该只做一层抽象"><a href="#函数应该只做一层抽象" class="headerlink" title="函数应该只做一层抽象"></a>函数应该只做一层抽象</h3><p>当函数的需要的抽象多于一层时通常意味着函数功能过于复杂，需将其进行分解以提高其可重用性和可测试性。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseBetterJSAlternative</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> REGEXES = [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> statements = code.split(<span class="string">' '</span>);</span><br><span class="line">  <span class="keyword">let</span> tokens;</span><br><span class="line">  REGEXES.forEach(<span class="function">(<span class="params">REGEX</span>) =&gt;</span> &#123;</span><br><span class="line">    statements.forEach(<span class="function">(<span class="params">statement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ast;</span><br><span class="line">  tokens.forEach(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lex...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ast.forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// parse...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenize</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> REGEXES = [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> statements = code.split(<span class="string">' '</span>);</span><br><span class="line">  <span class="keyword">let</span> tokens;</span><br><span class="line">  REGEXES.forEach(<span class="function">(<span class="params">REGEX</span>) =&gt;</span> &#123;</span><br><span class="line">    statements.forEach(<span class="function">(<span class="params">statement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> tokens;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lexer</span>(<span class="params">tokens</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ast;</span><br><span class="line">  tokens.forEach(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lex...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseBetterJSAlternative</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> tokens = tokenize(code);</span><br><span class="line">  <span class="keyword">let</span> ast = lexer(tokens);</span><br><span class="line">  ast.forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// parse...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="移除重复的代码"><a href="#移除重复的代码" class="headerlink" title="移除重复的代码"></a>移除重复的代码</h3><p>永远、永远、永远不要在任何循环下有重复的代码。</p>
<p>这种做法毫无意义且潜在危险极大。重复的代码意味着逻辑变化时需要对不止一处进行修改。JS 弱类型的特点使得函数拥有更强的普适性。好好利用这一优点吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showDeveloperList</span>(<span class="params">developers</span>) </span>&#123;</span><br><span class="line">  developers.forEach(<span class="function"><span class="params">developer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expectedSalary = developer.calculateExpectedSalary();</span><br><span class="line">    <span class="keyword">var</span> experience = developer.getExperience();</span><br><span class="line">    <span class="keyword">var</span> githubLink = developer.getGithubLink();</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">      expectedSalary: expectedSalary,</span><br><span class="line">      experience: experience,</span><br><span class="line">      githubLink: githubLink</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showManagerList</span>(<span class="params">managers</span>) </span>&#123;</span><br><span class="line">  managers.forEach(<span class="function"><span class="params">manager</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expectedSalary = manager.calculateExpectedSalary();</span><br><span class="line">    <span class="keyword">var</span> experience = manager.getExperience();</span><br><span class="line">    <span class="keyword">var</span> portfolio = manager.getMBAProjects();</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">      expectedSalary: expectedSalary,</span><br><span class="line">      experience: experience,</span><br><span class="line">      portfolio: portfolio</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showList</span>(<span class="params">employees</span>) </span>&#123;</span><br><span class="line">  employees.forEach(<span class="function"><span class="params">employee</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expectedSalary = employee.calculateExpectedSalary();</span><br><span class="line">    <span class="keyword">var</span> experience = employee.getExperience();</span><br><span class="line">    <span class="keyword">var</span> portfolio;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (employee.type === <span class="string">'manager'</span>) &#123;</span><br><span class="line">      portfolio = employee.getMBAProjects();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      portfolio = employee.getGithubLink();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">      expectedSalary: expectedSalary,</span><br><span class="line">      experience: experience,</span><br><span class="line">      portfolio: portfolio</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="采用默认参数精简代码"><a href="#采用默认参数精简代码" class="headerlink" title="采用默认参数精简代码"></a>采用默认参数精简代码</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeForumComment</span>(<span class="params">subject, body</span>) </span>&#123;</span><br><span class="line">  subject = subject || <span class="string">'No Subject'</span>;</span><br><span class="line">  body = body || <span class="string">'No text'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeForumComment</span>(<span class="params">subject = <span class="string">'No subject'</span>, body = <span class="string">'No text'</span></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="使用-Object-assign-设置默认对象"><a href="#使用-Object-assign-设置默认对象" class="headerlink" title="使用 Object.assign 设置默认对象"></a>使用 Object.assign 设置默认对象</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menuConfig = &#123;</span><br><span class="line">  title: <span class="literal">null</span>,</span><br><span class="line">  body: <span class="string">'Bar'</span>,</span><br><span class="line">  buttonText: <span class="literal">null</span>,</span><br><span class="line">  cancellable: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.title = config.title || <span class="string">'Foo'</span></span><br><span class="line">  config.body = config.body || <span class="string">'Bar'</span></span><br><span class="line">  config.buttonText = config.buttonText || <span class="string">'Baz'</span></span><br><span class="line">  config.cancellable = config.cancellable === <span class="literal">undefined</span> ? config.cancellable : <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(menuConfig);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menuConfig = &#123;</span><br><span class="line">  title: <span class="string">'Order'</span>,</span><br><span class="line">  <span class="comment">// User did not include 'body' key</span></span><br><span class="line">  buttonText: <span class="string">'Send'</span>,</span><br><span class="line">  cancellable: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">    title: <span class="string">'Foo'</span>,</span><br><span class="line">    body: <span class="string">'Bar'</span>,</span><br><span class="line">    buttonText: <span class="string">'Baz'</span>,</span><br><span class="line">    cancellable: <span class="literal">true</span></span><br><span class="line">  &#125;, config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// config now equals: &#123;title: "Order", body: "Bar", buttonText: "Send", cancellable: true&#125;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createMenu(menuConfig);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="不要使用标记-Flag-作为函数参数"><a href="#不要使用标记-Flag-作为函数参数" class="headerlink" title="不要使用标记(Flag)作为函数参数"></a>不要使用标记(Flag)作为函数参数</h3><p>这通常意味着函数的功能的单一性已经被破坏。此时应考虑对函数进行再次划分。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">name, temp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">    fs.create(<span class="string">'./temp/'</span> + name);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fs.create(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTempFile</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  fs.create(<span class="string">'./temp/'</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  fs.create(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免副作用"><a href="#避免副作用" class="headerlink" title="避免副作用"></a>避免副作用</h3><p>当函数产生了除了“接受一个值并返回一个结果”之外的行为时，称该函数产生了副作用。比如写文件、修改全局变量或将你的钱全转给了一个陌生人等。</p>
<p>程序在某些情况下确实需要副作用这一行为，如先前例子中的写文件。这时应该将这些功能集中在一起，不要用多个函数/类修改某个文件。用且只用一个 service 完成这一需求。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Global variable referenced by following function.</span></span><br><span class="line"><span class="comment">// If we had another function that used this name, now it'd be an array and it could break it.</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'Ryan McDermott'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitIntoFirstAndLastName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  name = name.split(<span class="string">' '</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">splitIntoFirstAndLastName();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// ['Ryan', 'McDermott'];</span></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitIntoFirstAndLastName</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> name.split(<span class="string">' '</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'Ryan McDermott'</span></span><br><span class="line"><span class="keyword">var</span> newName = splitIntoFirstAndLastName(name);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// 'Ryan McDermott';</span></span><br><span class="line"><span class="built_in">console</span>.log(newName); <span class="comment">// ['Ryan', 'McDermott'];</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="不要写全局函数"><a href="#不要写全局函数" class="headerlink" title="不要写全局函数"></a>不要写全局函数</h3><p>在 JS 中污染全局是一个非常不好的实践，这么做可能和其他库起冲突，且调用你的 API 的用户在实际环境中得到一个 exception 前对这一情况是一无所知的。</p>
<p>想象以下例子：如果你想扩展 JS 中的 Array，为其添加一个 <code>diff</code> 函数显示两个数组间的差异，此时应如何去做？你可以将 diff 写入 <code>Array.prototype</code>，但这么做会和其他有类似需求的库造成冲突。如果另一个库对 diff 的需求为比较一个数组中首尾元素间的差异呢？</p>
<p>使用 ES6 中的 class 对全局的 Array 做简单的扩展显然是一个更棒的选择。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.diff = <span class="function"><span class="keyword">function</span>(<span class="params">comparisonArray</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> values = [];</span><br><span class="line">  <span class="keyword">var</span> hash = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> comparisonArray) &#123;</span><br><span class="line">    hash[i] = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!hash[i]) &#123;</span><br><span class="line">      values.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> values;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperArray</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(...args) &#123;</span><br><span class="line">    <span class="keyword">super</span>(...args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  diff(comparisonArray) &#123;</span><br><span class="line">    <span class="keyword">var</span> values = [];</span><br><span class="line">    <span class="keyword">var</span> hash = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> comparisonArray) &#123;</span><br><span class="line">      hash[i] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!hash[i]) &#123;</span><br><span class="line">        values.push(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> values;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="采用函数式编程"><a href="#采用函数式编程" class="headerlink" title="采用函数式编程"></a>采用函数式编程</h3><p>函数式的编程具有更干净且便于测试的特点。尽可能的使用这种风格吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> programmerOutput = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Uncle Bobby'</span>,</span><br><span class="line">    linesOfCode: <span class="number">500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: <span class="string">'Suzie Q'</span>,</span><br><span class="line">    linesOfCode: <span class="number">1500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: <span class="string">'Jimmy Gosling'</span>,</span><br><span class="line">    linesOfCode: <span class="number">150</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: <span class="string">'Gracie Hopper'</span>,</span><br><span class="line">    linesOfCode: <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> totalOutput = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; programmerOutput.length; i++) &#123;</span><br><span class="line">  totalOutput += programmerOutput[i].linesOfCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> programmerOutput = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'Uncle Bobby'</span>,</span><br><span class="line">    linesOfCode: <span class="number">500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: <span class="string">'Suzie Q'</span>,</span><br><span class="line">    linesOfCode: <span class="number">1500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: <span class="string">'Jimmy Gosling'</span>,</span><br><span class="line">    linesOfCode: <span class="number">150</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: <span class="string">'Gracie Hopper'</span>,</span><br><span class="line">    linesOfCode: <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> totalOutput = programmerOutput</span><br><span class="line">  .map(<span class="function">(<span class="params">programmer</span>) =&gt;</span> programmer.linesOfCode)</span><br><span class="line">  .reduce(<span class="function">(<span class="params">acc, linesOfCode</span>) =&gt;</span> acc + linesOfCode, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="封装判断条件"><a href="#封装判断条件" class="headerlink" title="封装判断条件"></a>封装判断条件</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fsm.state === <span class="string">'fetching'</span> &amp;&amp; isEmpty(listNode)) &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shouldShowSpinner</span>(<span class="params">fsm, listNode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fsm.state === <span class="string">'fetching'</span> &amp;&amp; isEmpty(listNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (shouldShowSpinner(fsmInstance, listNodeInstance)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免“否定情况”的判断"><a href="#避免“否定情况”的判断" class="headerlink" title="避免“否定情况”的判断"></a>避免“否定情况”的判断</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDOMNodeNotPresent</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!isDOMNodeNotPresent(node)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDOMNodePresent</span>(<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (isDOMNodePresent(node)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免条件判断"><a href="#避免条件判断" class="headerlink" title="避免条件判断"></a>避免条件判断</h3><p>这看起来似乎不太可能。</p>
<p>大多人听到这的第一反应是：“怎么可能不用 if 完成其他功能呢？”许多情况下通过使用多态(polymorphism)可以达到同样的目的。</p>
<p>第二个问题在于采用这种方式的原因是什么。答案是我们之前提到过的：保持函数功能的单一性。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  getCruisingAltitude() &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">this</span>.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'777'</span>:</span><br><span class="line">        <span class="keyword">return</span> getMaxAltitude() - getPassengerCount();</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Air Force One'</span>:</span><br><span class="line">        <span class="keyword">return</span> getMaxAltitude();</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Cessna'</span>:</span><br><span class="line">        <span class="keyword">return</span> getMaxAltitude() - getFuelExpenditure();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boeing777</span> <span class="keyword">extends</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  getCruisingAltitude() &#123;</span><br><span class="line">    <span class="keyword">return</span> getMaxAltitude() - getPassengerCount();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirForceOne</span> <span class="keyword">extends</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  getCruisingAltitude() &#123;</span><br><span class="line">    <span class="keyword">return</span> getMaxAltitude();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cessna</span> <span class="keyword">extends</span> <span class="title">Airplane</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  getCruisingAltitude() &#123;</span><br><span class="line">    <span class="keyword">return</span> getMaxAltitude() - getFuelExpenditure();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免类型判断-part-1"><a href="#避免类型判断-part-1" class="headerlink" title="避免类型判断(part 1)"></a>避免类型判断(part 1)</h3><p>JS 是弱类型语言，这意味着函数可接受任意类型的参数。</p>
<p>有时这会对你带来麻烦，你会对参数做一些类型判断。有许多方法可以避免这些情况。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">travelToTexas</span>(<span class="params">vehicle</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (vehicle <span class="keyword">instanceof</span> Bicycle) &#123;</span><br><span class="line">    vehicle.peddle(<span class="keyword">this</span>.currentLocation, <span class="keyword">new</span> Location(<span class="string">'texas'</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vehicle <span class="keyword">instanceof</span> Car) &#123;</span><br><span class="line">    vehicle.drive(<span class="keyword">this</span>.currentLocation, <span class="keyword">new</span> Location(<span class="string">'texas'</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">travelToTexas</span>(<span class="params">vehicle</span>) </span>&#123;</span><br><span class="line">  vehicle.move(<span class="keyword">this</span>.currentLocation, <span class="keyword">new</span> Location(<span class="string">'texas'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免类型判断-part-2"><a href="#避免类型判断-part-2" class="headerlink" title="避免类型判断(part 2)"></a>避免类型判断(part 2)</h3><p>如果需处理的数据为字符串，整型，数组等类型，无法使用多态并仍有必要对其进行类型检测时，可以考虑使用 TypeScript。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">val1, val2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> val1 == <span class="string">"number"</span> &amp;&amp; <span class="keyword">typeof</span> val2 == <span class="string">"number"</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> val1 == <span class="string">"string"</span> &amp;&amp; <span class="keyword">typeof</span> val2 == <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> val1 + val2;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Must be of type String or Number'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">val1, val2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val1 + val2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免过度优化"><a href="#避免过度优化" class="headerlink" title="避免过度优化"></a>避免过度优化</h3><p>现代的浏览器在运行时会对代码自动进行优化。有时人为对代码进行优化可能是在浪费时间。</p>
<p><a href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers" target="_blank" rel="noopener">这里可以找到许多真正需要优化的地方</a></p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里使用变量len是因为在老式浏览器中，</span></span><br><span class="line"><span class="comment">// 直接使用正例中的方式会导致每次循环均重复计算list.length的值，</span></span><br><span class="line"><span class="comment">// 而在现代浏览器中会自动完成优化，这一行为是没有必要的</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = list.length; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="删除无效的代码"><a href="#删除无效的代码" class="headerlink" title="删除无效的代码"></a>删除无效的代码</h3><p>不再被调用的代码应及时删除。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">oldRequestModule</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newRequestModule</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = newRequestModule;</span><br><span class="line">inventoryTracker(<span class="string">'apples'</span>, req, <span class="string">'www.inventory-awesome.io'</span>);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newRequestModule</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = newRequestModule;</span><br><span class="line">inventoryTracker(<span class="string">'apples'</span>, req, <span class="string">'www.inventory-awesome.io'</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="对象和数据结构"><a href="#对象和数据结构" class="headerlink" title="对象和数据结构"></a><strong>对象和数据结构</strong></h2><h3 id="使用-getters-和-setters"><a href="#使用-getters-和-setters" class="headerlink" title="使用 getters 和 setters"></a>使用 getters 和 setters</h3><p>JS 没有接口或类型，因此实现这一模式是很困难的，因为我们并没有类似 <code>public</code> 和 <code>private</code> 的关键词。</p>
<p>然而，使用 getters 和 setters 获取对象的数据远比直接使用点操作符具有优势。为什么呢？</p>
<ol>
<li>当需要对获取的对象属性执行额外操作时。</li>
<li>执行 <code>set</code> 时可以增加规则对要变量的合法性进行判断。</li>
<li>封装了内部逻辑。</li>
<li>在存取时可以方便的增加日志和错误处理。</li>
<li>继承该类时可以重载默认行为。</li>
<li>从服务器获取数据时可以进行懒加载。</li>
</ol>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">	   <span class="keyword">this</span>.balance = <span class="number">1000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bankAccount = <span class="keyword">new</span> BankAccount();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buy shoes...</span></span><br><span class="line">bankAccount.balance = bankAccount.balance - <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">	   <span class="keyword">this</span>.balance = <span class="number">1000</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// It doesn't have to be prefixed with `get` or `set` to be a getter/setter</span></span><br><span class="line">  withdraw(amount) &#123;</span><br><span class="line">  	<span class="keyword">if</span> (verifyAmountCanBeDeducted(amount)) &#123;</span><br><span class="line">  	  <span class="keyword">this</span>.balance -= amount;</span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bankAccount = <span class="keyword">new</span> BankAccount();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buy shoes...</span></span><br><span class="line">bankAccount.withdraw(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="让对象拥有私有成员"><a href="#让对象拥有私有成员" class="headerlink" title="让对象拥有私有成员"></a>让对象拥有私有成员</h3><p>可以通过闭包完成</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Employee = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> employee = <span class="keyword">new</span> Employee(<span class="string">'John Doe'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Employee name: '</span> + employee.getName()); <span class="comment">// Employee name: John Doe</span></span><br><span class="line"><span class="keyword">delete</span> employee.name;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Employee name: '</span> + employee.getName()); <span class="comment">// Employee name: undefined</span></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Employee = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Employee;</span><br><span class="line">&#125;());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> employee = <span class="keyword">new</span> Employee(<span class="string">'John Doe'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Employee name: '</span> + employee.getName()); <span class="comment">// Employee name: John Doe</span></span><br><span class="line"><span class="keyword">delete</span> employee.name;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Employee name: '</span> + employee.getName()); <span class="comment">// Employee name: John Doe</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a><strong>类</strong></h2><h3 id="单一职责原则-SRP"><a href="#单一职责原则-SRP" class="headerlink" title="单一职责原则 (SRP)"></a>单一职责原则 (SRP)</h3><p>如《代码整洁之道》一书中所述，“修改一个类的理由不应该超过一个”。</p>
<p>将多个功能塞进一个类的想法很诱人，但这将导致你的类无法达到概念上的内聚，并经常不得不进行修改。</p>
<p>最小化对一个类需要修改的次数是非常有必要的。如果一个类具有太多太杂的功能，当你对其中一小部分进行修改时，将很难想象到这一修够对代码库中依赖该类的其他模块会带来什么样的影响。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSettings</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(user) &#123;</span><br><span class="line">    <span class="keyword">this</span>.user = user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  changeSettings(settings) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.verifyCredentials(user)) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  verifyCredentials(user) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAuth</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(user) &#123;</span><br><span class="line">    <span class="keyword">this</span>.user = user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  verifyCredentials() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSettings</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(user) &#123;</span><br><span class="line">    <span class="keyword">this</span>.user = user;</span><br><span class="line">    <span class="keyword">this</span>.auth = <span class="keyword">new</span> UserAuth(user)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  changeSettings(settings) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.auth.verifyCredentials()) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="开-闭原则-OCP"><a href="#开-闭原则-OCP" class="headerlink" title="开/闭原则 (OCP)"></a>开/闭原则 (OCP)</h3><p>“代码实体(类，模块，函数等)应该易于扩展，难于修改。”</p>
<p>这一原则指的是我们应允许用户方便的扩展我们代码模块的功能，而不需要打开 js 文件源码手动对其进行修改。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxRequester</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// What if we wanted another HTTP Method, like DELETE? We would have to</span></span><br><span class="line">    <span class="comment">// open this file up and modify this and put it in manually.</span></span><br><span class="line">    <span class="keyword">this</span>.HTTP_METHODS = [<span class="string">'POST'</span>, <span class="string">'PUT'</span>, <span class="string">'GET'</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span>(url) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxRequester</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.HTTP_METHODS = [<span class="string">'POST'</span>, <span class="string">'PUT'</span>, <span class="string">'GET'</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span>(url) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addHTTPMethod(method) &#123;</span><br><span class="line">    <span class="keyword">this</span>.HTTP_METHODS.push(method);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="利斯科夫替代原则-LSP"><a href="#利斯科夫替代原则-LSP" class="headerlink" title="利斯科夫替代原则 (LSP)"></a>利斯科夫替代原则 (LSP)</h3><p>“子类对象应该能够替换其超类对象被使用”。</p>
<p>也就是说，如果有一个父类和一个子类，当采用子类替换父类时不应该产生错误的结果。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.width = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.height = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setColor(color) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render(area) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setWidth(width) &#123;</span><br><span class="line">    <span class="keyword">this</span>.width = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setHeight(height) &#123;</span><br><span class="line">    <span class="keyword">this</span>.height = height;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getArea() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.width * <span class="keyword">this</span>.height;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setWidth(width) &#123;</span><br><span class="line">    <span class="keyword">this</span>.width = width;</span><br><span class="line">    <span class="keyword">this</span>.height = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setHeight(height) &#123;</span><br><span class="line">    <span class="keyword">this</span>.width = height;</span><br><span class="line">    <span class="keyword">this</span>.height = height;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLargeRectangles</span>(<span class="params">rectangles</span>) </span>&#123;</span><br><span class="line">  rectangles.forEach(<span class="function">(<span class="params">rectangle</span>) =&gt;</span> &#123;</span><br><span class="line">    rectangle.setWidth(<span class="number">4</span>);</span><br><span class="line">    rectangle.setHeight(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> area = rectangle.getArea(); <span class="comment">// BAD: Will return 25 for Square. Should be 20.</span></span><br><span class="line">    rectangle.render(area);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rectangles = [<span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Square()];</span><br><span class="line">renderLargeRectangles(rectangles);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  setColor(color) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render(area) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.width = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.height = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setWidth(width) &#123;</span><br><span class="line">    <span class="keyword">this</span>.width = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setHeight(height) &#123;</span><br><span class="line">    <span class="keyword">this</span>.height = height;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getArea() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.width * <span class="keyword">this</span>.height;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.length = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setLength(length) &#123;</span><br><span class="line">    <span class="keyword">this</span>.length = length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getArea() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLargeShapes</span>(<span class="params">shapes</span>) </span>&#123;</span><br><span class="line">  shapes.forEach(<span class="function">(<span class="params">shape</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (shape.constructor.name) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Square'</span>:</span><br><span class="line">        shape.setLength(<span class="number">5</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'Rectangle'</span>:</span><br><span class="line">        shape.setWidth(<span class="number">4</span>);</span><br><span class="line">        shape.setHeight(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> area = shape.getArea();</span><br><span class="line">    shape.render(area);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> shapes = [<span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Square()];</span><br><span class="line">renderLargeShapes(shapes);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="接口隔离原则-ISP"><a href="#接口隔离原则-ISP" class="headerlink" title="接口隔离原则 (ISP)"></a>接口隔离原则 (ISP)</h3><p>“客户端不应该依赖它不需要的接口；一个类对另一个类的依赖应该建立在最小的接口上。”</p>
<p>在 JS 中，当一个类需要许多参数设置才能生成一个对象时，或许大多时候不需要设置这么多的参数。此时减少对配置参数数量的需求是有益的。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DOMTraverser</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(settings) &#123;</span><br><span class="line">    <span class="keyword">this</span>.settings = settings;</span><br><span class="line">    <span class="keyword">this</span>.setup();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">this</span>.rootNode = <span class="keyword">this</span>.settings.rootNode;</span><br><span class="line">    <span class="keyword">this</span>.animationModule.setup();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  traverse() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> $ = <span class="keyword">new</span> DOMTraverser(&#123;</span><br><span class="line">  rootNode: <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>),</span><br><span class="line">  animationModule: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// Most of the time, we won't need to animate when traversing.</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DOMTraverser</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(settings) &#123;</span><br><span class="line">    <span class="keyword">this</span>.settings = settings;</span><br><span class="line">    <span class="keyword">this</span>.options = settings.options;</span><br><span class="line">    <span class="keyword">this</span>.setup();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">this</span>.rootNode = <span class="keyword">this</span>.settings.rootNode;</span><br><span class="line">    <span class="keyword">this</span>.setupOptions();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setupOptions() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.options.animationModule) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  traverse() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> $ = <span class="keyword">new</span> DOMTraverser(&#123;</span><br><span class="line">  rootNode: <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>),</span><br><span class="line">  options: &#123;</span><br><span class="line">    animationModule: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="依赖反转原则-DIP"><a href="#依赖反转原则-DIP" class="headerlink" title="依赖反转原则 (DIP)"></a>依赖反转原则 (DIP)</h3><p>该原则有两个核心点：</p>
<ol>
<li>高层模块不应该依赖于低层模块。他们都应该依赖于抽象接口。</li>
<li>抽象接口应该脱离具体实现，具体实现应该依赖于抽象接口。</li>
</ol>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryTracker</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(items) &#123;</span><br><span class="line">    <span class="keyword">this</span>.items = items;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BAD: We have created a dependency on a specific request implementation.</span></span><br><span class="line">    <span class="comment">// We should just have requestItems depend on a request method: `request`</span></span><br><span class="line">    <span class="keyword">this</span>.requester = <span class="keyword">new</span> InventoryRequester();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  requestItems() &#123;</span><br><span class="line">    <span class="keyword">this</span>.items.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.requester.requestItem(item);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryRequester</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.REQ_METHODS = [<span class="string">'HTTP'</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  requestItem(item) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> inventoryTracker = <span class="keyword">new</span> InventoryTracker([<span class="string">'apples'</span>, <span class="string">'bananas'</span>]);</span><br><span class="line">inventoryTracker.requestItems();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryTracker</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(items, requester) &#123;</span><br><span class="line">    <span class="keyword">this</span>.items = items;</span><br><span class="line">    <span class="keyword">this</span>.requester = requester;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  requestItems() &#123;</span><br><span class="line">    <span class="keyword">this</span>.items.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.requester.requestItem(item);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryRequesterV1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.REQ_METHODS = [<span class="string">'HTTP'</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  requestItem(item) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InventoryRequesterV2</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.REQ_METHODS = [<span class="string">'WS'</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  requestItem(item) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// By constructing our dependencies externally and injecting them, we can easily</span></span><br><span class="line"><span class="comment">// substitute our request module for a fancy new one that uses WebSockets.</span></span><br><span class="line"><span class="keyword">let</span> inventoryTracker = <span class="keyword">new</span> InventoryTracker([<span class="string">'apples'</span>, <span class="string">'bananas'</span>], <span class="keyword">new</span> InventoryRequesterV2());</span><br><span class="line">inventoryTracker.requestItems();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="使用-ES6-的-classes-而不是-ES5-的-Function"><a href="#使用-ES6-的-classes-而不是-ES5-的-Function" class="headerlink" title="使用 ES6 的 classes 而不是 ES5 的 Function"></a>使用 ES6 的 classes 而不是 ES5 的 Function</h3><p>典型的 ES5 的类(function)在继承、构造和方法定义方面可读性较差。</p>
<p>当需要继承时，优先选用 classes。</p>
<p>但是，当在需要更大更复杂的对象时，最好优先选择更小的 function 而非 classes。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Animal = <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Animal)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Instantiate Animal with `new`"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Animal.prototype.move = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Mammal = <span class="function"><span class="keyword">function</span>(<span class="params">age, furColor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Mammal)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Instantiate Mammal with `new`"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Animal.call(<span class="keyword">this</span>, age);</span><br><span class="line">    <span class="keyword">this</span>.furColor = furColor;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Mammal.prototype = <span class="built_in">Object</span>.create(Animal.prototype);</span><br><span class="line">Mammal.prototype.constructor = Mammal;</span><br><span class="line">Mammal.prototype.liveBirth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Human = <span class="function"><span class="keyword">function</span>(<span class="params">age, furColor, languageSpoken</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Human)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Instantiate Human with `new`"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mammal.call(<span class="keyword">this</span>, age, furColor);</span><br><span class="line">    <span class="keyword">this</span>.languageSpoken = languageSpoken;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Human.prototype = <span class="built_in">Object</span>.create(Mammal.prototype);</span><br><span class="line">Human.prototype.constructor = Human;</span><br><span class="line">Human.prototype.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(age) &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    move() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mammal</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(age, furColor) &#123;</span><br><span class="line">        <span class="keyword">super</span>(age);</span><br><span class="line">        <span class="keyword">this</span>.furColor = furColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    liveBirth() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Mammal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(age, furColor, languageSpoken) &#123;</span><br><span class="line">        <span class="keyword">super</span>(age, furColor);</span><br><span class="line">        <span class="keyword">this</span>.languageSpoken = languageSpoken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    speak() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="使用方法链"><a href="#使用方法链" class="headerlink" title="使用方法链"></a>使用方法链</h3><p>这里我们的理解与《代码整洁之道》的建议有些不同。</p>
<p>有争论说方法链不够干净且违反了<a href="https://en.wikipedia.org/wiki/Law_of_Demeter" target="_blank" rel="noopener">德米特法则</a>，也许这是对的，但这种方法在 JS 及许多库(如 JQuery)中显得非常实用。</p>
<p>因此，我认为在 JS 中使用方法链是非常合适的。在 class 的函数中返回 this，能够方便的将类需要执行的多个方法链接起来。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.make = <span class="string">'Honda'</span>;</span><br><span class="line">    <span class="keyword">this</span>.model = <span class="string">'Accord'</span>;</span><br><span class="line">    <span class="keyword">this</span>.color = <span class="string">'white'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setMake(make) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setModel(model) &#123;</span><br><span class="line">    <span class="keyword">this</span>.model = model;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setColor(color) &#123;</span><br><span class="line">    <span class="keyword">this</span>.color = color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  save() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.make, <span class="keyword">this</span>.model, <span class="keyword">this</span>.color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="keyword">new</span> Car();</span><br><span class="line">car.setColor(<span class="string">'pink'</span>);</span><br><span class="line">car.setMake(<span class="string">'Ford'</span>);</span><br><span class="line">car.setModel(<span class="string">'F-150'</span>)</span><br><span class="line">car.save();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.make = <span class="string">'Honda'</span>;</span><br><span class="line">    <span class="keyword">this</span>.model = <span class="string">'Accord'</span>;</span><br><span class="line">    <span class="keyword">this</span>.color = <span class="string">'white'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setMake(make) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setModel(model) &#123;</span><br><span class="line">    <span class="keyword">this</span>.model = model;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setColor(color) &#123;</span><br><span class="line">    <span class="keyword">this</span>.color = color;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  save() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.make, <span class="keyword">this</span>.model, <span class="keyword">this</span>.color);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="keyword">new</span> Car()</span><br><span class="line">  .setColor(<span class="string">'pink'</span>)</span><br><span class="line">  .setMake(<span class="string">'Ford'</span>)</span><br><span class="line">  .setModel(<span class="string">'F-150'</span>)</span><br><span class="line">  .save();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="优先使用组合模式而非继承"><a href="#优先使用组合模式而非继承" class="headerlink" title="优先使用组合模式而非继承"></a>优先使用组合模式而非继承</h3><p>在著名的<a href="https://en.wikipedia.org/wiki/Design_Patterns" target="_blank" rel="noopener">设计模式</a>一书中提到，应多使用组合模式而非继承。</p>
<p>这么做有许多优点，在想要使用继承前，多想想能否通过组合模式满足需求吧。</p>
<p>那么，在什么时候继承具有更大的优势呢？这取决于你的具体需求，但大多情况下，可以遵守以下三点：</p>
<ol>
<li>继承关系表现为”是一个”而非”有一个”(如动物-&gt;人 和 用户-&gt;用户细节)</li>
<li>可以复用基类的代码(“Human”可以看成是”All animal”的一种)</li>
<li>希望当基类改变时所有派生类都受到影响(如修改”all animals”移动时的卡路里消耗量)</li>
</ol>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, email) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.email = email;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bad because Employees "have" tax data. EmployeeTaxData is not a type of Employee</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmployeeTaxData</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ssn, salary) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.ssn = ssn;</span><br><span class="line">    <span class="keyword">this</span>.salary = salary;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, email) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.email = email;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  setTaxData(ssn, salary) &#123;</span><br><span class="line">    <span class="keyword">this</span>.taxData = <span class="keyword">new</span> EmployeeTaxData(ssn, salary);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmployeeTaxData</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(ssn, salary) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ssn = ssn;</span><br><span class="line">    <span class="keyword">this</span>.salary = salary;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a><strong>测试</strong></h2><p><a href="http://gotwarlost.github.io/istanbul/" target="_blank" rel="noopener">一些好的覆盖工具</a>。</p>
<p><a href="http://jstherightway.org/#testing-tools" target="_blank" rel="noopener">一些好的 JS 测试框架</a>。</p>
<h3 id="单一的测试每个概念"><a href="#单一的测试每个概念" class="headerlink" title="单一的测试每个概念"></a>单一的测试每个概念</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'MakeMomentJSGreatAgain'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'handles date boundaries'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date;</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> MakeMomentJSGreatAgain(<span class="string">'1/1/2015'</span>);</span><br><span class="line">    date.addDays(<span class="number">30</span>);</span><br><span class="line">    date.shouldEqual(<span class="string">'1/31/2015'</span>);</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> MakeMomentJSGreatAgain(<span class="string">'2/1/2016'</span>);</span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line">    assert.equal(<span class="string">'02/29/2016'</span>, date);</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> MakeMomentJSGreatAgain(<span class="string">'2/1/2015'</span>);</span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line">    assert.equal(<span class="string">'03/01/2015'</span>, date);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'MakeMomentJSGreatAgain'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'handles 30-day months'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> MakeMomentJSGreatAgain(<span class="string">'1/1/2015'</span>);</span><br><span class="line">    date.addDays(<span class="number">30</span>);</span><br><span class="line">    date.shouldEqual(<span class="string">'1/31/2015'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'handles leap year'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> MakeMomentJSGreatAgain(<span class="string">'2/1/2016'</span>);</span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line">    assert.equal(<span class="string">'02/29/2016'</span>, date);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'handles non-leap year'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> MakeMomentJSGreatAgain(<span class="string">'2/1/2015'</span>);</span><br><span class="line">    date.addDays(<span class="number">28</span>);</span><br><span class="line">    assert.equal(<span class="string">'03/01/2015'</span>, date);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a><strong>并发</strong></h2><h3 id="用-Promises-替代回调"><a href="#用-Promises-替代回调" class="headerlink" title="用 Promises 替代回调"></a>用 Promises 替代回调</h3><p>回调不够整洁并会造成大量的嵌套。ES6 内嵌了 Promises，使用它吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'request'</span>).get(<span class="string">'https://en.wikipedia.org/wiki/Robert_Cecil_Martin'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'fs'</span>).writeFile(<span class="string">'article.html'</span>, response.body, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'File written'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'request-promise'</span>).get(<span class="string">'https://en.wikipedia.org/wiki/Robert_Cecil_Martin'</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'fs-promise'</span>).writeFile(<span class="string">'article.html'</span>, response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'File written'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="Async-Await-是较-Promises-更好的选择"><a href="#Async-Await-是较-Promises-更好的选择" class="headerlink" title="Async/Await 是较 Promises 更好的选择"></a>Async/Await 是较 Promises 更好的选择</h3><p>Promises 是较回调而言更好的一种选择，但 ES7 中的 async 和 await 更胜过 Promises。</p>
<p>在能使用 ES7 特性的情况下可以尽量使用他们替代 Promises。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'request-promise'</span>).get(<span class="string">'https://en.wikipedia.org/wiki/Robert_Cecil_Martin'</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'fs-promise'</span>).writeFile(<span class="string">'article.html'</span>, response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'File written'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getCleanCodeArticle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> request = <span class="keyword">await</span> <span class="built_in">require</span>(<span class="string">'request-promise'</span>)</span><br><span class="line">    <span class="keyword">var</span> response = <span class="keyword">await</span> request.get(<span class="string">'https://en.wikipedia.org/wiki/Robert_Cecil_Martin'</span>);</span><br><span class="line">    <span class="keyword">var</span> fileHandle = <span class="keyword">await</span> <span class="built_in">require</span>(<span class="string">'fs-promise'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> fileHandle.writeFile(<span class="string">'article.html'</span>, response);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'File written'</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a><strong>错误处理</strong></h2><p>错误抛出是个好东西！这使得你能够成功定位运行状态中的程序产生错误的位置。</p>
<h3 id="别忘了捕获错误"><a href="#别忘了捕获错误" class="headerlink" title="别忘了捕获错误"></a>别忘了捕获错误</h3><p>对捕获的错误不做任何处理是没有意义的。</p>
<p>代码中 <code>try/catch</code> 的意味着你认为这里可能出现一些错误，你应该对这些可能的错误存在相应的处理方案。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  functionThatMightThrow();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  functionThatMightThrow();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="comment">// One option (more noisy than console.log):</span></span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  notifyUserOfError(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  reportErrorToService(error);</span><br><span class="line">  <span class="comment">// OR do all three!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不要忽略被拒绝的-promises"><a href="#不要忽略被拒绝的-promises" class="headerlink" title="不要忽略被拒绝的 promises"></a>不要忽略被拒绝的 promises</h3><p>理由同 <code>try/catch</code>。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getdata()</span><br><span class="line">.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  functionThatMightThrow(data);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">getdata()</span><br><span class="line">.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  functionThatMightThrow(data);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// One option (more noisy than console.log):</span></span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  notifyUserOfError(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  reportErrorToService(error);</span><br><span class="line">  <span class="comment">// OR do all three!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a><strong>格式化</strong></h2><p>格式化是一件主观的事。如同这里的许多规则一样，这里并没有一定/立刻需要遵守的规则。可以在<a href="http://standardjs.com/rules.html" target="_blank" rel="noopener">这里</a>完成格式的自动化。</p>
<h3 id="大小写一致"><a href="#大小写一致" class="headerlink" title="大小写一致"></a>大小写一致</h3><p>JS 是弱类型语言，合理的采用大小写可以告诉你关于变量/函数等的许多消息。</p>
<p>这些规则是主观定义的，团队可以根据喜欢进行选择。重点在于无论选择何种风格，都需要注意保持一致性。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DAYS_IN_WEEK = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">var</span> daysInMonth = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> songs = [<span class="string">'Back In Black'</span>, <span class="string">'Stairway to Heaven'</span>, <span class="string">'Hey Jude'</span>];</span><br><span class="line"><span class="keyword">var</span> Artists = [<span class="string">'ACDC'</span>, <span class="string">'Led Zeppelin'</span>, <span class="string">'The Beatles'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eraseDatabase</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restore_database</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">animal</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alpaca</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DAYS_IN_WEEK = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">var</span> DAYS_IN_MONTH = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> songs = [<span class="string">'Back In Black'</span>, <span class="string">'Stairway to Heaven'</span>, <span class="string">'Hey Jude'</span>];</span><br><span class="line"><span class="keyword">var</span> artists = [<span class="string">'ACDC'</span>, <span class="string">'Led Zeppelin'</span>, <span class="string">'The Beatles'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eraseDatabase</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restoreDatabase</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alpaca</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="调用函数的函数和被调函数应放在较近的位置"><a href="#调用函数的函数和被调函数应放在较近的位置" class="headerlink" title="调用函数的函数和被调函数应放在较近的位置"></a>调用函数的函数和被调函数应放在较近的位置</h3><p>当函数间存在相互调用的情况时，应将两者置于较近的位置。</p>
<p>理想情况下，应将调用其他函数的函数写在被调用函数的上方。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceReview</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(employee) &#123;</span><br><span class="line">    <span class="keyword">this</span>.employee = employee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lookupPeers() &#123;</span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="keyword">this</span>.employee, <span class="string">'peers'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lookupMananger() &#123;</span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="keyword">this</span>.employee, <span class="string">'manager'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getPeerReviews() &#123;</span><br><span class="line">    <span class="keyword">let</span> peers = <span class="keyword">this</span>.lookupPeers();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  perfReview() &#123;</span><br><span class="line">      getPeerReviews();</span><br><span class="line">      getManagerReview();</span><br><span class="line">      getSelfReview();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getManagerReview() &#123;</span><br><span class="line">    <span class="keyword">let</span> manager = <span class="keyword">this</span>.lookupManager();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getSelfReview() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> review = <span class="keyword">new</span> PerformanceReview(user);</span><br><span class="line">review.perfReview();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerformanceReview</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(employee) &#123;</span><br><span class="line">    <span class="keyword">this</span>.employee = employee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  perfReview() &#123;</span><br><span class="line">      getPeerReviews();</span><br><span class="line">      getManagerReview();</span><br><span class="line">      getSelfReview();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getPeerReviews() &#123;</span><br><span class="line">    <span class="keyword">let</span> peers = <span class="keyword">this</span>.lookupPeers();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lookupPeers() &#123;</span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="keyword">this</span>.employee, <span class="string">'peers'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getManagerReview() &#123;</span><br><span class="line">    <span class="keyword">let</span> manager = <span class="keyword">this</span>.lookupManager();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lookupMananger() &#123;</span><br><span class="line">    <span class="keyword">return</span> db.lookup(<span class="keyword">this</span>.employee, <span class="string">'manager'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getSelfReview() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> review = <span class="keyword">new</span> PerformanceReview(employee);</span><br><span class="line">review.perfReview();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a><strong>注释</strong></h2><h3 id="只对存在一定业务逻辑复杂性的代码进行注释"><a href="#只对存在一定业务逻辑复杂性的代码进行注释" class="headerlink" title="只对存在一定业务逻辑复杂性的代码进行注释"></a>只对存在一定业务逻辑复杂性的代码进行注释</h3><p>注释并不是必须的，好的代码是能够让人一目了然，不用过多无谓的注释。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashIt</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// The hash</span></span><br><span class="line">  <span class="keyword">var</span> hash = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Length of string</span></span><br><span class="line">  <span class="keyword">var</span> length = data.length;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Loop through every character in data</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="comment">// Get character code.</span></span><br><span class="line">    <span class="keyword">var</span> char = data.charCodeAt(i);</span><br><span class="line">    <span class="comment">// Make the hash</span></span><br><span class="line">    hash = ((hash &lt;&lt; <span class="number">5</span>) - hash) + char;</span><br><span class="line">    <span class="comment">// Convert to 32-bit integer</span></span><br><span class="line">    hash = hash &amp; hash;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashIt</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> length = data.length;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> char = data.charCodeAt(i);</span><br><span class="line">    hash = ((hash &lt;&lt; <span class="number">5</span>) - hash) + char;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert to 32-bit integer</span></span><br><span class="line">    hash = hash &amp; hash;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="不要在代码库中遗留被注释掉的代码"><a href="#不要在代码库中遗留被注释掉的代码" class="headerlink" title="不要在代码库中遗留被注释掉的代码"></a>不要在代码库中遗留被注释掉的代码</h3><p>版本控制的存在是有原因的。让旧代码存在于你的 history 里吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">doStuff();</span><br><span class="line"><span class="comment">// doOtherStuff();</span></span><br><span class="line"><span class="comment">// doSomeMoreStuff();</span></span><br><span class="line"><span class="comment">// doSoMuchStuff();</span></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doStuff();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="不需要版本更新类型注释"><a href="#不需要版本更新类型注释" class="headerlink" title="不需要版本更新类型注释"></a>不需要版本更新类型注释</h3><p>记住，我们可以使用版本控制。废代码、被注释的代码及用注释记录代码中的版本更新说明都是没有必要的。</p>
<p>需要时可以使用 <code>git log</code> 获取历史版本。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2016-12-20: Removed monads, didn't understand them (RM)</span></span><br><span class="line"><span class="comment"> * 2016-10-01: Improved using special monads (JP)</span></span><br><span class="line"><span class="comment"> * 2016-02-03: Removed type-checking (LI)</span></span><br><span class="line"><span class="comment"> * 2015-03-14: Added combine with type-checking (JR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免位置标记"><a href="#避免位置标记" class="headerlink" title="避免位置标记"></a>避免位置标记</h3><p>这些东西通常只能代码麻烦，采用适当的缩进就可以了。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Scope Model Instantiation</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">let</span> $scope.model = &#123;</span><br><span class="line">  menu: <span class="string">'foo'</span>,</span><br><span class="line">  nav: <span class="string">'bar'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Action setup</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">let</span> actions = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> $scope.model = &#123;</span><br><span class="line">  menu: <span class="string">'foo'</span>,</span><br><span class="line">  nav: <span class="string">'bar'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> actions = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>
<h3 id="避免在源文件中写入法律评论"><a href="#避免在源文件中写入法律评论" class="headerlink" title="避免在源文件中写入法律评论"></a>避免在源文件中写入法律评论</h3><p>将你的 <code>LICENSE</code> 文件置于源码目录树的根目录。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">The MIT License (MIT)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Copyright (c) 2016 Ryan McDermott</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Permission is hereby granted, free of charge, to any person obtaining a copy</span></span><br><span class="line"><span class="comment">of this software and associated documentation files (the "Software"), to deal</span></span><br><span class="line"><span class="comment">in the Software without restriction, including without limitation the rights</span></span><br><span class="line"><span class="comment">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></span><br><span class="line"><span class="comment">copies of the Software, and to permit persons to whom the Software is</span></span><br><span class="line"><span class="comment">furnished to do so, subject to the following conditions:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">The above copyright notice and this permission notice shall be included in all</span></span><br><span class="line"><span class="comment">copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></span><br><span class="line"><span class="comment">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></span><br><span class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></span><br><span class="line"><span class="comment">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></span><br><span class="line"><span class="comment">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></span><br><span class="line"><span class="comment">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></span><br><span class="line"><span class="comment">SOFTWARE</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateBill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateBill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到目录</a></strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/15/%E5%A6%82%E4%BD%95%E7%9C%8B%E5%BE%85%E7%89%B9%E6%9C%97%E6%99%AE%E5%AE%A3%E5%B8%83%E6%9A%82%E5%81%9C%E8%B5%84%E5%8A%A9%E4%B8%96%E5%8D%AB%E7%BB%84%E7%BB%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/15/%E5%A6%82%E4%BD%95%E7%9C%8B%E5%BE%85%E7%89%B9%E6%9C%97%E6%99%AE%E5%AE%A3%E5%B8%83%E6%9A%82%E5%81%9C%E8%B5%84%E5%8A%A9%E4%B8%96%E5%8D%AB%E7%BB%84%E7%BB%87/" class="post-title-link" itemprop="url">如何看待特朗普宣布暂停资助世卫组织</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-15 21:26:42 / Modified: 21:27:10" itemprop="dateCreated datePublished" datetime="2020-04-15T21:26:42-04:00">2020-04-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>抖个机灵：</p>
<p>建议WHO立刻改口，不再夸奖中国防疫措施好，应当宣传美国防疫措施好，并称：</p>
<p>“<strong>美国人民处于低风险中，可以随时复工。具有如此发达的医疗技术，美国复工不存在任何风险。</strong>”</p>
<p>特朗普：复工有了理论保障，立刻开始大规模复工，经济有了恢复，特朗普高兴坏了。</p>
<p>WHO：有经费，高兴坏了。</p>
<p>新冠病毒：可以指数传播繁殖，高兴坏了。</p>
<p>中国：出口美国的外贸恢复，可以赚钱，高兴坏了。</p>
<p>何乐而不为呢？</p>
<p>百姓：坏了（未能发声，骂两句推特被封，因此不高兴大家也看不到）</p>
<hr>
<p>正经的回答：</p>
<p>说句实话，美国政客到现在为止的行为表现，以及美股从特朗普四连断到现在的表现，都可以证明一个问题：<strong>百姓死，与我何干？</strong></p>
<p>Trump从未关心过人民的死活，在资本主义（或者说功利主义的角度看）拯救生命太贵，并且死的大多还是老年人，这些人需要社会的投入，却难以有什么产出。所以Trump可以做出这么多匪夷所思的决定。这在<strong>它（人格化的资本，是人乎？非人也。）</strong>眼里看来，是减轻负债的举动。</p>
<p>在道德和利益的两端，Trump坚定地站在了利益的一侧。</p>
<p>我曾经看过一本书《公正：该如何是好？》，里面就引用过这么一个小说：厄休拉·勒吉恩的《离开欧麦拉城的人》，讨论（讽刺）过目前这种现状。（<strong>这小说是我的语文作文素材……</strong>）</p>
<p>这个小说描述了一个天堂般的欧麦拉城，这里就像美国一样，人人有丰富的资源，幸福感爆表，想做什么就做什么，风调雨顺，年年丰收，人们自由自在，无所约束。</p>
<blockquote>
<p>在一阵惊飞了燕子的喧嚣铃声里，夏季庆典降临到欧梅拉斯这个醒目地矗立在海边的城市。港湾里船舶的帆缆上到处挂着旗子。游龘行队伍穿过红色房顶彩绘墙壁的房屋之间的街道，长满青苔的古老花园和马路的树荫，又经过漂亮的公园和公共建筑。身穿紫红和灰色长袍的老人们非常庄重，工匠大师们则严肃而安静，快乐的少妇们抱着孩子边走边聊天。别的街道上，音乐节奏越来越快，不时飘来铜铃和铃鼓的声音。人们开始跳舞，整个游龘行就是跳舞。孩子们蹦来蹦去，他们尖声的笑闹像燕子一样穿过歌声和乐声。所有的游龘行队伍都向城北进发，那儿有一大片丰美的水草，叫做“绿地”。瘦长胳膊的男孩女孩们脚上沾满泥巴，趁比赛前遛遛自己不听话的马儿。这些马都没上马具，只套着根缰绳，也没有嚼子。他们的鬃毛被编成金色银色绿色的很多条。他们实在太兴奋了，全都张着鼻孔，跳跃着，互相炫耀，马大概是唯一一种把人类庆典当成自己的事的动物。 <strong>远离北边和西边群山的海湾里，就是被山半包围的欧梅拉斯。早晨的空气是如此纯净，以至于可以看见深蓝的天幕下十八座戴着雪冠的山峰上，阳光燃烧起白金色的火焰。城里刮着风，把点缀赛马场的旗子吹得上下翻飞不时啪啪作响。在宽阔鲜绿的静谧草地上可以听见音乐在城市街道里盘旋，忽远忽近不停地移动。空气里淡淡的令人愉快的香甜一次次聚拢来，随即又被打散，融入铃铛的巨大快乐声响里。</strong></p>
</blockquote>
<p>但是，为了维持这种和平幸福（美国的经济），欧麦拉城必须做一件事情，那就是<strong>虐待一个孩子（牺牲老年人，让他们感染后自生自灭）</strong>。</p>
<p>如果你想要<strong>保护这个孩子（封城，保护老弱病残），那么整个城市的幸福快乐，风调雨顺，都会在顷刻间化为乌有（经济GDP马上垮掉）</strong></p>
<blockquote>
<p><strong>欧梅拉斯的公民，所有人都知道它。有些人去看过它，另一些只知道它在那就好，总之他们全都知道。有人明白其中原因，也有人不明白，不过有一点他们都清楚：他们城市的美景，他们之间温和的友情，他们孩子的健康，他们学者的智慧，他们工匠的技艺，甚至他们的好收成和风调雨顺的天气都无一例外地依赖于那孩子令人厌恶的惨状。</strong><br>孩子们一般是在八到十二岁之间，只要他们看起来明白事理了，就会被告知这件事。去看那个小孩的大多是年轻人，虽然时不时也会有个把成年人去去。无论对他们把这件事解释得怎样详细，<strong>这些年轻的观众还是会对眼前的情景感到震惊又恶心，他们一度自以为是高出“嫌恶”这种心情，不会为其所影响的。尽管早有完备的解释，他们还是会生气，感到怒不可遏或软弱无力。他们想为这个小孩做点事，但是却完全无事可做。如果这小孩离开这令人作呕的地方，被带到阳光下，洗干净，再让他吃饱，让他舒舒服服的，那当然是好事。但是如果这样做了的话，欧梅拉斯全部的繁荣、美丽、欢乐都会在顷刻间化为乌有。</strong>这是必然的。把欧梅拉斯所有的善良、优雅都拿去交换那一点点的善举，把千百个快乐的机会都拿丢开仅仅为了一点点安心，那无异于把罪恶请进欧梅拉斯。 所以可想而知那里的规定无疑是非常严格的：<strong>就连一句同情的话也不许和那个小孩讲。</strong><br><strong>它看上去大概六岁，但实际上已经快要十岁了。它是个低能儿。也许是天生低能，也许是恐惧，营养不良和无人照管把它变成低能。它弓着背，坐在离水桶和两个拖把最远的角落，抠抠鼻子，偶尔漫不经心地摸摸自己的脚趾</strong>和生殖器。它怕这拖把。他觉得拖把很可怕，它闭上眼睛，但是它知道拖把还在那，们还是锁着的，没有人会来。从来没有人来过，除了有时候——这孩子没什么时间观念——有时候门咯咯作响，然后就开了，门口站着一个或几个人。他们中有一个会进屋，踢踢这小孩，让它站起来。其他人从来不会走近，只是用恐惧厌恶的眼神往里瞧。盛食物的碗和盛水的钵被匆匆填满，然后门又被锁上，眼睛消失了。站在门口的人从来不说话，但是这小孩不是生来就住在这工具间里的，它还记得阳光和母亲的声音。<strong>“我一定不淘气。”它说，“请放我出去，我一定乖乖的，不淘气。”他们从不回答。孩子在过去晚上总大声呼救，大声地哭，而且哭很久，但是现在，只是发出一种“哎——啊，哎——啊”的哀鸣，话也说得越来越少了。它瘦极了，瘦到腿肚子都没有，肚子鼓着，每天就靠半碗玉米面和一点动物脂肪维持生命。它赤身裸龘体，臀部和大腿是一大串化脓的疮，因为它总是坐在自己的屎尿里。</strong><br><strong>凡是见过那个孩子，意识到那个可怕的悖论的年轻人常常是哭着回家的，要不就是愤怒得哭不出来。他们会想上几周或几年，不过随着时间的流逝，他们就会明白即使那个小孩被放出来了，它也不能从自由中得到任何好处：肯定会有一点点关于温饱的模糊的满足，但也就只是多了这么一点点。去弄清楚任何真正的快乐和满足都是低级且低能的。它被恐吓得太久了，以至于害怕自由，它过的生活太没教养了，以至于它不会对人类应有的待遇做出任何反应。事实上，它已经这样生活了很久了，要是没有墙壁来保护它，没有黑暗来遮蔽它的眼睛，没有那些污秽让它坐卧它多半会死的。</strong></p>
</blockquote>
<p>讽刺吗？这就是“生命和尊严可以被金钱衡量”的后果，是Trump所希望的样子。</p>
<p>我认为，人类不应该这样，我们从一个细胞开始进行奇迹般地进化了几十亿年，从自然那里夺得了科学的权柄，从人性那里衡量了我们存在于宇宙间的意义。一个立于天地之间的伟大的文明的发展，是逐渐退离了愚昧，发展我们的道德的过程。</p>
<p>在这个过程中，我们为什么要倒退回去？要知道，我们应该给<strong>岁月以文明，而不是给文明以岁月</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/14/%E4%B9%9D%E7%A7%8D%E8%B7%A8%E5%9F%9F%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/14/%E4%B9%9D%E7%A7%8D%E8%B7%A8%E5%9F%9F%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">九种跨域方式实现原理</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-14 12:18:59 / Modified: 12:26:38" itemprop="dateCreated datePublished" datetime="2020-04-14T12:18:59-04:00">2020-04-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前后端数据交互经常会碰到请求跨域，什么是跨域，以及有哪几种跨域方式，这是本文要探讨的内容。</p>
<h2 id="一、什么是跨域？"><a href="#一、什么是跨域？" class="headerlink" title="一、什么是跨域？"></a>一、什么是跨域？</h2><h3 id="1-什么是同源策略及其限制内容？"><a href="#1-什么是同源策略及其限制内容？" class="headerlink" title="1.什么是同源策略及其限制内容？"></a>1.什么是同源策略及其限制内容？</h3><p>同源策略是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSRF等攻击。所谓同源是指”协议+域名+端口”三者相同，即便两个不同的域名指向同一个ip地址，也非同源。</p>
<p><img src="../images/image-20200414122053700.png" alt="image-20200414122053700"></p>
<p><strong>同源策略限制内容有：</strong></p>
<ul>
<li>Cookie、LocalStorage、IndexedDB 等存储性内容</li>
<li>DOM 节点</li>
<li>AJAX 请求发送后，结果被浏览器拦截了</li>
</ul>
<p>但是有三个标签是允许跨域加载资源：</p>
<ul>
<li><pre><code class="html"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">XXX</span>&gt;</span>
<span class="comment"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- &#96;&#96;&#96;html</span><br><span class="line">  &lt;link href&#x3D;XXX&gt;</span><br></pre></td></tr></table></figure></span></code></pre>
</li>
<li><pre><code class="html"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">XXX</span>&gt;</span>
<span class="handlebars"><span class="xml"><span class="comment"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.常见跨域场景</span><br><span class="line"></span><br><span class="line">**当协议、子域名、主域名、端口号中任意一个不相同时，都算作不同域**。不同域之间相互请求资源，就算作“跨域”。常见跨域场景如下图所示：</span><br><span class="line"></span><br><span class="line">![image-20200414122216907](..&#x2F;images&#x2F;image-20200414122216907.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">特别说明两点：</span><br><span class="line"></span><br><span class="line">**第一：如果是协议和端口造成的跨域问题“前台”是无能为力的。**</span><br><span class="line"></span><br><span class="line">**第二：在跨域问题上，仅仅是通过“URL的首部”来识别而不会根据域名对应的IP地址是否相同来判断。“URL的首部”可以理解为“协议, 域名和端口必须匹配”**。</span><br><span class="line"></span><br><span class="line">这里你或许有个疑问：**请求跨域了，那么请求到底发出去没有？**</span><br><span class="line"></span><br><span class="line">**跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了**。你可能会疑问明明通过表单的方式可以发起跨域请求，为什么 Ajax 就不会?因为归根结底，跨域是为了阻止用户读取到另一个域名下的内容，Ajax 可以获取响应，浏览器认为这不安全，所以拦截了响应。但是表单并不会获取新的内容，所以可以发起跨域请求。同时也说明了跨域并不能完全阻止 CSRF，因为请求毕竟是发出去了。</span><br><span class="line"></span><br><span class="line">## 二、跨域解决方案</span><br><span class="line"></span><br><span class="line">### 1.jsonp</span><br><span class="line"></span><br><span class="line">#### 1) JSONP原理</span><br><span class="line"></span><br><span class="line">**利用 &#96;&#96; 标签没有跨域限制的漏洞，网页可以得到从其他来源动态产生的 JSON 数据。JSONP请求一定需要对方的服务器做支持才可以。**</span><br><span class="line"></span><br><span class="line">#### 2) JSONP和AJAX对比</span><br><span class="line"></span><br><span class="line">JSONP和AJAX相同，都是客户端向服务器端发送请求，从服务器端获取数据的方式。但AJAX属于同源策略，JSONP属于非同源策略（跨域请求）</span><br><span class="line"></span><br><span class="line">#### 3) JSONP优缺点</span><br><span class="line"></span><br><span class="line">JSONP优点是简单兼容性好，可用于解决主流浏览器的跨域数据访问的问题。**缺点是仅支持get方法具有局限性,不安全可能会遭受XSS攻击。**</span><br><span class="line"></span><br><span class="line">#### 4) JSONP的实现流程</span><br><span class="line"></span><br><span class="line">- 声明一个回调函数，其函数名(如show)当做参数值，要传递给跨域请求数据的服务器，函数形参为要获取目标数据(服务器返回的data)。</span><br><span class="line">- 创建一个&#96;&#96;标签，把那个跨域的API数据接口地址，赋值给script的src,还要在这个地址中向服务器传递该函数名（可以通过问号传参:?callback&#x3D;show）。</span><br><span class="line">- 服务器接收到请求后，需要进行特殊的处理：把传递进来的函数名和它需要给你的数据拼接成一个字符串,例如：传递进去的函数名是show，它准备好的数据是&#96;show(&#39;我不爱你&#39;)&#96;。</span><br><span class="line">- 最后服务器把准备的数据通过HTTP协议返回给客户端，客户端再调用执行之前声明的回调函数（show），对返回的数据进行操作。</span><br><span class="line"></span><br><span class="line">在开发中可能会遇到多个 JSONP 请求的回调函数名是相同的，这时候就需要自己封装一个 JSONP函数。</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;javascript</span><br><span class="line">&#x2F;&#x2F; index.html</span><br><span class="line">function jsonp(&#123; url, params, callback &#125;) &#123;</span><br><span class="line">  return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">    let script &#x3D; document.createElement(&#39;script&#39;)</span><br><span class="line">    window[callback] &#x3D; function(data) &#123;</span><br><span class="line">      resolve(data)</span><br><span class="line">      document.body.removeChild(script)</span><br><span class="line">    &#125;</span><br><span class="line">    params &#x3D; &#123; ...params, callback &#125; &#x2F;&#x2F; wd&#x3D;b&amp;callback&#x3D;show</span><br><span class="line">    let arrs &#x3D; []</span><br><span class="line">    for (let key in params) &#123;</span><br><span class="line">      arrs.push(&#96;$&#123;key&#125;&#x3D;$&#123;params[key]&#125;&#96;)</span><br><span class="line">    &#125;</span><br><span class="line">    script.src &#x3D; &#96;$&#123;url&#125;?$&#123;arrs.join(&#39;&amp;&#39;)&#125;&#96;</span><br><span class="line">    document.body.appendChild(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">jsonp(&#123;</span><br><span class="line">  url: &#39;http:&#x2F;&#x2F;localhost:3000&#x2F;say&#39;,</span><br><span class="line">  params: &#123; wd: &#39;Iloveyou&#39; &#125;,</span><br><span class="line">  callback: &#39;show&#39;</span><br><span class="line">&#125;).then(data &#x3D;&gt; &#123;</span><br><span class="line">  console.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></span></span></span>
</code></pre>
</li>
</ul>
<p>上面这段代码相当于向<code>http://localhost:3000/say?wd=Iloveyou&amp;callback=show</code>这个地址请求数据，然后后台返回<code>show(&#39;我不爱你&#39;)</code>，最后会运行show()这个函数，打印出’我不爱你’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line">app.get(<span class="string">'/say'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; wd, callback &#125; = req.query</span><br><span class="line">  <span class="built_in">console</span>.log(wd) <span class="comment">// Iloveyou</span></span><br><span class="line">  <span class="built_in">console</span>.log(callback) <span class="comment">// show</span></span><br><span class="line">  res.end(<span class="string">`<span class="subst">$&#123;callback&#125;</span>('我不爱你')`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h4 id="5-jQuery的jsonp形式"><a href="#5-jQuery的jsonp形式" class="headerlink" title="5) jQuery的jsonp形式"></a>5) jQuery的jsonp形式</h4><p><strong>JSONP都是GET和异步请求的，不存在其他的请求方式和同步请求，且jQuery默认就会给JSONP的请求清除缓存。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">url:<span class="string">"http://crossdomain.com/jsonServerResponse"</span>,</span><br><span class="line">dataType:<span class="string">"jsonp"</span>,</span><br><span class="line">type:<span class="string">"get"</span>,<span class="comment">//可以省略</span></span><br><span class="line">jsonpCallback:<span class="string">"show"</span>,<span class="comment">//-&gt;自定义传递给服务器的函数名，而不是使用jQuery自动生成的，可省略</span></span><br><span class="line">jsonp:<span class="string">"callback"</span>,<span class="comment">//-&gt;把传递函数名的那个形参callback，可省略</span></span><br><span class="line">success:<span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(data);&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-cors"><a href="#2-cors" class="headerlink" title="2.cors"></a>2.cors</h3><p><strong>CORS 需要浏览器和后端同时支持。IE 8 和 9 需要通过 XDomainRequest 来实现</strong>。</p>
<p>浏览器会自动进行 CORS 通信，实现 CORS 通信的关键是后端。只要后端实现了 CORS，就实现了跨域。</p>
<p>服务端设置 Access-Control-Allow-Origin 就可以开启 CORS。 该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。</p>
<p>虽然设置 CORS 和前端没什么关系，但是通过这种方式解决跨域问题的话，会在发送请求时出现两种情况，分别为<strong>简单请求</strong>和<strong>复杂请求</strong>。</p>
<h4 id="1-简单请求"><a href="#1-简单请求" class="headerlink" title="1) 简单请求"></a>1) 简单请求</h4><p>只要同时满足以下两大条件，就属于简单请求</p>
<p>条件1：使用下列方法之一：</p>
<ul>
<li>GET</li>
<li>HEAD</li>
<li>POST</li>
</ul>
<p>条件2：Content-Type 的值仅限于下列三者之一：</p>
<ul>
<li>text/plain</li>
<li>multipart/form-data</li>
<li>application/x-www-form-urlencoded</li>
</ul>
<p>请求中的任意 XMLHttpRequestUpload 对象均没有注册任何事件监听器； XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。</p>
<h4 id="2-复杂请求"><a href="#2-复杂请求" class="headerlink" title="2) 复杂请求"></a>2) 复杂请求</h4><p>不符合以上条件的请求就肯定是复杂请求了。 复杂请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求,该请求是 option 方法的，通过该请求来知道服务端是否允许跨域请求。</p>
<p>我们用<code>PUT</code>向后台请求时，属于复杂请求，后台需做如下配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 允许哪个方法访问我</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'PUT'</span>)</span><br><span class="line"><span class="comment">// 预检的存活时间</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Max-Age'</span>, <span class="number">6</span>)</span><br><span class="line"><span class="comment">// OPTIONS请求不做任何处理</span></span><br><span class="line"><span class="keyword">if</span> (req.method === <span class="string">'OPTIONS'</span>) &#123;</span><br><span class="line">  res.end() </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义后台返回的内容</span></span><br><span class="line">app.put(<span class="string">'/getData'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.headers)</span><br><span class="line">  res.end(<span class="string">'我不爱你'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>接下来我们看下一个完整复杂请求的例子，并且介绍下CORS请求相关的字段</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line">let xhr = new XMLHttpRequest()</span><br><span class="line">document.cookie = 'name=xiamen' // cookie不能跨域</span><br><span class="line">xhr.withCredentials = true // 前端设置是否带cookie</span><br><span class="line">xhr.open('PUT', 'http://localhost:4000/getData', true)</span><br><span class="line">xhr.setRequestHeader('name', 'xiamen')</span><br><span class="line">xhr.onreadystatechange = function() &#123;</span><br><span class="line">  if (xhr.readyState === 4) &#123;</span><br><span class="line">    if ((xhr.status &gt;= 200 &amp;&amp; xhr.status <span class="tag">&lt; <span class="attr">300</span>) || <span class="attr">xhr.status</span> === <span class="string">304)</span> &#123;</span></span><br><span class="line"><span class="tag">      <span class="attr">console.log</span>(<span class="attr">xhr.response</span>)</span></span><br><span class="line"><span class="tag">      //得到响应头，后台需设置<span class="attr">Access-Control-Expose-Headers</span></span></span><br><span class="line"><span class="tag">      <span class="attr">console.log</span>(<span class="attr">xhr.getResponseHeader</span>('<span class="attr">name</span>'))</span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag">  &#125;</span></span><br><span class="line"><span class="tag">&#125;</span></span><br><span class="line"><span class="tag"><span class="attr">xhr.send</span>()</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">//<span class="attr">server1.js</span></span></span><br><span class="line"><span class="tag"><span class="attr">let</span> <span class="attr">express</span> = <span class="string">require(</span>'<span class="attr">express</span>');</span></span><br><span class="line"><span class="tag"><span class="attr">let</span> <span class="attr">app</span> = <span class="string">express();</span></span></span><br><span class="line"><span class="tag"><span class="attr">app.use</span>(<span class="attr">express.static</span>(<span class="attr">__dirname</span>));</span></span><br><span class="line"><span class="tag"><span class="attr">app.listen</span>(<span class="attr">3000</span>);</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">//<span class="attr">server2.js</span></span></span><br><span class="line"><span class="tag"><span class="attr">let</span> <span class="attr">express</span> = <span class="string">require(</span>'<span class="attr">express</span>')</span></span><br><span class="line"><span class="tag"><span class="attr">let</span> <span class="attr">app</span> = <span class="string">express()</span></span></span><br><span class="line"><span class="tag"><span class="attr">let</span> <span class="attr">whitList</span> = <span class="string">[</span>'<span class="attr">http:</span>//<span class="attr">localhost:3000</span>'] //设置白名单</span></span><br><span class="line"><span class="tag"><span class="attr">app.use</span>(<span class="attr">function</span>(<span class="attr">req</span>, <span class="attr">res</span>, <span class="attr">next</span>) &#123;</span></span><br><span class="line"><span class="tag">  <span class="attr">let</span> <span class="attr">origin</span> = <span class="string">req.headers.origin</span></span></span><br><span class="line"><span class="tag">  <span class="attr">if</span> (<span class="attr">whitList.includes</span>(<span class="attr">origin</span>)) &#123;</span></span><br><span class="line"><span class="tag">    // 设置哪个源可以访问我</span></span><br><span class="line"><span class="tag">    <span class="attr">res.setHeader</span>('<span class="attr">Access-Control-Allow-Origin</span>', <span class="attr">origin</span>)</span></span><br><span class="line"><span class="tag">    // 允许携带哪个头访问我</span></span><br><span class="line"><span class="tag">    <span class="attr">res.setHeader</span>('<span class="attr">Access-Control-Allow-Headers</span>', '<span class="attr">name</span>')</span></span><br><span class="line"><span class="tag">    // 允许哪个方法访问我</span></span><br><span class="line"><span class="tag">    <span class="attr">res.setHeader</span>('<span class="attr">Access-Control-Allow-Methods</span>', '<span class="attr">PUT</span>')</span></span><br><span class="line"><span class="tag">    // 允许携带<span class="attr">cookie</span></span></span><br><span class="line"><span class="tag">    <span class="attr">res.setHeader</span>('<span class="attr">Access-Control-Allow-Credentials</span>', <span class="attr">true</span>)</span></span><br><span class="line"><span class="tag">    // 预检的存活时间</span></span><br><span class="line"><span class="tag">    <span class="attr">res.setHeader</span>('<span class="attr">Access-Control-Max-Age</span>', <span class="attr">6</span>)</span></span><br><span class="line"><span class="tag">    // 允许返回的头</span></span><br><span class="line"><span class="tag">    <span class="attr">res.setHeader</span>('<span class="attr">Access-Control-Expose-Headers</span>', '<span class="attr">name</span>')</span></span><br><span class="line"><span class="tag">    <span class="attr">if</span> (<span class="attr">req.method</span> === <span class="string">'OPTIONS'</span>) &#123;</span></span><br><span class="line"><span class="tag">      <span class="attr">res.end</span>() // <span class="attr">OPTIONS</span>请求不做任何处理</span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag">  &#125;</span></span><br><span class="line"><span class="tag">  <span class="attr">next</span>()</span></span><br><span class="line"><span class="tag">&#125;)</span></span><br><span class="line"><span class="tag"><span class="attr">app.put</span>('/<span class="attr">getData</span>', <span class="attr">function</span>(<span class="attr">req</span>, <span class="attr">res</span>) &#123;</span></span><br><span class="line"><span class="tag">  <span class="attr">console.log</span>(<span class="attr">req.headers</span>)</span></span><br><span class="line"><span class="tag">  <span class="attr">res.setHeader</span>('<span class="attr">name</span>', '<span class="attr">jw</span>') //返回一个响应头，后台需设置</span></span><br><span class="line"><span class="tag">  <span class="attr">res.end</span>('我不爱你')</span></span><br><span class="line"><span class="tag">&#125;)</span></span><br><span class="line"><span class="tag"><span class="attr">app.get</span>('/<span class="attr">getData</span>', <span class="attr">function</span>(<span class="attr">req</span>, <span class="attr">res</span>) &#123;</span></span><br><span class="line"><span class="tag">  <span class="attr">console.log</span>(<span class="attr">req.headers</span>)</span></span><br><span class="line"><span class="tag">  <span class="attr">res.end</span>('我不爱你')</span></span><br><span class="line"><span class="tag">&#125;)</span></span><br><span class="line"><span class="tag"><span class="attr">app.use</span>(<span class="attr">express.static</span>(<span class="attr">__dirname</span>))</span></span><br><span class="line"><span class="tag"><span class="attr">app.listen</span>(<span class="attr">4000</span>)</span></span><br></pre></td></tr></table></figure>

<p>上述代码由<code>http://localhost:3000/index.html</code>向<code>http://localhost:4000/</code>跨域请求，正如我们上面所说的，后端是实现 CORS 通信的关键。</p>
<h3 id="3-postMessage"><a href="#3-postMessage" class="headerlink" title="3.postMessage"></a>3.postMessage</h3><p>postMessage是HTML5 XMLHttpRequest Level 2中的API，且是为数不多可以跨域操作的window属性之一，它可用于解决以下方面的问题：</p>
<ul>
<li>页面和其打开的新窗口的数据传递</li>
<li>多窗口之间消息传递</li>
<li>页面与嵌套的iframe消息传递</li>
<li>上面三个场景的跨域数据传递</li>
</ul>
<p><strong>postMessage()方法允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递</strong>。</p>
<blockquote>
<p>otherWindow.postMessage(message, targetOrigin, [transfer]);</p>
</blockquote>
<ul>
<li>message: 将要发送到其他 window的数据。</li>
<li>targetOrigin:通过窗口的origin属性来指定哪些窗口能接收到消息事件，其值可以是字符串”*”（表示无限制）或者一个URI。在发送消息的时候，如果目标窗口的协议、主机地址或端口这三者的任意一项不匹配targetOrigin提供的值，那么消息就不会被发送；只有三者完全匹配，消息才会被发送。</li>
<li>transfer(可选)：是一串和message 同时传递的 Transferable 对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权。</li>
</ul>
<p>接下来我们看个例子： <code>http://localhost:3000/a.html</code>页面向<code>http://localhost:4000/b.html</code>传递“我爱你”,然后后者传回”我不爱你”。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// a.html</span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:4000/b.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">id</span>=<span class="string">"frame"</span> <span class="attr">onload</span>=<span class="string">"load()"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span> //等它加载完触发一个事件</span><br><span class="line">  //内嵌在http://localhost:3000/a.html</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> frame = <span class="built_in">document</span>.getElementById(<span class="string">'frame'</span>)</span></span><br><span class="line"><span class="actionscript">        frame.contentWindow.postMessage(<span class="string">'我爱你'</span>, <span class="string">'http://localhost:4000'</span>) <span class="comment">//发送数据</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; <span class="comment">//接受返回数据</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(e.data) <span class="comment">//我不爱你</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// b.html</span><br><span class="line">  window.onmessage = function(e) &#123;</span><br><span class="line">    console.log(e.data) //我爱你</span><br><span class="line">    e.source.postMessage('我不爱你', e.origin)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-websocket"><a href="#4-websocket" class="headerlink" title="4.websocket"></a>4.websocket</h3><p>Websocket是HTML5的一个持久化的协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。WebSocket和HTTP都是应用层协议，都基于 TCP 协议。但是 <strong>WebSocket 是一种双向通信协议，在建立连接之后，WebSocket 的 server 与 client 都能主动向对方发送或接收数据</strong>。同时，WebSocket 在建立连接时需要借助 HTTP 协议，连接建立好了之后 client 与 server 之间的双向通信就与 HTTP 无关了。</p>
<p>原生WebSocket API使用起来不太方便，我们使用<code>Socket.io</code>，它很好地封装了webSocket接口，提供了更简单、灵活的接口，也对不支持webSocket的浏览器提供了向下兼容。</p>
<p>我们先来看个例子：本地文件socket.html向<code>localhost:3000</code>发生数据和接受数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// socket.html</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:3000'</span>);</span></span><br><span class="line"><span class="actionscript">    socket.onopen = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      socket.send(<span class="string">'我爱你'</span>);<span class="comment">//向服务器发送数据</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    socket.onmessage = <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(e.data);<span class="comment">//接收服务器返回的数据</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// server.js</span><br><span class="line">let express = require('express');</span><br><span class="line">let app = express();</span><br><span class="line">let WebSocket = require('ws');//记得安装ws</span><br><span class="line">let wss = new WebSocket.Server(&#123;port:3000&#125;);</span><br><span class="line">wss.on('connection',function(ws) &#123;</span><br><span class="line">  ws.on('message', function (data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">    ws.send('我不爱你')</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-Node中间件代理-两次跨域"><a href="#5-Node中间件代理-两次跨域" class="headerlink" title="5. Node中间件代理(两次跨域)"></a>5. Node中间件代理(两次跨域)</h3><p>实现原理：<strong>同源策略是浏览器需要遵循的标准，而如果是服务器向服务器请求就无需遵循同源策略。</strong> 代理服务器，需要做以下几个步骤：</p>
<ul>
<li>接受客户端请求 。</li>
<li>将请求 转发给服务器。</li>
<li>拿到服务器 响应 数据。</li>
<li>将 响应 转发给客户端。</li>
</ul>
<p><img src="../images/image-20200414122242142.png" alt="image-20200414122242142"></p>
<p>我们先来看个例子：本地文件index.html文件，通过代理服务器<code>http://localhost:3000</code>向目标服务器<code>http://localhost:4000</code>请求数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.html(http://127.0.0.1:5500)</span></span><br><span class="line"> &lt;script src=<span class="string">"https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script&gt;</span></span><br><span class="line"><span class="regexp">      $.ajax(&#123;</span></span><br><span class="line"><span class="regexp">        url: 'http:/</span><span class="regexp">/localhost:3000',</span></span><br><span class="line"><span class="regexp">        type: 'post',</span></span><br><span class="line"><span class="regexp">        data: &#123; name: 'xiamen', password: '123456' &#125;,</span></span><br><span class="line"><span class="regexp">        contentType: 'application/</span>json;charset=utf<span class="number">-8</span><span class="string">',</span></span><br><span class="line"><span class="string">        success: function(result) &#123;</span></span><br><span class="line"><span class="string">          console.log(result) // &#123;"title":"fontend","password":"123456"&#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        error: function(msg) &#123;</span></span><br><span class="line"><span class="string">          console.log(msg)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;)</span></span><br><span class="line"><span class="string">     &lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// server1.js 代理服务器(http://localhost:3000)</span></span><br><span class="line"><span class="string">const http = require('</span>http<span class="string">')</span></span><br><span class="line"><span class="string">// 第一步：接受客户端请求</span></span><br><span class="line"><span class="string">const server = http.createServer((request, response) =&gt; &#123;</span></span><br><span class="line"><span class="string">  // 代理服务器，直接和浏览器直接交互，需要设置CORS 的首部字段</span></span><br><span class="line"><span class="string">  response.writeHead(200, &#123;</span></span><br><span class="line"><span class="string">    '</span>Access-Control-Allow-Origin<span class="string">': '</span>*<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>Access-Control-Allow-Methods<span class="string">': '</span>*<span class="string">',</span></span><br><span class="line"><span class="string">    '</span>Access-Control-Allow-Headers<span class="string">': '</span>Content-Type<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">  // 第二步：将请求转发给服务器</span></span><br><span class="line"><span class="string">  const proxyRequest = http</span></span><br><span class="line"><span class="string">    .request(</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        host: '</span><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">',</span></span><br><span class="line"><span class="string">        port: 4000,</span></span><br><span class="line"><span class="string">        url: '</span>/<span class="string">',</span></span><br><span class="line"><span class="string">        method: request.method,</span></span><br><span class="line"><span class="string">        headers: request.headers</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      serverResponse =&gt; &#123;</span></span><br><span class="line"><span class="string">        // 第三步：收到服务器的响应</span></span><br><span class="line"><span class="string">        var body = '</span><span class="string">'</span></span><br><span class="line"><span class="string">        serverResponse.on('</span>data<span class="string">', chunk =&gt; &#123;</span></span><br><span class="line"><span class="string">          body += chunk</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">        serverResponse.on('</span>end<span class="string">', () =&gt; &#123;</span></span><br><span class="line"><span class="string">          console.log('</span>The data is <span class="string">' + body)</span></span><br><span class="line"><span class="string">          // 第四步：将响应结果转发给浏览器</span></span><br><span class="line"><span class="string">          response.end(body)</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    .end()</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000, () =&gt; &#123;</span></span><br><span class="line"><span class="string">  console.log('</span>The proxyServer is running at http:<span class="comment">//localhost:3000')</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// server2.js(http://localhost:4000)</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> data = &#123; <span class="attr">title</span>: <span class="string">'fontend'</span>, <span class="attr">password</span>: <span class="string">'123456'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (request.url === <span class="string">'/'</span>) &#123;</span><br><span class="line">    response.end(<span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">4000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The server is running at http://localhost:4000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上述代码经过两次跨域，值得注意的是浏览器向代理服务器发送请求，也遵循同源策略，最后在index.html文件打印出<code>{&quot;title&quot;:&quot;fontend&quot;,&quot;password&quot;:&quot;123456&quot;}</code></p>
<h3 id="6-nginx反向代理"><a href="#6-nginx反向代理" class="headerlink" title="6.nginx反向代理"></a>6.nginx反向代理</h3><p>实现原理类似于Node中间件代理，需要你搭建一个中转nginx服务器，用于转发请求。</p>
<p>使用nginx反向代理实现跨域，是最简单的跨域方式。只需要修改nginx的配置即可解决跨域问题，支持所有浏览器，支持session，不需要修改任何代码，并且不会影响服务器性能。</p>
<p>实现思路：通过nginx配置一个代理服务器（域名与domain1相同，端口不同）做跳板机，反向代理访问domain2接口，并且可以顺便修改cookie中domain信息，方便当前域cookie写入，实现跨域登录。</p>
<p>先下载<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">nginx</a>，然后将nginx目录下的nginx.conf修改如下:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// proxy服务器</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">81</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  www.domain1.com;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>   http://www.domain2.com:8080;  <span class="comment">#反向代理</span></span><br><span class="line">        <span class="attribute">proxy_cookie_domain</span> www.domain2.com www.domain1.com; <span class="comment">#修改cookie里域名</span></span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 当用webpack-dev-server等中间件代理接口访问nignx时，此时无浏览器参与，故没有同源限制，下面的跨域配置可不启用</span></span><br><span class="line">        <span class="attribute">add_header</span> Access-Control-Allow-Origin http://www.domain1.com;  <span class="comment">#当前端只跨域不带cookie时，可为*</span></span><br><span class="line">        <span class="attribute">add_header</span> Access-Control-Allow-Credentials <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后通过命令行<code>nginx -s reload</code>启动nginx</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">// 前端开关：浏览器是否读写cookie</span></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// 访问nginx中的代理服务器</span></span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'http://www.domain1.com:81/?user=admin'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.createServer();</span><br><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> params = qs.parse(req.url.substring(<span class="number">2</span>));</span><br><span class="line">    <span class="comment">// 向前台写cookie</span></span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Set-Cookie'</span>: <span class="string">'l=a123456;Path=/;Domain=www.domain2.com;HttpOnly'</span>   <span class="comment">// HttpOnly:脚本无法读取</span></span><br><span class="line">    &#125;);</span><br><span class="line">    res.write(<span class="built_in">JSON</span>.stringify(params));</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="string">'8080'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Server is running at port 8080...'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="7-window-name-iframe"><a href="#7-window-name-iframe" class="headerlink" title="7.window.name + iframe"></a>7.window.name + iframe</h3><p>window.name属性的独特之处：name值在不同的页面（甚至不同域名）加载后依旧存在，并且可以支持非常长的 name 值（2MB）。</p>
<p>其中a.html和b.html是同域的，都是<code>http://localhost:3000</code>;而c.html是<code>http://localhost:4000</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// a.html(http://localhost:3000/b.html)</span><br><span class="line"> <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:4000/c.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">onload</span>=<span class="string">"load()"</span> <span class="attr">id</span>=<span class="string">"iframe"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="keyword">let</span> first = <span class="literal">true</span></span></span><br><span class="line"><span class="actionscript">   <span class="comment">// onload事件会触发2次，第1次加载跨域页，并留存数据于window.name</span></span></span><br><span class="line"><span class="actionscript">   <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">     if(first)&#123;</span><br><span class="line"><span class="actionscript">     <span class="comment">// 第1次onload(跨域页)成功后，切换到同域代理页面</span></span></span><br><span class="line"><span class="javascript">       <span class="keyword">let</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">'iframe'</span>);</span></span><br><span class="line"><span class="actionscript">       iframe.src = <span class="string">'http://localhost:3000/b.html'</span>;</span></span><br><span class="line"><span class="actionscript">       first = <span class="literal">false</span>;</span></span><br><span class="line"><span class="actionscript">     &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="actionscript">     <span class="comment">// 第2次onload(同域b.html页)成功后，读取同域window.name中数据</span></span></span><br><span class="line"><span class="javascript">       <span class="built_in">console</span>.log(iframe.contentWindow.name);</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>b.html为中间代理页，与a.html同域，内容为空。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// c.html(http://localhost:4000/c.html)</span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="built_in">window</span>.name = <span class="string">'我不爱你'</span>  </span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结：通过iframe的src属性由外域转向本地域，跨域数据即由iframe的window.name从外域传递到本地域。这个就巧妙地绕过了浏览器的跨域访问限制，但同时它又是安全操作。</p>
<h3 id="8-location-hash-iframe"><a href="#8-location-hash-iframe" class="headerlink" title="8.location.hash +  iframe"></a>8.location.hash +  iframe</h3><p>实现原理： a.html欲与c.html跨域相互通信，通过中间页b.html来实现。 三个页面，不同域之间利用iframe的location.hash传值，相同域之间直接js访问来通信。</p>
<p>具体实现步骤：一开始a.html给c.html传一个hash值，然后c.html收到hash值后，再把hash值传递给b.html，最后b.html将结果放到a.html的hash值中。 同样的，a.html和b.html是同域的，都是<code>http://localhost:3000</code>;而c.html是<code>http://localhost:4000</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// a.html</span><br><span class="line"> <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://localhost:4000/c.html#iloveyou"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">//检测hash的变化</span></span></span><br><span class="line"><span class="javascript">     <span class="built_in">console</span>.log(location.hash);</span></span><br><span class="line">   &#125;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// b.html</span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="built_in">window</span>.parent.parent.location.hash = location.hash </span></span><br><span class="line"><span class="actionscript">   <span class="comment">//b.html将结果放到a.html的hash值中，b.html可通过parent.parent访问a.html页面</span></span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// c.html</span><br><span class="line">console.log(location.hash);</span><br><span class="line"> let iframe = document.createElement('iframe');</span><br><span class="line"> iframe.src = 'http://localhost:3000/b.html#idontloveyou';</span><br><span class="line"> document.body.appendChild(iframe);</span><br></pre></td></tr></table></figure>

<h3 id="9-document-domain-iframe"><a href="#9-document-domain-iframe" class="headerlink" title="9.document.domain + iframe"></a>9.document.domain + iframe</h3><p><strong>该方式只能用于二级域名相同的情况下，比如 <code>a.test.com</code> 和 <code>b.test.com</code> 适用于该方式</strong>。 只需要给页面添加 <code>document.domain =&#39;test.com&#39;</code> 表示二级域名都相同就可以实现跨域。</p>
<p>实现原理：两个页面都通过js强制设置document.domain为基础主域，就实现了同域。</p>
<p>我们看个例子：页面<code>a.zf1.cn:3000/a.html</code>获取页面<code>b.zf1.cn:3000/b.html</code>中a的值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// a.html</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> helloa</span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://b.zf1.cn:3000/b.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">onload</span>=<span class="string">"load()"</span> <span class="attr">id</span>=<span class="string">"frame"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'zf1.cn'</span></span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(frame.contentWindow.a);</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// b.html</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">   hellob</span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">     <span class="built_in">document</span>.domain = <span class="string">'zf1.cn'</span></span></span><br><span class="line"><span class="actionscript">     <span class="keyword">var</span> a = <span class="number">100</span>;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><ul>
<li>CORS支持所有类型的HTTP请求，是跨域HTTP请求的根本解决方案</li>
<li>JSONP只支持GET请求，JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。</li>
<li>不管是Node中间件代理还是nginx反向代理，主要是通过同源策略对服务器不加限制。</li>
<li>日常工作中，用得比较多的跨域方案是cors和nginx反向代理</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/13/%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0React/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Yuanchen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuanchen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/13/%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0React/" class="post-title-link" itemprop="url">如何学习React</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-13 12:21:34 / Modified: 12:23:16" itemprop="dateCreated datePublished" datetime="2020-04-13T12:21:34-04:00">2020-04-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="如何学习React"><a href="#如何学习React" class="headerlink" title="如何学习React"></a>如何学习React</h1><p>如果你是一个 React (或者前端) 新手, 出于以下的原因, 你可能会对这个生态圈感到困惑:</p>
<ul>
<li>React 的目标群体历来是喜欢尝试新事物的开发者和前端专家.</li>
<li>Facebook 开源的内容是应用在他们的实际应用中, 因此他们没有关注那些比 Facebook 小的工程需求.</li>
<li>现有的 React 指引水平参差不齐.</li>
</ul>
<p>在本文中, 我会假设你已有使用 HTML, CSS 和 JavaScript 开发网页的基础.</p>
<h2 id="如何踏入-React-生态圈"><a href="#如何踏入-React-生态圈" class="headerlink" title="如何踏入 React 生态圈"></a>如何踏入 React 生态圈</h2><p>所有的软件都是建立在某个技术栈之上的, 你需要对整个技术栈有足够深入的理解, 才能建造你的应用. 为什么 React 生态圈的工具似乎总让人感觉压力山大呢, 因为它总是以错误的顺序被解释:</p>
<p>你应该按照以下的顺序进行学习, <strong>而不是跳着学或者同时学习</strong>:</p>
<ul>
<li><a href="#user-content-学习-react-本身">React</a></li>
<li><a href="#user-content-学习-npm"><code>npm</code></a></li>
<li><a href="#user-content-学习-javascript-打包工具">JavaScript “打包工具”</a></li>
<li><a href="#user-content-学习-es6">ES6</a></li>
<li><a href="#user-content-学习路由-routing">Routing</a></li>
<li><a href="#user-content-学习-flux">Flux</a></li>
</ul>
<p><strong>你不需要把这些都学完才去使用 React.</strong> 只需要在你遇到问题需要解决的时候, 才进入下一步的学习.</p>
<p>另外, 在 React 社区中, 有一些前沿主题是经常被提及到的, 以下的这些主题很有意思, 但也很难弄懂, 所以它们远没有上面的主题流行, <strong>大多数应用也不需要用到这些.</strong></p>
<ul>
<li><a href="#user-content-学习内联样式">内联样式</a></li>
<li><a href="#user-content-学习服务器端渲染">服务器端渲染</a></li>
<li><a href="#user-content-学习-immutablejs">Immutable.js</a></li>
<li><a href="#user-content-学习-relay-falcor-等">Relay, Falcor 等</a></li>
</ul>
<h2 id="学习-React-本身"><a href="#学习-React-本身" class="headerlink" title="学习 React 本身"></a>学习 React 本身</h2><p>有一种常见的误解是: 你需要花费大量时间在配置工具上, 然后才开始学习 React. 在官方文档里, 你可以找到 <a href="https://facebook.github.io/react/docs/getting-started.html#quick-start-without-npm" target="_blank" rel="noopener">copy-paste HTML template</a>. 只需要保存为 <code>.html</code> 文件, 你就可以马上开始学习了. <strong>这个步骤不需要任何工具, 你也无需额外学习工具使用, 直到你能熟练掌握 React 基础.</strong></p>
<p>我依然觉得, 学习 React 最简单的方法是通过官方教程 <a href="https://facebook.github.io/react/docs/tutorial.html" target="_blank" rel="noopener">the official tutorial</a>.</p>
<h2 id="学习-npm"><a href="#学习-npm" class="headerlink" title="学习 npm"></a>学习 <code>npm</code></h2><p><code>npm</code> 是 Node.js 包管理工具, 也是前端工程师和设计师分享 JavaScript 代码最流行的方式. 它包含了名为 <code>CommonJS</code> 的模块系统, 让你可以安装 JavaScript 写的命令行工具. 作为背景知识, 可以阅读 <a href="http://0fps.net/2013/01/22/commonjs-why-and-how/" target="_blank" rel="noopener">这篇文章</a> 了解 <code>CommonJS</code> 对于浏览器的重要性, 阅读  <a href="http://wiki.commonjs.org/wiki/Introduction" target="_blank" rel="noopener">CommonJS Spec Wiki</a> 了解关于 <code>CommonJS</code> API 的更多内容</p>
<p>在 React 生态圈中, 大部分可重用的组件、库和工具遵循 <code>CommonJS</code> 模块规范, 可通过 <code>npm</code> 来安装.</p>
<h2 id="学习-JavaScript-打包工具"><a href="#学习-JavaScript-打包工具" class="headerlink" title="学习 JavaScript 打包工具"></a>学习 JavaScript 打包工具</h2><p>出于若干技术原因, <code>CommonJS</code> 模块 (也就是 <code>npm</code> 里的所有内容) 不能直接用到浏览器. 你需要一个 JavaScript “打包工具(bundler)” 来把这些模块打包成 <code>.js</code> 文件, 使你可以在网页中通过 <code>&lt;script&gt;</code> 标签引入它们.</p>
<p>JavaScript 打包工具包括 <code>webpack</code> 和 <code>browserify</code>. 它们都是好的选择, 但我个人更喜欢 <code>webpack</code> , 因为它有许多功能简化大型应用开发. 鉴于 webpack 文档可能令人感到困惑, 我也写了两篇文章: <a href="https://github.com/petehunt/react-webpack-template" target="_blank" rel="noopener">plug-and-play template for getting started</a> 和针对更复杂用例的 <a href="https://github.com/petehunt/webpack-howto" target="_blank" rel="noopener">how-to guide for webpack</a>.</p>
<p>要记住的一点: <code>CommonJS</code> 使用了 <code>require()</code> 函数来引入模块, 因此许多人对此感到疑惑, 并认为需要导入 <code>require.js</code> 到工程里. 出于若干技术原因, 我建议你避免使用 <code>require.js</code>. 它在 React 生态圈并不流行.</p>
<h2 id="学习-ES6"><a href="#学习-ES6" class="headerlink" title="学习 ES6"></a>学习 ES6</h2><p>在 JSX (你会在 React tutorial 中学习到) 以外, 你可能会注意到 React 例子中一些有趣的语法. 这被称为 ECMAScript6, 是 JavaScript 的最新版本. 由于 ES6 很新, 你可能还没学习到, 浏览器也可能尚未兼容, 但别担心, 通过合适的配置, 你的打包工具会为你自动转换成兼容代码.</p>
<p>如果你只想要使用 React 来把事情做完, <strong>你可以跳过 ES6 的学习,</strong> 或者留到以后再学习.</p>
<p>你可能会看到一些讨论说更适合用 ES6 的 class 来创建 React 组件. 这并不是真的, 大多数人 (包括 Facebook) 用的还是 <code>React.createClass()</code>.</p>
<h2 id="学习路由-routing"><a href="#学习路由-routing" class="headerlink" title="学习路由 (routing)"></a>学习路由 (routing)</h2><p>“单页面应用” 是时下的技术热点. 当网页加载完成, 用户点击链接或者按钮的时候, JavaScript 会更新页面和改变地址栏, 但网页不会刷新. 地址栏的管理就是通过 <strong>路由(router)</strong> 来完成的.</p>
<p>目前 React 生态圈最受欢迎的路由解决方案是 <a href="https://github.com/rackt/react-router" target="_blank" rel="noopener">react-router</a>. 如果你正在创建一个单页面应用, 有什么理由不去使用它呢?</p>
<p><strong>如果你创建的并非单页面应用, 请不要使用路由.</strong> 无论如何, 大部分项目都是从大型应用中的小组件开始的.</p>
<h2 id="学习内联样式"><a href="#学习内联样式" class="headerlink" title="学习内联样式"></a>学习内联样式</h2><p>在 React 出现之前, 很多人通过像 SASS 这样的预处理器来重用复杂的 CSS 样式表. 鉴于 React 使开发可重用组件变得容易, 你的样式表可以变得没那么复杂了. 社区中许多人 (包括我) 正尝试完全抛弃样式表.</p>
<p>由于一些原因, 其实这是个相当疯狂的主意. 这让媒体查询 (media quries) 更加困难了, 而且这种技术可能有性能上的局限性. <strong>当你开始用 React 的时候, 只要用你平常使用的方法去写就好了.</strong></p>
<p>一旦你找到了用 React 开发的感觉, 你就可以关注那些可作为替代的技术了. 其中一种流行技术是 <a href="https://en.bem.info/" target="_blank" rel="noopener">BEM</a>. 我建议你逐渐停用 CSS 预处理器, 因为 React 给了你一种更强大的方式去重用样式 (通过重用组件), 并且 JavaScript 打包工具可以为你生成更高效的样式表 (我曾经<a href="https://www.youtube.com/watch?v=VkTCL6Nqm6Y" target="_blank" rel="noopener">在 OSCON 上发表过关于这个的演讲</a>). 说了这么多, 总之 React 就像其他 JavaScript 库一样, 可以和 CSS 预处理器很好地配合工作.</p>
<p>另一种可选项是 <a href="http://glenmaddern.com/articles/css-modules" target="_blank" rel="noopener">CSS 模块</a>, 更具体地说, 是 <a href="https://github.com/gajus/react-css-modules" target="_blank" rel="noopener">react-css-modules</a>. 虽然有了这些 CSS 模块, 你还是写 CSS (或者是 SASS/LESS/Stylus), 但你可以像处理 React 中的内联样式那样管理和组织 CSS 文件. 你也不需要担心用到 BEM 那样的方法学去管理类名, 因为模块系统在底层已经帮你处理好了.</p>
<h2 id="学习服务器端渲染"><a href="#学习服务器端渲染" class="headerlink" title="学习服务器端渲染"></a>学习服务器端渲染</h2><p>服务器端渲染经常被称为 “通用应用” 或 “同构应用”. 这意味着你可以用 React 组件在服务器端渲染出静态 HTML. 这样做可以提高初始化加载的性能, 因为用户不用等到 JS 下载完才看到初始界面, 并且 React 可以重用服务器端渲染出的 HTML, 无需客户端重新生成.</p>
<p>如果你发现首屏渲染速度过慢, 或者想提高网站在搜索引擎的排行, 你就需要服务器端渲染了. 尽管 Google 现在也会索引客户端渲染的内容, 但截至 2016 年 1 月, 这样做仍被证实会对排行有负面影响, 这可能是由于客户端渲染的性能问题所造成的.</p>
<p>服务器端渲染还需要许多工具的辅助, 因为显然 React 组件不是在考虑服务器端渲染的情况下写出来的, 你应该先构建你的应用, 之后再关心服务器端渲染的问题. 不用担心, 你不需要重写所有组件去支持它.</p>
<h2 id="学习-Flux"><a href="#学习-Flux" class="headerlink" title="学习 Flux"></a>学习 Flux</h2><p>你可能听过 Flux, 不过关于 Flux 有大量的错误资讯.</p>
<p>许多人一坐下来刚开始构建应用, 就认为需要用 Flux 来定义他们的数据模型. <strong>这样采用 Flux 是不对的, Flux 应该在大量组件被建立完成以后才被引入.</strong></p>
<p>React 组件之间存在层级关系. 在很多时候, 你的数据模型也跟随这种层级. 这种情况下, Flux 不会给你很大帮助. 但有些时候, 你的数据模型没有层次, 当你的 React 组件开始接受没有关联的 <code>props</code> 的时候, 或者当小部分组件开始变得复杂的时候, 你才可能需要看看 Flux.</p>
<p><strong>你会知道什么时候需要用 Flux. 如果你不确定是否需要用它, 你就不需要它.</strong></p>
<p>如果你决定使用 Flux, 现在最流行的、文档最全的 Flux 库是 <a href="http://redux.js.org/" target="_blank" rel="noopener">Redux</a>. 当然也有许多其他选择, 你或者会有兴趣尝试使用它们, 但我的建议是只需要用最流行的 Redux 就足够了.</p>
<h2 id="学习-Immutable-js"><a href="#学习-Immutable-js" class="headerlink" title="学习 Immutable.js"></a>学习 Immutable.js</h2><p><a href="https://facebook.github.io/immutable-js/" target="_blank" rel="noopener">Immutable.js</a> 提供了一系列的数据结构, 以帮助解决构造 React 应用时的某些性能问题. 这是一个很棒的库, 你可能会在应用发展的过程里大量用到它, 但直到你在意识到性能问题以前, 它是完全不必要的.</p>
<h2 id="学习-Relay-Falcor-等"><a href="#学习-Relay-Falcor-等" class="headerlink" title="学习 Relay, Falcor 等"></a>学习 Relay, Falcor 等</h2><p>这些技术可以帮你减少 AJAX 请求数, 它们仍然是非常前沿的, 所以如果你没有遇到过多 AJAX 请求的问题, 就不需要用到 Relay 或者 Falcor.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1436668936&auto=0&height=66"></iframe>
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Yuanchen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">163</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yuanchen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.0
  </div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
